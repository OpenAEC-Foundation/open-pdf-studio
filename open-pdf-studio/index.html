<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Open PDF Studio</title>
  <link rel="icon" type="image/x-icon" href="favicon.ico">
  <link rel="stylesheet" href="styles.css">
  <script>
    try { const p = JSON.parse(localStorage.getItem('pdfEditorPreferences') || '{}');
      if (p.theme) {
        let t = p.theme;
        if (t === 'system') {
          try { t = window.__TAURI__?.window?.getCurrentWindow()?.theme() === 'dark' ? 'dark' : 'light'; }
          catch(e2) { t = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light'; }
        }
        document.documentElement.setAttribute('data-theme', t);
      }
    } catch(e) {}
  </script>
</head>
<body>
  <!-- Title Bar -->
  <div class="title-bar" data-tauri-drag-region>
    <div class="title-bar-left">
      <!-- Quick Access Toolbar -->
      <div class="quick-access-toolbar">
        <img src="icon.png" class="app-icon" alt="Open PDF Studio">
        <div class="quick-access-separator"></div>
        <button class="quick-access-btn" id="qa-open" title="Open (Ctrl+O)">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 19a2 2 0 01-2-2V7a2 2 0 012-2h4l2 2h4a2 2 0 012 2v1M5 19h14a2 2 0 002-2v-5a2 2 0 00-2-2H9a2 2 0 00-2 2v5a2 2 0 01-2 2z"/>
          </svg>
        </button>
        <button class="quick-access-btn" id="qa-save" title="Save (Ctrl+S)">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 3H5a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2V7l-4-4z"/>
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 3v4a1 1 0 01-1 1H8"/>
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 14h10v7H7z"/>
          </svg>
        </button>
        <button class="quick-access-btn" id="qa-save-as" title="Save As (Ctrl+Shift+S)">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 3H5a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2V7l-4-4z"/>
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 3v4a1 1 0 01-1 1H8"/>
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 14h10v7H7z"/>
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M12 6v5m0 0l2-2m-2 2l-2-2"/>
          </svg>
        </button>
        <button class="quick-access-btn" id="qa-print" title="Print (Ctrl+P)">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"/>
          </svg>
        </button>
        <div class="quick-access-separator"></div>
        <button class="quick-access-btn" id="qa-undo" title="Undo (Ctrl+Z)">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6"/>
          </svg>
        </button>
        <button class="quick-access-btn" id="qa-redo" title="Redo (Ctrl+Y)">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 10H11a8 8 0 00-8 8v2m18-10l-6 6m6-6l-6-6"/>
          </svg>
        </button>
        <div class="quick-access-separator"></div>
        <button class="quick-access-btn" id="qa-prev-view" title="Previous View">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 17l-5-5m0 0l5-5m-5 5h12"/>
          </svg>
        </button>
        <button class="quick-access-btn" id="qa-next-view" title="Next View">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6"/>
          </svg>
        </button>
      </div>
    </div>
    <div class="title-bar-center" data-tauri-drag-region>
      <span class="app-title">Open PDF Studio</span>
      <span class="file-name" id="file-info"></span>
    </div>
    <div class="window-controls">
      <button class="window-btn" id="btn-minimize" title="Minimize">
        <svg width="10" height="1" viewBox="0 0 10 1"><rect width="10" height="1" fill="currentColor"/></svg>
      </button>
      <button class="window-btn" id="btn-maximize" title="Maximize">
        <svg width="10" height="10" viewBox="0 0 10 10"><rect x="0.5" y="0.5" width="9" height="9" fill="none" stroke="currentColor" stroke-width="1.2"/></svg>
      </button>
      <button class="window-btn window-btn-close" id="btn-close" title="Close">
        <svg width="10" height="10" viewBox="0 0 10 10"><line x1="0" y1="0" x2="10" y2="10" stroke="currentColor" stroke-width="1.2"/><line x1="10" y1="0" x2="0" y2="10" stroke="currentColor" stroke-width="1.2"/></svg>
      </button>
    </div>
  </div>

  <!-- Ribbon -->
  <div class="ribbon-container">
    <!-- Ribbon Tabs -->
    <div class="ribbon-tabs">
      <button class="ribbon-tab file-tab" id="file-tab">File</button>
      <button class="ribbon-tab active" data-tab="home">Home</button>
      <button class="ribbon-tab" data-tab="comment">Comment</button>
      <button class="ribbon-tab" data-tab="view">View</button>
      <button class="ribbon-tab" data-tab="edit">Edit</button>
      <button class="ribbon-tab" data-tab="forms">Forms</button>
      <button class="ribbon-tab" data-tab="organize">Organize</button>
      <button class="ribbon-tab" data-tab="help">Help</button>
      <span class="ribbon-tab-separator contextual-tabs" id="contextual-tabs-separator"></span>
      <button class="ribbon-tab contextual-tab contextual-tabs" data-tab="format" id="tab-format-btn">Format</button>
      <button class="ribbon-tab contextual-tab contextual-tabs" data-tab="arrange" id="tab-arrange-btn">Arrange</button>
    </div>

    <!-- Home Tab Content -->
    <div class="ribbon-content active" id="tab-home">
      <div class="ribbon-groups">
        <!-- Tools Group -->
        <div class="ribbon-group">
          <div class="ribbon-group-content">
            <button class="ribbon-btn active" id="tool-select" title="Select">
              <div class="ribbon-btn-icon">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 15l-2 5L9 9l11 4-5 2zm0 0l5 5"/>
                </svg>
              </div>
              <span class="ribbon-btn-label">Select</span>
            </button>
            <button class="ribbon-btn" id="tool-hand" title="Hand Tool">
              <div class="ribbon-btn-icon">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 11.5V14m0-2.5v-6a1.5 1.5 0 113 0m-3 6a1.5 1.5 0 00-3 0v2a7.5 7.5 0 0015 0v-5a1.5 1.5 0 00-3 0m-6-3V11m0-5.5v-1a1.5 1.5 0 013 0v1m0 0V11m0-5.5a1.5 1.5 0 013 0v3m0 0V11"/>
                </svg>
              </div>
              <span class="ribbon-btn-label">Hand</span>
            </button>
            <div class="ribbon-split-btn" id="screenshot-split-btn">
              <button class="ribbon-btn" id="screenshot-page" title="Capture Full Page">
                <div class="ribbon-btn-icon">
                  <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"/>
                    <circle cx="12" cy="13" r="3" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"/>
                  </svg>
                </div>
                <span class="ribbon-btn-label">Screenshot</span>
              </button>
              <button class="ribbon-split-btn-arrow" id="screenshot-dropdown-toggle" title="Screenshot options">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="8" height="8">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M6 9l6 6 6-6"/>
                </svg>
              </button>
              <div class="ribbon-split-btn-menu" id="screenshot-menu">
                <button class="ribbon-split-btn-menu-item" id="screenshot-menu-page">
                  <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="14" height="14">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"/>
                    <circle cx="12" cy="13" r="3" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"/>
                  </svg>
                  Full Page
                </button>
                <button class="ribbon-split-btn-menu-item" id="screenshot-menu-region">
                  <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="14" height="14">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4h4M4 4v4M20 4h-4M20 4v4M4 20h4M4 20v-4M20 20h-4M20 20v-4"/>
                    <rect x="8" y="8" width="8" height="8" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" stroke-dasharray="2 2"/>
                  </svg>
                  Region
                </button>
              </div>
            </div>
          </div>
          <div class="ribbon-group-label">Tools</div>
        </div>

        <!-- Zoom Group - Small stacked buttons -->
        <div class="ribbon-group">
          <div class="ribbon-group-content">
            <div class="ribbon-btn-stack">
              <button class="ribbon-btn small" id="zoom-in-ribbon" title="Zoom In">
                <div class="ribbon-btn-icon">
                  <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM10 7v6m3-3H7"/>
                  </svg>
                </div>
                <span class="ribbon-btn-label">Zoom In</span>
              </button>
              <button class="ribbon-btn small" id="zoom-out-ribbon" title="Zoom Out">
                <div class="ribbon-btn-icon">
                  <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM13 10H7"/>
                  </svg>
                </div>
                <span class="ribbon-btn-label">Zoom Out</span>
              </button>
              <button class="ribbon-btn small" id="fit-width" title="Fit Width">
                <div class="ribbon-btn-icon">
                  <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"/>
                  </svg>
                </div>
                <span class="ribbon-btn-label">Fit Width</span>
              </button>
            </div>
          </div>
          <div class="ribbon-group-label">Zoom</div>
        </div>

        <!-- Page Navigation - Small stacked + large buttons -->
        <div class="ribbon-group">
          <div class="ribbon-group-content">
            <div class="ribbon-btn-stack">
              <button class="ribbon-btn small" id="first-page" title="First Page">
                <div class="ribbon-btn-icon">
                  <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 19l-7-7 7-7m8 14l-7-7 7-7"/>
                  </svg>
                </div>
                <span class="ribbon-btn-label">First</span>
              </button>
              <button class="ribbon-btn small" id="prev-page-ribbon" title="Previous Page">
                <div class="ribbon-btn-icon">
                  <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                  </svg>
                </div>
                <span class="ribbon-btn-label">Previous</span>
              </button>
              <button class="ribbon-btn small" id="next-page-ribbon" title="Next Page">
                <div class="ribbon-btn-icon">
                  <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                  </svg>
                </div>
                <span class="ribbon-btn-label">Next</span>
              </button>
            </div>
            <button class="ribbon-btn" id="last-page" title="Last Page">
              <div class="ribbon-btn-icon">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 5l7 7-7 7M5 5l7 7-7 7"/>
                </svg>
              </div>
              <span class="ribbon-btn-label">Last</span>
            </button>
          </div>
          <div class="ribbon-group-label">Navigate</div>
        </div>

        <!-- Find Group -->
        <div class="ribbon-group">
          <div class="ribbon-group-content">
            <button class="ribbon-btn" id="ribbon-find" title="Find (Ctrl+F)">
              <div class="ribbon-btn-icon">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                </svg>
              </div>
              <span class="ribbon-btn-label">Find</span>
            </button>
          </div>
          <div class="ribbon-group-label">Find</div>
        </div>
      </div>
    </div>

    <!-- Comment Tab Content -->
    <div class="ribbon-content" id="tab-comment">
      <div class="ribbon-groups">
        <!-- Highlight & Drawing -->
        <div class="ribbon-group">
          <div class="ribbon-group-content">
            <button class="ribbon-btn" id="tool-highlight" title="Highlight">
              <div class="ribbon-btn-icon">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21h10M3 10h18M3 14h18"/>
                </svg>
              </div>
              <span class="ribbon-btn-label">Highlight</span>
            </button>
            <button class="ribbon-btn" id="tool-draw" title="Freehand">
              <div class="ribbon-btn-icon">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"/>
                </svg>
              </div>
              <span class="ribbon-btn-label">Freehand</span>
            </button>
            <div class="ribbon-btn-stack">
              <button class="ribbon-btn small" id="tool-line" title="Line">
                <div class="ribbon-btn-icon">
                  <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 19l14-14"/>
                  </svg>
                </div>
                <span class="ribbon-btn-label">Line</span>
              </button>
              <button class="ribbon-btn small" id="tool-arrow" title="Arrow">
                <div class="ribbon-btn-icon">
                  <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 19l14-14"/>
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 5l-6 0m6 0l0 6"/>
                  </svg>
                </div>
                <span class="ribbon-btn-label">Arrow</span>
              </button>
              <button class="ribbon-btn small" id="tool-polyline" title="Polyline (double-click to finish)">
                <div class="ribbon-btn-icon">
                  <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 18L9 10L14 14L20 6"/>
                  </svg>
                </div>
                <span class="ribbon-btn-label">Polyline</span>
              </button>
            </div>
          </div>
          <div class="ribbon-group-label">Drawing</div>
        </div>

        <!-- Shapes -->
        <div class="ribbon-group">
          <div class="ribbon-group-content">
            <button class="ribbon-btn" id="tool-box" title="Rectangle">
              <div class="ribbon-btn-icon">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <rect x="4" y="4" width="16" height="16" rx="2" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"/>
                </svg>
              </div>
              <span class="ribbon-btn-label">Rect</span>
            </button>
            <button class="ribbon-btn" id="tool-circle" title="Ellipse">
              <div class="ribbon-btn-icon">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <circle cx="12" cy="12" r="9" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"/>
                </svg>
              </div>
              <span class="ribbon-btn-label">Ellipse</span>
            </button>
            <div class="ribbon-btn-stack">
              <button class="ribbon-btn small" id="tool-polygon" title="Polygon">
                <div class="ribbon-btn-icon">
                  <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                  </svg>
                </div>
                <span class="ribbon-btn-label">Polygon</span>
              </button>
              <button class="ribbon-btn small" id="tool-cloud" title="Cloud">
                <div class="ribbon-btn-icon">
                  <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 15a4 4 0 004 4h9a5 5 0 10-.1-9.999 5.002 5.002 0 10-9.78 2.096A4.001 4.001 0 003 15z"/>
                  </svg>
                </div>
                <span class="ribbon-btn-label">Cloud</span>
              </button>
            </div>
          </div>
          <div class="ribbon-group-label">Shapes</div>
        </div>

        <!-- Text & Notes -->
        <div class="ribbon-group">
          <div class="ribbon-group-content">
            <button class="ribbon-btn" id="tool-text" title="Text">
              <div class="ribbon-btn-icon">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
                </svg>
              </div>
              <span class="ribbon-btn-label">Text</span>
            </button>
            <button class="ribbon-btn" id="tool-textbox" title="Text Box">
              <div class="ribbon-btn-icon">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
                  <rect x="3" y="5" width="18" height="14" rx="2" stroke="currentColor" stroke-width="2" fill="none"/>
                </svg>
              </div>
              <span class="ribbon-btn-label">Text Box</span>
            </button>
            <button class="ribbon-btn" id="tool-comment" title="Note">
              <div class="ribbon-btn-icon">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z"/>
                </svg>
              </div>
              <span class="ribbon-btn-label">Note</span>
            </button>
            <button class="ribbon-btn" id="tool-callout" title="Callout">
              <div class="ribbon-btn-icon">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"/>
                </svg>
              </div>
              <span class="ribbon-btn-label">Callout</span>
            </button>
          </div>
          <div class="ribbon-group-label">Text</div>
        </div>

        <!-- Stamp & Signature -->
        <div class="ribbon-group">
          <div class="ribbon-group-content">
            <button class="ribbon-btn" id="tool-stamp" title="Stamp">
              <div class="ribbon-btn-icon">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/>
                </svg>
              </div>
              <span class="ribbon-btn-label">Stamp</span>
            </button>
            <button class="ribbon-btn" id="tool-signature" title="Signature">
              <div class="ribbon-btn-icon">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"/>
                  <path stroke-linecap="round" stroke-width="2" d="M3 21c2-2 4-3 6-1s4-1 6-3"/>
                </svg>
              </div>
              <span class="ribbon-btn-label">Signature</span>
            </button>
          </div>
          <div class="ribbon-group-label">Stamp</div>
        </div>

        <!-- Measure -->
        <div class="ribbon-group">
          <div class="ribbon-group-content">
            <div class="ribbon-btn-stack">
              <button class="ribbon-btn small" id="tool-measure-distance" title="Measure Distance">
                <div class="ribbon-btn-icon">
                  <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 20L20 4"/>
                    <path stroke-linecap="round" stroke-width="2" d="M4 20v-4m0 4h4M20 4v4m0-4h-4"/>
                  </svg>
                </div>
                <span class="ribbon-btn-label">Distance</span>
              </button>
              <button class="ribbon-btn small" id="tool-measure-area" title="Measure Area">
                <div class="ribbon-btn-icon">
                  <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <rect x="4" y="4" width="16" height="16" stroke-width="2" stroke-dasharray="4 2"/>
                    <path stroke-linecap="round" stroke-width="2" d="M8 20v-2m4 2v-2m4 2v-2M4 8h2m-2 4h2m-2 4h2"/>
                  </svg>
                </div>
                <span class="ribbon-btn-label">Area</span>
              </button>
              <button class="ribbon-btn small" id="tool-measure-perimeter" title="Measure Perimeter">
                <div class="ribbon-btn-icon">
                  <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 18L9 10L14 14L20 6"/>
                    <path stroke-linecap="round" stroke-width="2" d="M4 18v-3m0 3h3"/>
                  </svg>
                </div>
                <span class="ribbon-btn-label">Perimeter</span>
              </button>
            </div>
          </div>
          <div class="ribbon-group-label">Measure</div>
        </div>

        <!-- Redaction -->
        <div class="ribbon-group">
          <div class="ribbon-group-content">
            <button class="ribbon-btn" id="tool-redaction" title="Mark for Redaction">
              <div class="ribbon-btn-icon">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <rect x="3" y="5" width="18" height="14" rx="0" stroke-width="2"/>
                  <line x1="3" y1="12" x2="21" y2="12" stroke-width="2"/>
                  <line x1="7" y1="5" x2="7" y2="19" stroke-width="1.5"/>
                  <line x1="17" y1="5" x2="17" y2="19" stroke-width="1.5"/>
                </svg>
              </div>
              <span class="ribbon-btn-label">Redact</span>
            </button>
            <button class="ribbon-btn" id="btn-apply-redactions" title="Apply Redactions on Current Page">
              <div class="ribbon-btn-icon" style="color: #dc2626;">
                <svg fill="currentColor" viewBox="0 0 24 24">
                  <rect x="3" y="5" width="18" height="14" rx="0"/>
                </svg>
              </div>
              <span class="ribbon-btn-label">Apply</span>
            </button>
          </div>
          <div class="ribbon-group-label">Redaction</div>
        </div>

        <!-- Properties -->
        <div class="ribbon-group">
          <div class="ribbon-group-content">
            <div class="ribbon-btn-stack">
              <div class="ribbon-input-row">
                <label class="ribbon-input-label">Color</label>
                <input type="color" id="color-picker" class="ribbon-color-input" value="#ffff00">
              </div>
              <div class="ribbon-input-row">
                <label class="ribbon-input-label">Width</label>
                <input type="number" id="line-width" class="ribbon-input" min="1" max="20" value="3">
              </div>
            </div>
          </div>
          <div class="ribbon-group-label">Properties</div>
        </div>

        <!-- Actions -->
        <div class="ribbon-group">
          <div class="ribbon-group-content">
            <div class="ribbon-btn-stack">
              <button class="ribbon-btn small" id="tool-undo" title="Undo">
                <div class="ribbon-btn-icon">
                  <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6"/>
                  </svg>
                </div>
                <span class="ribbon-btn-label">Undo</span>
              </button>
              <button class="ribbon-btn small" id="tool-clear" title="Clear Page Annotations">
                <div class="ribbon-btn-icon">
                  <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                  </svg>
                </div>
                <span class="ribbon-btn-label">Clear Page</span>
              </button>
              <button class="ribbon-btn small" id="ribbon-clear-all" title="Clear All Annotations">
                <div class="ribbon-btn-icon">
                  <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 13h6m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2zM12 11V7"/>
                  </svg>
                </div>
                <span class="ribbon-btn-label">Clear All</span>
              </button>
            </div>
          </div>
          <div class="ribbon-group-label">Edit</div>
        </div>
      </div>
    </div>

    <!-- View Tab Content -->
    <div class="ribbon-content" id="tab-view">
      <div class="ribbon-groups">
        <!-- Page Display -->
        <div class="ribbon-group">
          <div class="ribbon-group-content">
            <button class="ribbon-btn" id="single-page" title="Single Page">
              <div class="ribbon-btn-icon">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                </svg>
              </div>
              <span class="ribbon-btn-label">Single</span>
            </button>
            <button class="ribbon-btn" id="continuous" title="Continuous (coming soon)" disabled style="opacity: 0.4; cursor: default;">
              <div class="ribbon-btn-icon">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                </svg>
              </div>
              <span class="ribbon-btn-label">Continuous</span>
            </button>
          </div>
          <div class="ribbon-group-label">Page Display</div>
        </div>

        <!-- Rotate -->
        <div class="ribbon-group">
          <div class="ribbon-group-content">
            <button class="ribbon-btn" id="rotate-left" title="Rotate Left">
              <div class="ribbon-btn-icon">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6"/>
                </svg>
              </div>
              <span class="ribbon-btn-label">Rotate Left</span>
            </button>
            <button class="ribbon-btn" id="rotate-right" title="Rotate Right">
              <div class="ribbon-btn-icon">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 10H11a8 8 0 00-8 8v2m18-10l-6 6m6-6l-6-6"/>
                </svg>
              </div>
              <span class="ribbon-btn-label">Rotate Right</span>
            </button>
          </div>
          <div class="ribbon-group-label">Rotate</div>
        </div>

        <!-- Zoom -->
        <div class="ribbon-group">
          <div class="ribbon-group-content">
            <button class="ribbon-btn" id="ribbon-zoom-in" title="Zoom In (Ctrl++)">
              <div class="ribbon-btn-icon">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM10 7v6m3-3H7"/>
                </svg>
              </div>
              <span class="ribbon-btn-label">Zoom In</span>
            </button>
            <button class="ribbon-btn" id="ribbon-zoom-out" title="Zoom Out (Ctrl+-)">
              <div class="ribbon-btn-icon">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM13 10H7"/>
                </svg>
              </div>
              <span class="ribbon-btn-label">Zoom Out</span>
            </button>
            <button class="ribbon-btn" id="view-actual-size" title="Actual Size (Ctrl+0)">
              <div class="ribbon-btn-icon">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                </svg>
              </div>
              <span class="ribbon-btn-label">100%</span>
            </button>
            <button class="ribbon-btn" id="view-fit-width" title="Fit Width (Ctrl+1)">
              <div class="ribbon-btn-icon">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
                </svg>
              </div>
              <span class="ribbon-btn-label">Fit Width</span>
            </button>
            <button class="ribbon-btn" id="view-fit-page" title="Fit Page (Ctrl+2)">
              <div class="ribbon-btn-icon">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"/>
                </svg>
              </div>
              <span class="ribbon-btn-label">Fit Page</span>
            </button>
          </div>
          <div class="ribbon-group-label">Zoom</div>
        </div>

        <!-- Panels -->
        <div class="ribbon-group">
          <div class="ribbon-group-content">
            <button class="ribbon-btn" id="ribbon-nav-panel" title="Navigation Panel (F9)">
              <div class="ribbon-btn-icon">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 10h16M4 14h16M4 18h16"/>
                </svg>
              </div>
              <span class="ribbon-btn-label">Navigation</span>
            </button>
            <button class="ribbon-btn" id="ribbon-properties-panel" title="Properties Panel (F12)">
              <div class="ribbon-btn-icon">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/>
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                </svg>
              </div>
              <span class="ribbon-btn-label">Properties</span>
            </button>
            <button class="ribbon-btn" id="ribbon-annotations-list" title="Annotations List (F11)">
              <div class="ribbon-btn-icon">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"/>
                </svg>
              </div>
              <span class="ribbon-btn-label">Annotations</span>
            </button>
          </div>
          <div class="ribbon-group-label">Panels</div>
        </div>

        <!-- Appearance -->
        <div class="ribbon-group">
          <div class="ribbon-group-content">
            <div class="ribbon-input-group" style="justify-content: center;">
              <label class="ribbon-input-label" for="theme-select">Theme</label>
              <select class="ribbon-input" id="theme-select" style="width: 110px;">
                <option value="system">System</option>
                <option value="light">Light</option>
                <option value="dark">Dark</option>
                <option value="blue">Blue</option>
                <option value="highContrast">High Contrast</option>
              </select>
            </div>
          </div>
          <div class="ribbon-group-label">Appearance</div>
        </div>
      </div>
    </div>

    <!-- Edit Tab Content -->
    <div class="ribbon-content" id="tab-edit">
      <div class="ribbon-groups">
        <div class="ribbon-group">
          <div class="ribbon-group-content">
            <button class="ribbon-btn large" id="edit-text" title="Edit Text">
              <div class="ribbon-btn-icon">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
                </svg>
              </div>
              <span class="ribbon-btn-label">Edit Text</span>
            </button>
          </div>
          <div class="ribbon-group-label">Content</div>
        </div>

        <!-- XFDF Import/Export -->
        <div class="ribbon-group">
          <div class="ribbon-group-content">
            <div class="ribbon-btn-stack">
              <button class="ribbon-btn small" id="xfdf-export" title="Export Annotations to XFDF">
                <div class="ribbon-btn-icon">
                  <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/>
                  </svg>
                </div>
                <span class="ribbon-btn-label">Export XFDF</span>
              </button>
              <button class="ribbon-btn small" id="xfdf-import" title="Import Annotations from XFDF">
                <div class="ribbon-btn-icon">
                  <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"/>
                  </svg>
                </div>
                <span class="ribbon-btn-label">Import XFDF</span>
              </button>
            </div>
          </div>
          <div class="ribbon-group-label">Annotations</div>
        </div>
      </div>
    </div>

    <!-- Forms Tab Content -->
    <div class="ribbon-content" id="tab-forms">
      <div class="ribbon-groups">
        <div class="ribbon-group">
          <div class="ribbon-group-content">
            <button class="ribbon-btn" id="form-text-field" title="Text Field">
              <div class="ribbon-btn-icon">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                </svg>
              </div>
              <span class="ribbon-btn-label">Text Field</span>
            </button>
            <button class="ribbon-btn" id="form-checkbox" title="Checkbox">
              <div class="ribbon-btn-icon">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                </svg>
              </div>
              <span class="ribbon-btn-label">Checkbox</span>
            </button>
            <button class="ribbon-btn" id="form-radio" title="Radio Button">
              <div class="ribbon-btn-icon">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <circle cx="12" cy="12" r="10" stroke-width="2"/>
                  <circle cx="12" cy="12" r="4" fill="currentColor"/>
                </svg>
              </div>
              <span class="ribbon-btn-label">Radio</span>
            </button>
          </div>
          <div class="ribbon-group-label">Form Fields</div>
        </div>
      </div>
    </div>

    <!-- Organize Tab Content -->
    <div class="ribbon-content" id="tab-organize">
      <div class="ribbon-groups">
        <div class="ribbon-group">
          <div class="ribbon-group-content">
            <button class="ribbon-btn" id="insert-page" title="Insert Page">
              <div class="ribbon-btn-icon">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                </svg>
              </div>
              <span class="ribbon-btn-label">Insert</span>
            </button>
            <button class="ribbon-btn" id="delete-page" title="Delete Page">
              <div class="ribbon-btn-icon">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                </svg>
              </div>
              <span class="ribbon-btn-label">Delete</span>
            </button>
            <button class="ribbon-btn" id="extract-pages" title="Extract Pages">
              <div class="ribbon-btn-icon">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 13h6m-3-3v6m5 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                </svg>
              </div>
              <span class="ribbon-btn-label">Extract</span>
            </button>
          </div>
          <div class="ribbon-group-label">Pages</div>
        </div>
        <div class="ribbon-group">
          <div class="ribbon-group-content">
            <button class="ribbon-btn" id="merge-pdfs" title="Merge PDFs">
              <div class="ribbon-btn-icon">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7v8a2 2 0 002 2h6M8 7V5a2 2 0 012-2h4.586a1 1 0 01.707.293l4.414 4.414a1 1 0 01.293.707V15a2 2 0 01-2 2h-2M8 7H6a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2v-2"/>
                </svg>
              </div>
              <span class="ribbon-btn-label">Merge</span>
            </button>
          </div>
          <div class="ribbon-group-label">Combine</div>
        </div>
        <div class="ribbon-group">
          <div class="ribbon-group-content">
            <button class="ribbon-btn" id="add-watermark" title="Add Watermark">
              <div class="ribbon-btn-icon">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657-1.657a2 2 0 012.828 0l2.829 2.829a2 2 0 010 2.828l-8.486 8.485M7 17h.01"/>
                </svg>
              </div>
              <span class="ribbon-btn-label">Watermark</span>
            </button>
            <button class="ribbon-btn" id="add-header-footer" title="Add Header/Footer">
              <div class="ribbon-btn-icon">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h7"/>
                </svg>
              </div>
              <span class="ribbon-btn-label">Header/Footer</span>
            </button>
            <button class="ribbon-btn" id="manage-watermarks" title="Manage Watermarks">
              <div class="ribbon-btn-icon">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 10h16M4 14h16M4 18h16"/>
                </svg>
              </div>
              <span class="ribbon-btn-label">Manage</span>
            </button>
          </div>
          <div class="ribbon-group-label">Watermark</div>
        </div>
      </div>
    </div>

    <!-- Help Tab Content -->
    <div class="ribbon-content" id="tab-help">
      <div class="ribbon-groups">
        <div class="ribbon-group">
          <div class="ribbon-group-content">
            <button class="ribbon-btn" id="ribbon-about" title="About Open PDF Studio">
              <div class="ribbon-btn-icon">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                </svg>
              </div>
              <span class="ribbon-btn-label">About</span>
            </button>
            <button class="ribbon-btn" id="ribbon-shortcuts" title="Keyboard Shortcuts (F1)">
              <div class="ribbon-btn-icon">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"/>
                </svg>
              </div>
              <span class="ribbon-btn-label">Shortcuts</span>
            </button>
          </div>
          <div class="ribbon-group-label">Information</div>
        </div>

        <div class="ribbon-group">
          <div class="ribbon-group-content">
            <button class="ribbon-btn" id="ribbon-check-updates" title="Check for Updates">
              <div class="ribbon-btn-icon">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
                </svg>
              </div>
              <span class="ribbon-btn-label">Updates</span>
            </button>
          </div>
          <div class="ribbon-group-label">Updates</div>
        </div>

        <div class="ribbon-group">
          <div class="ribbon-group-content">
            <button class="ribbon-btn" id="ribbon-file-assoc" title="Set Default PDF Application">
              <div class="ribbon-btn-icon">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                </svg>
              </div>
              <span class="ribbon-btn-label">File Associations</span>
            </button>
          </div>
          <div class="ribbon-group-label">File Association</div>
        </div>
      </div>
    </div>

    <!-- Format Tab Content (contextual - shown when annotations selected) -->
    <div class="ribbon-content contextual-tabs" id="tab-format">
      <div class="ribbon-groups">

        <!-- Styles Gallery Group -->
        <div class="ribbon-group ribbon-group-wide">
          <div class="ribbon-group-content">
            <div class="ribbon-style-gallery" id="fmt-style-gallery">
              <div class="ribbon-style-item" data-style="red" title="Red">
                <div class="ribbon-style-preview" style="border-color: #ff0000; color: #ff0000;">
                  <span>T</span>
                </div>
                <span class="ribbon-style-label">Red</span>
              </div>
              <div class="ribbon-style-item" data-style="purple" title="Purple">
                <div class="ribbon-style-preview" style="border-color: #800080; color: #800080;">
                  <span>T</span>
                </div>
                <span class="ribbon-style-label">Purple</span>
              </div>
              <div class="ribbon-style-item" data-style="indigo" title="Indigo">
                <div class="ribbon-style-preview" style="border-color: #4b0082; color: #4b0082;">
                  <span>T</span>
                </div>
                <span class="ribbon-style-label">Indigo</span>
              </div>
              <div class="ribbon-style-item" data-style="blue" title="Blue">
                <div class="ribbon-style-preview" style="border-color: #0066cc; color: #0066cc;">
                  <span>T</span>
                </div>
                <span class="ribbon-style-label">Blue</span>
              </div>
              <div class="ribbon-style-item" data-style="green" title="Green">
                <div class="ribbon-style-preview" style="border-color: #008000; color: #008000;">
                  <span>T</span>
                </div>
                <span class="ribbon-style-label">Green</span>
              </div>
              <div class="ribbon-style-item" data-style="yellow" title="Yellow">
                <div class="ribbon-style-preview" style="border-color: #e6a817; color: #e6a817;">
                  <span>T</span>
                </div>
                <span class="ribbon-style-label">Yellow</span>
              </div>
              <div class="ribbon-style-item" data-style="black" title="Black">
                <div class="ribbon-style-preview" style="border-color: #000000; color: #000000;">
                  <span>T</span>
                </div>
                <span class="ribbon-style-label">Black</span>
              </div>
              <div class="ribbon-style-item" data-style="red-cloudy" title="Red Cloudy">
                <div class="ribbon-style-preview ribbon-style-cloudy" style="border-color: #ff0000; color: #ff0000; background: rgba(255,0,0,0.08);">
                  <span>T</span>
                </div>
                <span class="ribbon-style-label">Red Cloudy</span>
              </div>
              <div class="ribbon-style-item" data-style="purple-cloudy" title="Purple Cloudy">
                <div class="ribbon-style-preview ribbon-style-cloudy" style="border-color: #800080; color: #800080; background: rgba(128,0,128,0.08);">
                  <span>T</span>
                </div>
                <span class="ribbon-style-label">Purple Cloudy</span>
              </div>
              <div class="ribbon-style-item" data-style="indigo-cloudy" title="Indigo Cloudy">
                <div class="ribbon-style-preview ribbon-style-cloudy" style="border-color: #7b68ee; color: #7b68ee; background: rgba(123,104,238,0.15);">
                  <span>T</span>
                </div>
                <span class="ribbon-style-label">Indigo Cloudy</span>
              </div>
            </div>
            <button class="ribbon-gallery-more" id="fmt-style-more" title="More Styles">
              <svg viewBox="0 0 8 14"><path d="M1 1l5 6-5 6" stroke="currentColor" stroke-width="1.5" fill="none"/></svg>
            </button>
          </div>
          <div class="ribbon-group-label"></div>
        </div>

        <!-- Color Group -->
        <div class="ribbon-group">
          <div class="ribbon-group-content">
            <div class="ribbon-btn-stack">
              <div class="ribbon-color-picker-wrapper">
                <button class="ribbon-btn medium ribbon-color-btn" id="fmt-fill-color" title="Fill Color">
                  <div class="ribbon-btn-icon">
                    <svg viewBox="0 0 18 18" fill="none">
                      <rect x="2" y="2" width="14" height="11" rx="1" id="fmt-fill-icon-rect" fill="#ffffff" stroke="#999" stroke-width="1"/>
                      <rect x="2" y="14" width="14" height="2.5" rx="0.5" id="fmt-fill-indicator" fill="#ffffff" stroke="#ccc" stroke-width="0.5"/>
                    </svg>
                  </div>
                  <span class="ribbon-btn-label">Fill Color</span>
                  <svg class="ribbon-color-dd-arrow" viewBox="0 0 8 5"><path d="M0 0l4 4 4-4z" fill="currentColor"/></svg>
                </button>
                <div class="ribbon-color-dropdown" id="fmt-fill-dropdown">
                  <div class="ribbon-color-palette" id="fmt-fill-palette"></div>
                  <div class="ribbon-color-dropdown-actions">
                    <button class="ribbon-color-none-btn" id="fmt-fill-none">No Fill</button>
                    <button class="ribbon-color-custom-btn" id="fmt-fill-custom">Custom...</button>
                  </div>
                </div>
              </div>
              <div class="ribbon-color-picker-wrapper">
                <button class="ribbon-btn medium ribbon-color-btn" id="fmt-stroke-color" title="Stroke Color">
                  <div class="ribbon-btn-icon">
                    <svg viewBox="0 0 18 18" fill="none">
                      <rect x="3" y="3" width="12" height="9" rx="1" fill="none" id="fmt-stroke-icon-rect" stroke="#ff0000" stroke-width="2.5"/>
                      <rect x="2" y="14" width="14" height="2.5" rx="0.5" id="fmt-stroke-indicator" fill="#ff0000"/>
                    </svg>
                  </div>
                  <span class="ribbon-btn-label">Stroke Color</span>
                  <svg class="ribbon-color-dd-arrow" viewBox="0 0 8 5"><path d="M0 0l4 4 4-4z" fill="currentColor"/></svg>
                </button>
                <div class="ribbon-color-dropdown" id="fmt-stroke-dropdown">
                  <div class="ribbon-color-palette" id="fmt-stroke-palette"></div>
                  <div class="ribbon-color-dropdown-actions">
                    <button class="ribbon-color-custom-btn" id="fmt-stroke-custom">Custom...</button>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="ribbon-group-label"></div>
        </div>

        <!-- Line/Border Group -->
        <div class="ribbon-group">
          <div class="ribbon-group-content">
            <div class="ribbon-form-grid">
              <div class="ribbon-form-row">
                <label>Width:</label>
                <select class="ribbon-form-select" id="fmt-line-width" title="Line Width">
                  <option value="0.5">0.5 pt</option>
                  <option value="1" selected>1 pt</option>
                  <option value="2">2 pt</option>
                  <option value="3">3 pt</option>
                  <option value="4">4 pt</option>
                  <option value="6">6 pt</option>
                  <option value="8">8 pt</option>
                </select>
                <label>Opacity:</label>
                <select class="ribbon-form-select" id="fmt-opacity" title="Opacity">
                  <option value="100">100%</option>
                  <option value="90">90%</option>
                  <option value="75">75%</option>
                  <option value="50">50%</option>
                  <option value="25">25%</option>
                  <option value="10">10%</option>
                </select>
              </div>
              <div class="ribbon-form-row">
                <label>Border:</label>
                <select class="ribbon-form-select" id="fmt-border-style" title="Border Style">
                  <option value="solid">Solid</option>
                  <option value="dashed">Dashed</option>
                  <option value="dotted">Dotted</option>
                </select>
                <label>Blend:</label>
                <select class="ribbon-form-select" id="fmt-blend-mode" title="Blend Mode">
                  <option value="normal">Normal</option>
                  <option value="multiply">Multiply</option>
                </select>
              </div>
            </div>
          </div>
          <div class="ribbon-group-label"></div>
        </div>

        <!-- Arrow Endpoints Group -->
        <div class="ribbon-group">
          <div class="ribbon-group-content">
            <div class="ribbon-form-grid ribbon-form-grid-2col">
              <div class="ribbon-form-row">
                <label>Start:</label>
                <select class="ribbon-form-select" id="fmt-arrow-start" title="Start Arrow">
                  <option value="none">None</option>
                  <option value="open">Open</option>
                  <option value="closed">Closed</option>
                  <option value="stealth">Stealth</option>
                  <option value="diamond">Diamond</option>
                  <option value="circle">Circle</option>
                  <option value="square">Square</option>
                  <option value="slash">Slash</option>
                </select>
              </div>
              <div class="ribbon-form-row">
                <label>End:</label>
                <select class="ribbon-form-select" id="fmt-arrow-end" title="End Arrow">
                  <option value="none">None</option>
                  <option value="open">Open</option>
                  <option value="closed">Closed</option>
                  <option value="stealth">Stealth</option>
                  <option value="diamond">Diamond</option>
                  <option value="circle">Circle</option>
                  <option value="square">Square</option>
                  <option value="slash">Slash</option>
                </select>
              </div>
            </div>
          </div>
          <div class="ribbon-group-label"></div>
        </div>

        <!-- Style Tools Group -->
        <div class="ribbon-group">
          <div class="ribbon-group-content">
            <div class="ribbon-grid-col">
              <button class="ribbon-row-btn ribbon-dropdown-btn" id="fmt-style-tools" title="Style Tools">
                <svg viewBox="0 0 16 16" fill="none"><rect x="2" y="2" width="12" height="12" rx="1" stroke="#555" stroke-width="1"/><path d="M5 6h6M5 8h4M5 10h5" stroke="#555" stroke-width="0.8"/></svg>
                <span>Style Tools</span>
                <svg class="dropdown-arrow" viewBox="0 0 8 5"><path d="M0 0l4 4 4-4z" fill="currentColor"/></svg>
              </button>
              <button class="ribbon-row-btn" id="fmt-reset-location" title="Reset Location">
                <svg viewBox="0 0 16 16" fill="none"><path d="M3 8a5 5 0 019.5-2" stroke="#555" stroke-width="1.5"/><path d="M5 3L3 6l3 0" fill="#555"/><circle cx="8" cy="8" r="1.5" fill="#555"/></svg>
                <span>Reset Location</span>
              </button>
            </div>
          </div>
          <div class="ribbon-group-label"></div>
        </div>

        <!-- Properties Group -->
        <div class="ribbon-group">
          <div class="ribbon-group-content">
            <div class="ribbon-grid-col">
              <button class="ribbon-row-btn" id="fmt-open" title="Open Properties">
                <svg viewBox="0 0 16 16" fill="none"><rect x="2" y="2" width="12" height="12" rx="1" stroke="#4a86c8" stroke-width="1.2"/><path d="M5 5h6M5 8h6M5 11h3" stroke="#4a86c8" stroke-width="0.8"/></svg>
                <span>Open</span>
              </button>
              <button class="ribbon-row-btn" id="fmt-hide" title="Hide Annotation">
                <svg viewBox="0 0 16 16" fill="none"><path d="M2 8s2.5-4 6-4 6 4 6 4-2.5 4-6 4-6-4-6-4z" stroke="#555" stroke-width="1"/><circle cx="8" cy="8" r="2" stroke="#555" stroke-width="1"/><line x1="3" y1="13" x2="13" y2="3" stroke="#c00" stroke-width="1.2"/></svg>
                <span>Hide</span>
              </button>
            </div>
            <div class="ribbon-grid-col" style="justify-content: center;">
              <div class="ribbon-form-row">
                <label>Layer:</label>
                <select class="ribbon-form-select" id="fmt-layer" title="Layer">
                  <option value="none">None</option>
                </select>
              </div>
            </div>
          </div>
          <div class="ribbon-group-label">Properties</div>
        </div>

      </div>
    </div>

    <!-- Arrange Tab Content (contextual - shown when annotations selected) -->
    <div class="ribbon-content contextual-tabs" id="tab-arrange">
      <div class="ribbon-groups">

        <!-- Alignment Group -->
        <div class="ribbon-group">
          <div class="ribbon-group-content">
            <div class="ribbon-grid-col">
              <button class="ribbon-row-btn" id="arr-align-left" title="Align Left">
                <svg viewBox="0 0 16 16" fill="none"><rect x="1" y="1" width="2" height="14" fill="#e6a817"/><rect x="4" y="3" width="8" height="3" fill="#e6a817" opacity="0.6"/><rect x="4" y="10" width="6" height="3" fill="#e6a817" opacity="0.6"/></svg>
                <span>Left</span>
              </button>
              <button class="ribbon-row-btn" id="arr-align-center" title="Align Center">
                <svg viewBox="0 0 16 16" fill="none"><rect x="7" y="1" width="2" height="14" fill="#e6a817"/><rect x="3" y="3" width="10" height="3" fill="#e6a817" opacity="0.6"/><rect x="4" y="10" width="8" height="3" fill="#e6a817" opacity="0.6"/></svg>
                <span>Center</span>
              </button>
              <button class="ribbon-row-btn" id="arr-align-right" title="Align Right">
                <svg viewBox="0 0 16 16" fill="none"><rect x="13" y="1" width="2" height="14" fill="#e6a817"/><rect x="4" y="3" width="8" height="3" fill="#e6a817" opacity="0.6"/><rect x="6" y="10" width="6" height="3" fill="#e6a817" opacity="0.6"/></svg>
                <span>Right</span>
              </button>
            </div>
            <div class="ribbon-grid-col">
              <button class="ribbon-row-btn" id="arr-align-top" title="Align Top">
                <svg viewBox="0 0 16 16" fill="none"><rect x="1" y="1" width="14" height="2" fill="#e6a817"/><rect x="3" y="4" width="3" height="8" fill="#e6a817" opacity="0.6"/><rect x="10" y="4" width="3" height="6" fill="#e6a817" opacity="0.6"/></svg>
                <span>Top</span>
              </button>
              <button class="ribbon-row-btn" id="arr-align-middle" title="Align Middle">
                <svg viewBox="0 0 16 16" fill="none"><rect x="1" y="7" width="14" height="2" fill="#e6a817"/><rect x="3" y="2" width="3" height="12" fill="#e6a817" opacity="0.6"/><rect x="10" y="4" width="3" height="8" fill="#e6a817" opacity="0.6"/></svg>
                <span>Middle</span>
              </button>
              <button class="ribbon-row-btn" id="arr-align-bottom" title="Align Bottom">
                <svg viewBox="0 0 16 16" fill="none"><rect x="1" y="13" width="14" height="2" fill="#e6a817"/><rect x="3" y="4" width="3" height="8" fill="#e6a817" opacity="0.6"/><rect x="10" y="6" width="3" height="6" fill="#e6a817" opacity="0.6"/></svg>
                <span>Bottom</span>
              </button>
            </div>
            <div class="ribbon-grid-col">
              <div class="ribbon-grid-spacer"></div>
              <div class="ribbon-grid-spacer"></div>
              <button class="ribbon-row-btn ribbon-dropdown-btn" id="arr-align-to" title="Align To">
                <span>Align to Selection</span>
                <svg class="dropdown-arrow" viewBox="0 0 8 5"><path d="M0 0l4 4 4-4z" fill="currentColor"/></svg>
              </button>
            </div>
          </div>
          <div class="ribbon-group-label">Alignment</div>
        </div>

        <!-- Distribute Group -->
        <div class="ribbon-group">
          <div class="ribbon-group-content">
            <div class="ribbon-btn-stack">
              <button class="ribbon-btn medium" id="arr-dist-space-h" title="Space Horizontally">
                <div class="ribbon-btn-icon">
                  <svg viewBox="0 0 16 16" fill="none"><rect x="1" y="1" width="2" height="14" fill="#3e9b8e"/><rect x="13" y="1" width="2" height="14" fill="#3e9b8e"/><rect x="6" y="4" width="4" height="8" fill="#3e9b8e" opacity="0.5"/><path d="M4 8h2M10 8h2" stroke="#3e9b8e" stroke-width="1"/></svg>
                </div>
                <span class="ribbon-btn-label">Space H.</span>
              </button>
              <button class="ribbon-btn medium" id="arr-dist-space-v" title="Space Vertically">
                <div class="ribbon-btn-icon">
                  <svg viewBox="0 0 16 16" fill="none"><rect x="1" y="1" width="14" height="2" fill="#3e9b8e"/><rect x="1" y="13" width="14" height="2" fill="#3e9b8e"/><rect x="4" y="6" width="8" height="4" fill="#3e9b8e" opacity="0.5"/><path d="M8 4v2M8 10v2" stroke="#3e9b8e" stroke-width="1"/></svg>
                </div>
                <span class="ribbon-btn-label">Space V.</span>
              </button>
            </div>
            <div class="ribbon-btn-stack">
              <button class="ribbon-btn medium" id="arr-dist-left" title="Distribute Left">
                <div class="ribbon-btn-icon">
                  <svg viewBox="0 0 16 16" fill="none"><rect x="1" y="2" width="1.5" height="12" fill="#3e9b8e"/><rect x="7" y="4" width="1.5" height="8" fill="#3e9b8e"/><rect x="13" y="2" width="1.5" height="12" fill="#3e9b8e"/></svg>
                </div>
                <span class="ribbon-btn-label">Left</span>
              </button>
              <button class="ribbon-btn medium" id="arr-dist-top" title="Distribute Top">
                <div class="ribbon-btn-icon">
                  <svg viewBox="0 0 16 16" fill="none"><rect x="2" y="1" width="12" height="1.5" fill="#3e9b8e"/><rect x="4" y="7" width="8" height="1.5" fill="#3e9b8e"/><rect x="2" y="13" width="12" height="1.5" fill="#3e9b8e"/></svg>
                </div>
                <span class="ribbon-btn-label">Top</span>
              </button>
            </div>
            <div class="ribbon-btn-stack">
              <button class="ribbon-btn medium" id="arr-dist-center" title="Distribute Center">
                <div class="ribbon-btn-icon">
                  <svg viewBox="0 0 16 16" fill="none"><rect x="2" y="2" width="3" height="12" fill="#3e9b8e" opacity="0.4"/><rect x="6.5" y="4" width="3" height="8" fill="#3e9b8e" opacity="0.4"/><rect x="11" y="2" width="3" height="12" fill="#3e9b8e" opacity="0.4"/><line x1="3.5" y1="8" x2="12.5" y2="8" stroke="#3e9b8e" stroke-dasharray="1 1"/></svg>
                </div>
                <span class="ribbon-btn-label">Center</span>
              </button>
              <button class="ribbon-btn medium" id="arr-dist-middle" title="Distribute Middle">
                <div class="ribbon-btn-icon">
                  <svg viewBox="0 0 16 16" fill="none"><rect x="2" y="2" width="12" height="3" fill="#3e9b8e" opacity="0.4"/><rect x="4" y="6.5" width="8" height="3" fill="#3e9b8e" opacity="0.4"/><rect x="2" y="11" width="12" height="3" fill="#3e9b8e" opacity="0.4"/><line x1="8" y1="3.5" x2="8" y2="12.5" stroke="#3e9b8e" stroke-dasharray="1 1"/></svg>
                </div>
                <span class="ribbon-btn-label">Middle</span>
              </button>
            </div>
            <div class="ribbon-btn-stack">
              <button class="ribbon-btn medium" id="arr-dist-right" title="Distribute Right">
                <div class="ribbon-btn-icon">
                  <svg viewBox="0 0 16 16" fill="none"><rect x="1.5" y="2" width="1.5" height="12" fill="#3e9b8e"/><rect x="7" y="4" width="1.5" height="8" fill="#3e9b8e"/><rect x="13" y="2" width="1.5" height="12" fill="#3e9b8e"/></svg>
                </div>
                <span class="ribbon-btn-label">Right</span>
              </button>
              <button class="ribbon-btn medium" id="arr-dist-bottom" title="Distribute Bottom">
                <div class="ribbon-btn-icon">
                  <svg viewBox="0 0 16 16" fill="none"><rect x="2" y="1.5" width="12" height="1.5" fill="#3e9b8e"/><rect x="4" y="7" width="8" height="1.5" fill="#3e9b8e"/><rect x="2" y="13" width="12" height="1.5" fill="#3e9b8e"/></svg>
                </div>
                <span class="ribbon-btn-label">Bottom</span>
              </button>
            </div>
          </div>
          <div class="ribbon-group-label">Distribute</div>
        </div>

        <!-- Size Group -->
        <div class="ribbon-group">
          <div class="ribbon-group-content">
            <div class="ribbon-big-icon">
              <svg viewBox="0 0 32 32" fill="none">
                <rect x="4" y="4" width="24" height="24" rx="1" stroke="#4a86c8" stroke-width="1.5" stroke-dasharray="3 2"/>
                <rect x="8" y="8" width="10" height="10" fill="#4a86c8" opacity="0.3" stroke="#4a86c8" stroke-width="1"/>
                <rect x="14" y="14" width="10" height="10" fill="#4a86c8" opacity="0.3" stroke="#4a86c8" stroke-width="1"/>
              </svg>
            </div>
            <div class="ribbon-grid-col">
              <button class="ribbon-row-btn" id="arr-same-size" title="Same Size">
                <span>Same Size</span>
              </button>
              <button class="ribbon-row-btn" id="arr-same-width" title="Same Width">
                <span>Same Width</span>
              </button>
              <button class="ribbon-row-btn" id="arr-same-height" title="Same Height">
                <span>Same Height</span>
              </button>
            </div>
          </div>
          <div class="ribbon-group-label">Size</div>
        </div>

        <!-- Rotate Group -->
        <div class="ribbon-group">
          <div class="ribbon-group-content">
            <div class="ribbon-grid-col">
              <button class="ribbon-row-btn" id="arr-rotate-ccw" title="Rotate 90 CCW">
                <svg viewBox="0 0 16 16" fill="none"><path d="M3 8a5 5 0 019.5-2" stroke="#555" stroke-width="1.5"/><path d="M5 3L3 6l3 0" fill="#555"/></svg>
                <span>Rotate 90 CCW</span>
              </button>
              <button class="ribbon-row-btn" id="arr-rotate-cw" title="Rotate 90 CW">
                <svg viewBox="0 0 16 16" fill="none"><path d="M13 8a5 5 0 01-9.5-2" stroke="#555" stroke-width="1.5"/><path d="M11 3l2 3-3 0" fill="#555"/></svg>
                <span>Rotate 90 CW</span>
              </button>
              <button class="ribbon-row-btn" id="arr-rotate-180" title="Rotate 180">
                <svg viewBox="0 0 16 16" fill="none"><path d="M2 8a6 6 0 0112 0" stroke="#555" stroke-width="1.5"/><path d="M12 5l2 3-3 0" fill="#555"/><path d="M14 8a6 6 0 01-12 0" stroke="#555" stroke-width="1.5"/><path d="M4 11l-2-3 3 0" fill="#555"/></svg>
                <span>Rotate 180</span>
              </button>
            </div>
          </div>
          <div class="ribbon-group-label">Rotate</div>
        </div>

        <!-- Reflect Group -->
        <div class="ribbon-group">
          <div class="ribbon-group-content">
            <div class="ribbon-grid-col">
              <button class="ribbon-row-btn" id="arr-flip-h" title="Flip Horizontally">
                <svg viewBox="0 0 16 16" fill="none"><rect x="1" y="3" width="5" height="10" fill="#4a86c8" opacity="0.5"/><rect x="10" y="3" width="5" height="10" fill="#4a86c8" opacity="0.3" stroke="#4a86c8" stroke-width="0.5" stroke-dasharray="1 1"/><line x1="8" y1="1" x2="8" y2="15" stroke="#4a86c8" stroke-width="1" stroke-dasharray="2 1"/></svg>
                <span>Horizontally</span>
              </button>
              <button class="ribbon-row-btn" id="arr-flip-v" title="Flip Vertically">
                <svg viewBox="0 0 16 16" fill="none"><rect x="3" y="1" width="10" height="5" fill="#4a86c8" opacity="0.5"/><rect x="3" y="10" width="10" height="5" fill="#4a86c8" opacity="0.3" stroke="#4a86c8" stroke-width="0.5" stroke-dasharray="1 1"/><line x1="1" y1="8" x2="15" y2="8" stroke="#4a86c8" stroke-width="1" stroke-dasharray="2 1"/></svg>
                <span>Vertically</span>
              </button>
            </div>
          </div>
          <div class="ribbon-group-label">Reflect</div>
        </div>

        <!-- Z-Order Group -->
        <div class="ribbon-group">
          <div class="ribbon-group-content">
            <div class="ribbon-grid-col">
              <button class="ribbon-row-btn" id="arr-bring-forward" title="Bring Forward">
                <svg viewBox="0 0 16 16" fill="none"><rect x="1" y="5" width="8" height="8" fill="#aaa" stroke="#888" stroke-width="0.5"/><rect x="5" y="1" width="8" height="8" fill="#4a86c8" stroke="#3570a8" stroke-width="0.5"/><path d="M9 5v4H5" stroke="#3570a8" stroke-width="0.5"/></svg>
                <span>Bring Forward</span>
              </button>
              <button class="ribbon-row-btn" id="arr-bring-front" title="Bring to Front">
                <svg viewBox="0 0 16 16" fill="none"><rect x="1" y="7" width="7" height="7" fill="#ccc" stroke="#aaa" stroke-width="0.5"/><rect x="3" y="5" width="7" height="7" fill="#bbb" stroke="#999" stroke-width="0.5"/><rect x="5" y="1" width="9" height="9" fill="#4a86c8" stroke="#3570a8" stroke-width="0.5"/></svg>
                <span>Bring to Front</span>
              </button>
            </div>
            <div class="ribbon-grid-col">
              <button class="ribbon-row-btn" id="arr-send-backward" title="Send Backward">
                <svg viewBox="0 0 16 16" fill="none"><rect x="5" y="1" width="8" height="8" fill="#aaa" stroke="#888" stroke-width="0.5"/><rect x="1" y="5" width="8" height="8" fill="#4a86c8" stroke="#3570a8" stroke-width="0.5"/></svg>
                <span>Send Backward</span>
              </button>
              <button class="ribbon-row-btn" id="arr-send-back" title="Send to Back">
                <svg viewBox="0 0 16 16" fill="none"><rect x="5" y="1" width="9" height="9" fill="#ccc" stroke="#aaa" stroke-width="0.5"/><rect x="3" y="3" width="7" height="7" fill="#bbb" stroke="#999" stroke-width="0.5"/><rect x="1" y="5" width="7" height="7" fill="#4a86c8" stroke="#3570a8" stroke-width="0.5"/></svg>
                <span>Send to Back</span>
              </button>
            </div>
          </div>
          <div class="ribbon-group-label">Z-Order</div>
        </div>

        <!-- Transform Group -->
        <div class="ribbon-group">
          <div class="ribbon-group-content">
            <div class="ribbon-transform-grid">
              <div class="ribbon-transform-row">
                <label>X:</label>
                <input type="number" class="ribbon-transform-input" id="arr-pos-x" step="0.01">
                <span class="ribbon-transform-unit">mm</span>
                <label>W:</label>
                <input type="number" class="ribbon-transform-input" id="arr-size-w" step="0.01">
                <span class="ribbon-transform-unit">mm</span>
              </div>
              <div class="ribbon-transform-row">
                <label>Y:</label>
                <input type="number" class="ribbon-transform-input" id="arr-pos-y" step="0.01">
                <span class="ribbon-transform-unit">mm</span>
                <label>H:</label>
                <input type="number" class="ribbon-transform-input" id="arr-size-h" step="0.01">
                <span class="ribbon-transform-unit">mm</span>
              </div>
            </div>
          </div>
          <div class="ribbon-group-label">Transform</div>
        </div>

      </div>
    </div>

  </div>

  <!-- Document Tabs Bar -->
  <div class="document-tabs" id="document-tabs">
    <div class="document-tabs-empty" id="no-docs-message">No documents open</div>
  </div>

  <!-- Main Content -->
  <div class="content">
    <!-- Left Panel -->
    <div class="left-panel" id="left-panel">
      <div class="left-panel-tabs">
        <button class="left-panel-tab active" data-panel="thumbnails" title="Page Thumbnails">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="3" y="3" width="7" height="9" rx="1"/>
            <rect x="14" y="3" width="7" height="9" rx="1"/>
            <rect x="3" y="15" width="7" height="6" rx="1"/>
            <rect x="14" y="15" width="7" height="6" rx="1"/>
          </svg>
          <span>Pages</span>
        </button>
        <button class="left-panel-tab" data-panel="bookmarks" title="Bookmarks">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"/>
          </svg>
          <span>Bookmarks</span>
        </button>
        <button class="left-panel-tab" data-panel="annotations" title="Annotations">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
          </svg>
          <span>Annotations</span>
        </button>
        <button class="left-panel-tab" data-panel="attachments" title="Attachments">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48"/>
          </svg>
          <span>Attachments</span>
        </button>
        <button class="left-panel-tab" data-panel="signatures" title="Digital Signatures">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
          </svg>
          <span>Signatures</span>
        </button>
        <button class="left-panel-tab" data-panel="layers" title="Layers">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polygon points="12 2 2 7 12 12 22 7 12 2"/>
            <polyline points="2 17 12 22 22 17"/>
            <polyline points="2 12 12 17 22 12"/>
          </svg>
          <span>Layers</span>
        </button>
        <button class="left-panel-tab" data-panel="form-fields" title="Form Fields">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="3" y="3" width="18" height="18" rx="1"/>
            <line x1="7" y1="8" x2="17" y2="8"/>
            <line x1="7" y1="12" x2="17" y2="12"/>
            <line x1="7" y1="16" x2="12" y2="16"/>
          </svg>
          <span>Form Fields</span>
        </button>
        <button class="left-panel-tab" data-panel="destinations" title="Destinations">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="10" r="3"/>
            <path d="M12 21.7C17.3 17 20 13 20 10a8 8 0 1 0-16 0c0 3 2.7 7 8 11.7z"/>
          </svg>
          <span>Destinations</span>
        </button>
        <button class="left-panel-tab" data-panel="tags" title="Tags">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"/>
            <line x1="7" y1="7" x2="7.01" y2="7"/>
          </svg>
          <span>Tags</span>
        </button>
        <button class="left-panel-tab" data-panel="links" title="Links">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/>
            <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/>
          </svg>
          <span>Links</span>
        </button>
      </div>

      <div class="left-panel-body">
        <!-- Thumbnails Panel -->
        <div class="left-panel-content active" id="thumbnails-panel">
          <div class="left-panel-header">
            <span>Page Thumbnails</span>
          </div>
          <div class="thumbnails-container" id="thumbnails-container">
            <!-- Thumbnails will be dynamically added here -->
          </div>
        </div>

        <!-- Bookmarks Panel -->
        <div class="left-panel-content" id="bookmarks-panel">
          <div class="left-panel-header">
            <span>Bookmarks</span>
          </div>
          <div class="bookmarks-container" id="bookmarks-container">
            <div class="bookmarks-empty">No bookmarks in this document</div>
          </div>
        </div>

        <!-- Annotations Panel -->
        <div class="left-panel-content" id="annotations-panel">
          <div class="left-panel-header">
            <span>Annotations</span>
            <div class="annotations-filter">
              <select id="annotations-list-filter">
                <option value="all">All Pages</option>
                <option value="current">Current Page</option>
              </select>
            </div>
          </div>
          <div class="annotations-list-content" id="annotations-list-content">
            <!-- Annotation items dynamically added -->
          </div>
          <div class="annotations-list-count" id="annotations-list-count">0 annotations</div>
        </div>

        <!-- Attachments Panel -->
        <div class="left-panel-content" id="attachments-panel">
          <div class="left-panel-header">
            <span>Attachments</span>
          </div>
          <div class="attachments-toolbar" id="attachments-toolbar">
            <button class="attachments-toolbar-btn" id="attachments-add-btn" title="Add attachment">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
            </button>
            <button class="attachments-toolbar-btn" id="attachments-open-btn" title="Open attachment" disabled>
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/><polyline points="15 3 21 3 21 9"/><line x1="10" y1="14" x2="21" y2="3"/></svg>
            </button>
            <button class="attachments-toolbar-btn" id="attachments-save-btn" title="Save attachment" disabled>
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
            </button>
            <button class="attachments-toolbar-btn" id="attachments-save-all-btn" title="Save all attachments" disabled>
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/><line x1="3" y1="3" x2="8" y2="3"/></svg>
            </button>
            <button class="attachments-toolbar-btn" id="attachments-delete-btn" title="Delete attachment" disabled>
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>
            </button>
          </div>
          <div class="attachments-container" id="attachments-container">
            <div class="attachments-empty">No attachments in this document</div>
          </div>
          <div class="attachments-count" id="attachments-count">0 attachments</div>
        </div>

        <!-- Signatures Panel -->
        <div class="left-panel-content" id="signatures-panel">
          <div class="left-panel-header">
            <span>Digital Signatures</span>
          </div>
          <div class="signatures-container" id="signatures-container">
            <div class="signatures-empty">No digital signatures in this document</div>
          </div>
          <div class="signatures-count" id="signatures-count">0 signatures</div>
        </div>

        <!-- Layers Panel -->
        <div class="left-panel-content" id="layers-panel">
          <div class="left-panel-header">
            <span>Layers</span>
          </div>
          <div class="layers-container" id="layers-container">
            <div class="layers-empty">No layers in this document</div>
          </div>
          <div class="layers-count" id="layers-count">0 layers</div>
        </div>

        <!-- Form Fields Panel -->
        <div class="left-panel-content" id="form-fields-panel">
          <div class="left-panel-header">
            <span>Form Fields</span>
          </div>
          <div class="form-fields-container" id="form-fields-container">
            <div class="form-fields-empty">No form fields in this document</div>
          </div>
          <div class="form-fields-count" id="form-fields-count">0 fields</div>
        </div>

        <!-- Destinations Panel -->
        <div class="left-panel-content" id="destinations-panel">
          <div class="left-panel-header">
            <span>Destinations</span>
          </div>
          <div class="destinations-container" id="destinations-container">
            <div class="destinations-empty">No named destinations in this document</div>
          </div>
          <div class="destinations-count" id="destinations-count">0 destinations</div>
        </div>

        <!-- Tags Panel -->
        <div class="left-panel-content" id="tags-panel">
          <div class="left-panel-header">
            <span>Tags</span>
          </div>
          <div class="tags-container" id="tags-container">
            <div class="tags-empty">No structure tags in this document</div>
          </div>
          <div class="tags-count" id="tags-count">0 tags</div>
        </div>

        <!-- Links Panel -->
        <div class="left-panel-content" id="links-panel">
          <div class="left-panel-header">
            <span>Links</span>
            <div class="links-filter">
              <select id="links-filter">
                <option value="all">All Pages</option>
                <option value="current">Current Page</option>
                <option value="external">External Only</option>
                <option value="internal">Internal Only</option>
              </select>
            </div>
          </div>
          <div class="links-toolbar" id="links-toolbar">
            <button class="links-toolbar-btn" id="links-goto-btn" title="Go to link source page" disabled>
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 12h14"/><polyline points="12 5 19 12 12 19"/></svg>
            </button>
            <button class="links-toolbar-btn" id="links-open-btn" title="Open external URL" disabled>
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/><polyline points="15 3 21 3 21 9"/><line x1="10" y1="14" x2="21" y2="3"/></svg>
            </button>
            <button class="links-toolbar-btn" id="links-copy-btn" title="Copy link URL" disabled>
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="1"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>
            </button>
            <button class="links-toolbar-btn" id="links-export-btn" title="Export all links to CSV">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
            </button>
          </div>
          <div class="links-container" id="links-container">
            <div class="links-empty">No links in this document</div>
          </div>
          <div class="links-count" id="links-count">0 links</div>
        </div>

      </div>

      <button class="left-panel-toggle" id="left-panel-toggle" title="Toggle Panel">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="15 18 9 12 15 6"/>
        </svg>
      </button>
    </div>

    <div class="panel-resize-handle" id="left-panel-resize"></div>

    <div class="main-view">
      <!-- Find Bar -->
      <div id="find-bar" class="find-bar">
        <button id="find-close-btn" class="find-close-btn" title="Close (Esc)">&times;</button>
        <div class="find-input-container">
          <input type="text" id="find-input" class="find-input" placeholder="Find in document..." autocomplete="off">
        </div>
        <div class="find-nav-buttons">
          <button id="find-prev-btn" class="find-nav-btn" title="Previous (Shift+Enter)" disabled>
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M15 18l-6-6 6-6"/>
            </svg>
          </button>
          <button id="find-next-btn" class="find-nav-btn" title="Next (Enter)" disabled>
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M9 18l6-6-6-6"/>
            </svg>
          </button>
        </div>
        <span id="find-results-count" class="find-results-count"></span>
        <span id="find-message" class="find-message"></span>
        <div class="find-options">
          <label class="find-option">
            <input type="checkbox" id="find-match-case">
            <span>Match case</span>
          </label>
          <label class="find-option">
            <input type="checkbox" id="find-whole-word">
            <span>Whole words</span>
          </label>
          <label class="find-option">
            <input type="checkbox" id="find-highlight-all" checked>
            <span>Highlight all</span>
          </label>
        </div>
      </div>

      <div id="placeholder">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z" />
        </svg>
        <h2>No PDF Selected</h2>
        <p>Click "Open PDF" to browse and annotate a PDF</p>
      </div>

      <div id="form-fields-bar" class="form-fields-bar" style="display: none;">
        <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M8 1C4.13 1 1 4.13 1 8s3.13 7 7 7 7-3.13 7-7-3.13-7-7-7zm.5 11h-1V7h1v5zm0-6.5h-1v-1h1v1z" fill="#0066cc"/>
        </svg>
        <span>This document contains interactive form fields. You can fill in the form and save your data.</span>
        <button id="form-fields-bar-close" title="Close">&times;</button>
      </div>

      <div id="pdf-container">
        <div id="canvas-wrapper">
          <!-- Single page mode -->
          <div id="canvas-container" class="single-page-container">
            <canvas id="pdf-canvas"></canvas>
            <canvas id="annotation-canvas"></canvas>
          </div>
          <!-- Continuous mode -->
          <div id="continuous-container" class="continuous-container">
            <!-- Pages will be dynamically added here -->
          </div>
        </div>
      </div>
    </div>

    <!-- Properties Panel -->
    <div class="properties-panel" id="properties-panel">
      <div id="prop-panel-header" class="prop-panel-header">
        <h3 style="margin: 0; padding: 8px 0; background: none;">Properties</h3>
        <button id="prop-panel-close" class="prop-panel-close-btn" title="Close">&times;</button>
      </div>
      <div id="prop-no-selection" style="display: none;">
        <div class="property-section">
          <div class="property-section-header">Document <span class="collapse-arrow">&#9660;</span></div>
          <div class="property-section-content">
          <div class="property-group"><label>File</label><span id="doc-info-filename" class="prop-info-value" style="word-break: break-all;">-</span></div>
          <div class="property-group"><label>Path</label><span id="doc-info-filepath" class="prop-info-secondary" style="word-break: break-all;">-</span></div>
          <div class="property-group"><label>Pages</label><span id="doc-info-pages" class="prop-info-value">-</span></div>
          <div class="property-group"><label>Page Size</label><span id="doc-info-pagesize" class="prop-info-value">-</span></div>
          </div>
        </div>
        <div class="property-section">
          <div class="property-section-header">Metadata <span class="collapse-arrow">&#9660;</span></div>
          <div class="property-section-content">
          <div class="property-group"><label>Title</label><span id="doc-info-title" class="prop-info-value">-</span></div>
          <div class="property-group"><label>Author</label><span id="doc-info-author" class="prop-info-value">-</span></div>
          <div class="property-group"><label>Subject</label><span id="doc-info-subject" class="prop-info-value">-</span></div>
          <div class="property-group"><label>Creator</label><span id="doc-info-creator" class="prop-info-value">-</span></div>
          <div class="property-group"><label>Producer</label><span id="doc-info-producer" class="prop-info-value">-</span></div>
          <div class="property-group"><label>PDF Version</label><span id="doc-info-version" class="prop-info-value">-</span></div>
          </div>
        </div>
        <div class="property-section">
          <div class="property-section-header">Annotations <span class="collapse-arrow">&#9660;</span></div>
          <div class="property-section-content">
          <div class="property-group"><label>Total</label><span id="doc-info-annot-count" class="prop-info-value">0</span></div>
          <div class="property-group"><label>On Page</label><span id="doc-info-annot-page" class="prop-info-value">0</span></div>
          </div>
        </div>
        <div class="prop-hint-text">Select an annotation to edit its properties</div>
      </div>

      <!-- General Section -->
      <div class="property-section" id="prop-general-section">
        <div class="property-section-header">General <span class="collapse-arrow">&#9660;</span></div>
        <div class="property-section-content">

        <div class="property-group" id="prop-type-group">
          <label>Type</label>
          <input type="text" id="prop-type" readonly>
        </div>

        <div class="property-group" id="prop-subject-group">
          <label>Subject</label>
          <input type="text" id="prop-subject" placeholder="Enter subject...">
        </div>

        <div class="property-group" id="prop-author-group">
          <label>Author</label>
          <input type="text" id="prop-author">
        </div>

        <div class="property-group" id="prop-created-group">
          <label>Created</label>
          <input type="text" id="prop-created" readonly class="prop-date">
        </div>

        <div class="property-group" id="prop-modified-group">
          <label>Modified</label>
          <input type="text" id="prop-modified" readonly class="prop-date">
        </div>

        <div class="property-group" id="prop-locked-group">
          <label>Locked</label>
          <select id="prop-locked">
            <option value="no">No</option>
            <option value="yes">Yes</option>
          </select>
        </div>

        <div class="property-group" id="prop-printable-group">
          <label>Printable</label>
          <select id="prop-printable">
            <option value="yes">Yes</option>
            <option value="no">No</option>
          </select>
        </div>

        <div class="property-group" id="prop-readonly-group">
          <label>Read Only</label>
          <select id="prop-readonly">
            <option value="no">No</option>
            <option value="yes">Yes</option>
          </select>
        </div>

        <div class="property-group" id="prop-marked-group">
          <label>Marked</label>
          <select id="prop-marked">
            <option value="no">No</option>
            <option value="yes">Yes</option>
          </select>
        </div>

        <div class="property-group" id="prop-alt-text-group">
          <label>Alt Text</label>
          <textarea id="prop-alt-text" rows="2" placeholder="Description for accessibility..." style="width: 100%; resize: vertical; font-size: 12px;"></textarea>
        </div>

        <div class="property-group" id="prop-status-group">
          <label>Status</label>
          <select id="prop-status">
            <option value="none">None</option>
            <option value="accepted">Accepted</option>
            <option value="rejected">Rejected</option>
            <option value="cancelled">Cancelled</option>
            <option value="completed">Completed</option>
            <option value="reviewed">Reviewed</option>
          </select>
        </div>
        </div>
      </div>

      <!-- Replies Section -->
      <div class="property-section" id="prop-replies-section" style="display: none;">
        <div class="property-section-header">Replies <span class="collapse-arrow">&#9660;</span></div>
        <div class="property-section-content">
        <div id="prop-replies-list" class="prop-replies-list"></div>
        <div class="prop-reply-row">
          <input type="text" id="prop-reply-input" class="prop-reply-input" placeholder="Add a reply...">
          <button id="prop-reply-add" class="prop-reply-add-btn">Add</button>
        </div>
        </div>
      </div>

      <!-- Appearance Section -->
      <div class="property-section" id="prop-appearance-section">
        <div class="property-section-header">Appearance <span class="collapse-arrow">&#9660;</span></div>
        <div class="property-section-content">

        <div class="property-group" id="prop-icon-group" style="display: none;">
          <label>Icon</label>
          <select id="prop-icon">
            <option value="comment">Comment</option>
            <option value="note">Note</option>
            <option value="help">Help</option>
            <option value="insert">Insert</option>
            <option value="key">Key</option>
            <option value="newparagraph">New Paragraph</option>
            <option value="paragraph">Paragraph</option>
            <option value="check">Check</option>
            <option value="circle">Circle</option>
            <option value="cross">Cross</option>
            <option value="star">Star</option>
          </select>
        </div>

        <div class="property-group" id="prop-fill-color-group" style="display: none;">
          <label>Fill Color</label>
          <div class="color-palette-wrapper" id="fill-color-wrapper">
            <button type="button" class="color-picker-button" id="fill-color-btn">
              <div class="color-preview" id="prop-fill-color-preview"></div>
              <span class="color-hex" id="prop-fill-color-hex">#FFFF00</span>
              <svg class="dropdown-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M6 9l6 6 6-6"/>
              </svg>
            </button>
            <div class="color-palette-dropdown" id="fill-color-dropdown">
              <button type="button" class="color-none-btn" id="fill-color-none-btn">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="12" cy="12" r="10"/>
                  <line x1="4" y1="4" x2="20" y2="20"/>
                </svg>
                None
              </button>
              <div class="color-palette" id="fill-color-palette"></div>
              <button type="button" class="color-custom-btn" id="fill-color-custom-btn">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="12" cy="12" r="10"/>
                  <path d="M12 2a10 10 0 0 1 0 20"/>
                </svg>
                More Colors...
              </button>
            </div>
            <input type="color" id="prop-fill-color">
          </div>
        </div>

        <div class="property-group" id="prop-stroke-color-group" style="display: none;">
          <label>Stroke Color</label>
          <div class="color-palette-wrapper" id="stroke-color-wrapper">
            <button type="button" class="color-picker-button" id="stroke-color-btn">
              <div class="color-preview" id="prop-stroke-color-preview"></div>
              <span class="color-hex" id="prop-stroke-color-hex">#000000</span>
              <svg class="dropdown-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M6 9l6 6 6-6"/>
              </svg>
            </button>
            <div class="color-palette-dropdown" id="stroke-color-dropdown">
              <div class="color-palette" id="stroke-color-palette"></div>
              <button type="button" class="color-custom-btn" id="stroke-color-custom-btn">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="12" cy="12" r="10"/>
                  <path d="M12 2a10 10 0 0 1 0 20"/>
                </svg>
                More Colors...
              </button>
            </div>
            <input type="color" id="prop-stroke-color">
          </div>
        </div>

        <div class="property-group" id="prop-color-group">
          <label>Color</label>
          <div class="color-palette-wrapper" id="main-color-wrapper">
            <button type="button" class="color-picker-button" id="main-color-btn">
              <div class="color-preview" id="prop-color-preview"></div>
              <span class="color-hex" id="prop-color-hex">#000000</span>
              <svg class="dropdown-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M6 9l6 6 6-6"/>
              </svg>
            </button>
            <div class="color-palette-dropdown" id="main-color-dropdown">
              <div class="color-palette" id="main-color-palette"></div>
              <button type="button" class="color-custom-btn" id="main-color-custom-btn">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="12" cy="12" r="10"/>
                  <path d="M12 2a10 10 0 0 1 0 20"/>
                </svg>
                More Colors...
              </button>
            </div>
            <input type="color" id="prop-color">
          </div>
        </div>

        <div class="property-group" id="prop-opacity-group">
          <label>Opacity</label>
          <div class="opacity-slider-wrapper">
            <input type="range" id="prop-opacity" min="0" max="100" value="100">
            <span id="prop-opacity-value">100%</span>
          </div>
        </div>

        <div class="property-group" id="prop-line-width-group">
          <label>Line Width</label>
          <select id="prop-line-width" class="ribbon-input">
            <option value="0">0</option>
            <option value="0.5">0.5</option>
            <option value="1">1</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="6">6</option>
            <option value="8">8</option>
            <option value="10">10</option>
            <option value="12">12</option>
          </select>
        </div>

        <div class="property-group" id="prop-border-style-group" style="display: none;">
          <label>Border Style</label>
          <select id="prop-border-style">
            <option value="solid">Solid</option>
            <option value="dashed">Dashed</option>
            <option value="dotted">Dotted</option>
          </select>
        </div>
        </div>
      </div>

      <!-- Line Endings Section (for arrow) -->
      <div class="property-section" id="prop-line-endings-section" style="display: none;">
        <div class="property-section-header">Line Endings <span class="collapse-arrow">&#9660;</span></div>
        <div class="property-section-content">

        <div class="property-group" id="prop-arrow-start-group">
          <label>Start</label>
          <select id="prop-arrow-start">
            <option value="none">None</option>
            <option value="open">Open Arrow</option>
            <option value="closed">Closed Arrow</option>
            <option value="diamond">Diamond</option>
            <option value="circle">Circle</option>
            <option value="square">Square</option>
            <option value="slash">Slash</option>
          </select>
        </div>

        <div class="property-group" id="prop-arrow-end-group">
          <label>End</label>
          <select id="prop-arrow-end">
            <option value="none">None</option>
            <option value="open" selected>Open Arrow</option>
            <option value="closed">Closed Arrow</option>
            <option value="diamond">Diamond</option>
            <option value="circle">Circle</option>
            <option value="square">Square</option>
            <option value="slash">Slash</option>
          </select>
        </div>

        <div class="property-group" id="prop-arrow-head-size-group">
          <label>Head Size</label>
          <input type="number" id="prop-arrow-head-size" min="4" max="40" value="12">
        </div>
        </div>
      </div>

      <!-- Size & Dimensions Section (for arrow) -->
      <div class="property-section" id="prop-dimensions-section" style="display: none;">
        <div class="property-section-header">Size & Dimensions <span class="collapse-arrow">&#9660;</span></div>
        <div class="property-section-content">

        <div class="property-group" id="prop-arrow-length-group">
          <label>Length</label>
          <input type="text" id="prop-arrow-length" readonly>
        </div>
        </div>
      </div>

      <!-- Text Formatting Section (for textbox/callout) -->
      <div class="property-section" id="prop-text-format-section" style="display: none;">
        <div class="property-section-header">Character <span class="collapse-arrow">&#9660;</span></div>
        <div class="property-section-content">

        <div class="property-group">
          <label>Text Color</label>
          <div class="color-palette-wrapper" id="text-color-wrapper">
            <button type="button" class="color-picker-button" id="text-color-btn">
              <div class="color-preview" id="prop-text-color-preview"></div>
              <span class="color-hex" id="prop-text-color-hex">#000000</span>
              <svg class="dropdown-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M6 9l6 6 6-6"/>
              </svg>
            </button>
            <div class="color-palette-dropdown" id="text-color-dropdown">
              <div class="color-palette" id="text-color-palette"></div>
              <button type="button" class="color-custom-btn" id="text-color-custom-btn">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="12" cy="12" r="10"/>
                  <path d="M12 2a10 10 0 0 1 0 20"/>
                </svg>
                More Colors...
              </button>
            </div>
            <input type="color" id="prop-text-color" value="#000000">
          </div>
        </div>

        <div class="property-group">
          <label>Font</label>
          <select id="prop-font-family">
            <option value="Arial">Arial</option>
          </select>
        </div>

        <div class="property-group">
          <label>Font Size</label>
          <select id="prop-text-font-size">
            <option value="8">8 pt</option>
            <option value="9">9 pt</option>
            <option value="10">10 pt</option>
            <option value="11">11 pt</option>
            <option value="12">12 pt</option>
            <option value="14" selected>14 pt</option>
            <option value="16">16 pt</option>
            <option value="18">18 pt</option>
            <option value="20">20 pt</option>
            <option value="24">24 pt</option>
            <option value="28">28 pt</option>
            <option value="32">32 pt</option>
            <option value="36">36 pt</option>
            <option value="48">48 pt</option>
            <option value="72">72 pt</option>
          </select>
        </div>

        <div class="property-group">
          <label>Style</label>
          <div class="text-style-buttons">
            <button type="button" class="text-style-btn" id="prop-text-bold" title="Bold">
              <strong>B</strong>
            </button>
            <button type="button" class="text-style-btn" id="prop-text-italic" title="Italic">
              <em>I</em>
            </button>
            <button type="button" class="text-style-btn" id="prop-text-underline" title="Underline">
              <u>U</u>
            </button>
            <button type="button" class="text-style-btn" id="prop-text-strikethrough" title="Strikethrough">
              <s>S</s>
            </button>
          </div>
        </div>
        </div>
      </div>

      <!-- Paragraph Section (for textbox/callout) -->
      <div class="property-section" id="prop-paragraph-section" style="display: none;">
        <div class="property-section-header">Paragraph <span class="collapse-arrow">&#9660;</span></div>
        <div class="property-section-content">

        <div class="property-group">
          <label>Text Alignment</label>
          <div class="text-align-buttons">
            <button type="button" class="text-align-btn active" id="prop-align-left" title="Align Left">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M3 6h18M3 12h12M3 18h18"/>
              </svg>
            </button>
            <button type="button" class="text-align-btn" id="prop-align-center" title="Align Center">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M3 6h18M6 12h12M3 18h18"/>
              </svg>
            </button>
            <button type="button" class="text-align-btn" id="prop-align-right" title="Align Right">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M3 6h18M9 12h12M3 18h18"/>
              </svg>
            </button>
          </div>
        </div>

        <div class="property-group">
          <label>Line Spacing</label>
          <select id="prop-line-spacing">
            <option value="1">1x</option>
            <option value="1.15">1.15x</option>
            <option value="1.5" selected>1.5x</option>
            <option value="2">2x</option>
            <option value="2.5">2.5x</option>
            <option value="3">3x</option>
          </select>
        </div>

        <div class="property-group">
          <label>Rotation</label>
          <div style="display: flex; align-items: center; gap: 4px;">
            <input type="number" id="prop-textbox-rotation" min="-360" max="360" step="1" style="flex: 1;">
            <span style="font-size: 11px; color: var(--theme-text-secondary);">&deg;</span>
          </div>
        </div>
        </div>
      </div>

      <!-- Content Section (for text/comments) -->
      <div class="property-section" id="prop-content-section" style="display: none;">
        <div class="property-section-header">Content <span class="collapse-arrow">&#9660;</span></div>
        <div class="property-section-content">

        <div class="property-group" id="prop-text-group">
          <label>Text</label>
          <textarea id="prop-text" rows="4"></textarea>
        </div>

        <div class="property-group" id="prop-font-size-group" style="display: none;">
          <label>Font Size</label>
          <input type="number" id="prop-font-size" min="8" max="72">
        </div>
        </div>
      </div>

      <!-- Image Section -->
      <div class="property-section" id="prop-image-section" style="display: none;">
        <div class="property-section-header">Image <span class="collapse-arrow">&#9660;</span></div>
        <div class="property-section-content">

        <div class="property-group">
          <label>Width</label>
          <input type="number" id="prop-image-width" min="20" max="2000">
        </div>

        <div class="property-group">
          <label>Height</label>
          <input type="number" id="prop-image-height" min="20" max="2000">
        </div>

        <div class="property-group">
          <label>Rotation</label>
          <input type="number" id="prop-image-rotation" min="-360" max="360" step="1">
        </div>

        <div class="property-group property-group-full">
          <button type="button" class="property-btn secondary" id="prop-image-reset">Reset to Original Size</button>
        </div>
        </div>
      </div>

      <div class="property-actions" id="prop-actions-section">
      </div>
    </div>
  </div>

  <!-- Status Bar -->
  <div class="status-bar">
    <div class="status-bar-left">
      <div class="status-item">
        <span class="status-item-label">Tool:</span>
        <span class="status-item-value" id="status-tool">Select</span>
      </div>
      <div class="status-separator"></div>
      <div class="status-item">
        <span class="status-item-label">Annotations:</span>
        <span class="status-item-value" id="status-annotations">0</span>
      </div>
    </div>
    <div class="status-bar-center" id="pdf-controls" style="display: none;">
      <button class="status-nav-btn" id="first-page" title="First Page">
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 19l-7-7 7-7M18 19l-7-7 7-7"/>
        </svg>
      </button>
      <button class="status-nav-btn" id="prev-page" title="Previous Page">
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
        </svg>
      </button>
      <span class="status-page-info" id="page-info">Page <input type="number" class="status-page-input" id="page-input" value="1" min="1"> / <span id="page-total">1</span></span>
      <button class="status-nav-btn" id="next-page" title="Next Page">
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
        </svg>
      </button>
      <button class="status-nav-btn" id="last-page" title="Last Page">
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 5l7 7-7 7M6 5l7 7-7 7"/>
        </svg>
      </button>
      <div class="status-zoom-controls">
        <button class="status-nav-btn" id="zoom-out" title="Zoom Out">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 12H4"/>
          </svg>
        </button>
        <input type="text" class="status-zoom-input" id="zoom-input" value="150%">
        <button class="status-nav-btn" id="zoom-in" title="Zoom In">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
          </svg>
        </button>
      </div>
    </div>
    <div class="status-bar-right">
      <div class="status-item" id="status-message">Ready</div>
    </div>
  </div>

  <!-- Page Controls (hidden - moved to status bar) -->
  <div class="page-controls" id="page-controls" style="display: none !important;">
    <button class="page-btn" id="prev-page-old">Previous</button>
    <span class="page-info" id="page-info-old">Page 1 / 1</span>
    <button class="page-btn" id="next-page-old">Next</button>
    <div class="zoom-controls">
      <span style="font-size: 12px;">Zoom:</span>
      <button class="page-btn" id="zoom-out-old">-</button>
      <span id="zoom-level-old" style="font-size: 12px;">150%</span>
      <button class="page-btn" id="zoom-in-old">+</button>
    </div>
  </div>

  <!-- Document Properties Dialog -->
  <div class="doc-props-overlay" id="doc-props-dialog">
    <div class="doc-props-dialog">
      <div class="doc-props-header">
        <h2>Document Properties</h2>
        <button class="doc-props-close-btn" id="doc-props-close-btn">&times;</button>
      </div>
      <div class="doc-props-content">
        <div class="doc-props-section">
          <h3>File</h3>
          <div class="doc-props-row">
            <span class="doc-props-label">File Name:</span>
            <span class="doc-props-value" id="doc-prop-filename">-</span>
          </div>
          <div class="doc-props-row">
            <span class="doc-props-label">File Path:</span>
            <span class="doc-props-value" id="doc-prop-filepath">-</span>
          </div>
          <div class="doc-props-row">
            <span class="doc-props-label">File Size:</span>
            <span class="doc-props-value" id="doc-prop-filesize">-</span>
          </div>
        </div>
        <div class="doc-props-section">
          <h3>Document</h3>
          <div class="doc-props-row">
            <span class="doc-props-label">Title:</span>
            <span class="doc-props-value" id="doc-prop-title">-</span>
          </div>
          <div class="doc-props-row">
            <span class="doc-props-label">Author:</span>
            <span class="doc-props-value" id="doc-prop-author">-</span>
          </div>
          <div class="doc-props-row">
            <span class="doc-props-label">Subject:</span>
            <span class="doc-props-value" id="doc-prop-subject">-</span>
          </div>
          <div class="doc-props-row">
            <span class="doc-props-label">Keywords:</span>
            <span class="doc-props-value" id="doc-prop-keywords">-</span>
          </div>
          <div class="doc-props-row">
            <span class="doc-props-label">Creator:</span>
            <span class="doc-props-value" id="doc-prop-creator">-</span>
          </div>
          <div class="doc-props-row">
            <span class="doc-props-label">Producer:</span>
            <span class="doc-props-value" id="doc-prop-producer">-</span>
          </div>
        </div>
        <div class="doc-props-section">
          <h3>PDF Information</h3>
          <div class="doc-props-row">
            <span class="doc-props-label">PDF Version:</span>
            <span class="doc-props-value" id="doc-prop-pdfversion">-</span>
          </div>
          <div class="doc-props-row">
            <span class="doc-props-label">Page Count:</span>
            <span class="doc-props-value" id="doc-prop-pagecount">-</span>
          </div>
          <div class="doc-props-row">
            <span class="doc-props-label">Page Size:</span>
            <span class="doc-props-value" id="doc-prop-pagesize">-</span>
          </div>
          <div class="doc-props-row">
            <span class="doc-props-label">Creation Date:</span>
            <span class="doc-props-value" id="doc-prop-created">-</span>
          </div>
          <div class="doc-props-row">
            <span class="doc-props-label">Modified Date:</span>
            <span class="doc-props-value" id="doc-prop-modified">-</span>
          </div>
        </div>
      </div>
      <div class="doc-props-footer">
        <button id="doc-props-ok-btn">OK</button>
      </div>
    </div>
  </div>

  <!-- New Document Dialog -->
  <div class="new-doc-overlay" id="new-doc-dialog">
    <div class="new-doc-dialog">
      <div class="new-doc-header">
        <h2>New Document</h2>
        <button class="new-doc-close-btn" id="new-doc-close-btn">&times;</button>
      </div>
      <div class="new-doc-content">
        <div class="new-doc-form">
          <div class="new-doc-row">
            <label class="new-doc-label">Paper Size:</label>
            <select id="new-doc-paper-size" class="new-doc-select">
              <optgroup label="ISO A Series">
                <option value="a0">A0 (841 x 1189 mm)</option>
                <option value="a1">A1 (594 x 841 mm)</option>
                <option value="a2">A2 (420 x 594 mm)</option>
                <option value="a3">A3 (297 x 420 mm)</option>
                <option value="a4" selected>A4 (210 x 297 mm)</option>
                <option value="a5">A5 (148 x 210 mm)</option>
                <option value="a6">A6 (105 x 148 mm)</option>
              </optgroup>
              <optgroup label="ISO B Series">
                <option value="b3">B3 (353 x 500 mm)</option>
                <option value="b4">B4 (250 x 353 mm)</option>
                <option value="b5">B5 (176 x 250 mm)</option>
              </optgroup>
              <optgroup label="North American">
                <option value="letter">Letter (8.5 x 11 in)</option>
                <option value="legal">Legal (8.5 x 14 in)</option>
                <option value="tabloid">Tabloid (11 x 17 in)</option>
                <option value="ledger">Ledger (17 x 11 in)</option>
              </optgroup>
              <optgroup label="Other">
                <option value="custom">Custom...</option>
              </optgroup>
            </select>
          </div>
          <div class="new-doc-row new-doc-custom-row" id="new-doc-custom-row" style="display:none;">
            <label class="new-doc-label">Width (mm):</label>
            <input type="number" id="new-doc-custom-width" class="new-doc-input" value="210" min="10" max="5000" step="1">
            <label class="new-doc-label new-doc-label-inline">Height (mm):</label>
            <input type="number" id="new-doc-custom-height" class="new-doc-input" value="297" min="10" max="5000" step="1">
          </div>
          <div class="new-doc-row">
            <label class="new-doc-label">Orientation:</label>
            <div class="new-doc-radio-group">
              <label class="new-doc-radio-label">
                <input type="radio" name="new-doc-orientation" value="portrait" checked> Portrait
              </label>
              <label class="new-doc-radio-label">
                <input type="radio" name="new-doc-orientation" value="landscape"> Landscape
              </label>
            </div>
          </div>
          <div class="new-doc-row">
            <label class="new-doc-label">Pages:</label>
            <input type="number" id="new-doc-pages" class="new-doc-input" value="1" min="1" max="999" step="1">
          </div>
        </div>
        <div class="new-doc-preview-area">
          <div class="new-doc-preview-box" id="new-doc-preview-box">
            <div class="new-doc-preview-page" id="new-doc-preview-page"></div>
          </div>
          <div class="new-doc-preview-text" id="new-doc-preview-text">210 x 297 mm (A4)</div>
        </div>
      </div>
      <div class="new-doc-footer">
        <div></div>
        <div class="new-doc-footer-right">
          <button class="pref-btn pref-btn-primary" id="new-doc-ok-btn">OK</button>
          <button class="pref-btn pref-btn-secondary" id="new-doc-cancel-btn">Cancel</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Insert Page Dialog -->
  <div class="insert-page-overlay" id="insert-page-dialog">
    <div class="insert-page-dialog">
      <div class="insert-page-header">
        <h2>Insert Pages</h2>
        <button class="insert-page-close-btn" id="insert-page-close-btn">&times;</button>
      </div>
      <div class="insert-page-content">
        <div class="insert-page-form">
          <div class="insert-page-row">
            <label class="insert-page-label">Position:</label>
            <select id="insert-page-position" class="insert-page-select">
              <option value="after">After current page</option>
              <option value="before">Before current page</option>
              <option value="start">At the beginning</option>
              <option value="end">At the end</option>
            </select>
          </div>
          <div class="insert-page-row">
            <label class="insert-page-label">Count:</label>
            <input type="number" id="insert-page-count" class="insert-page-input" value="1" min="1" max="100" step="1">
          </div>
          <div class="insert-page-row">
            <label class="insert-page-label">Paper Size:</label>
            <select id="insert-page-paper-size" class="insert-page-select">
              <option value="current">Same as current page</option>
              <optgroup label="ISO A Series">
                <option value="a0">A0 (841 x 1189 mm)</option>
                <option value="a1">A1 (594 x 841 mm)</option>
                <option value="a2">A2 (420 x 594 mm)</option>
                <option value="a3">A3 (297 x 420 mm)</option>
                <option value="a4">A4 (210 x 297 mm)</option>
                <option value="a5">A5 (148 x 210 mm)</option>
                <option value="a6">A6 (105 x 148 mm)</option>
              </optgroup>
              <optgroup label="ISO B Series">
                <option value="b3">B3 (353 x 500 mm)</option>
                <option value="b4">B4 (250 x 353 mm)</option>
                <option value="b5">B5 (176 x 250 mm)</option>
              </optgroup>
              <optgroup label="North American">
                <option value="letter">Letter (8.5 x 11 in)</option>
                <option value="legal">Legal (8.5 x 14 in)</option>
                <option value="tabloid">Tabloid (11 x 17 in)</option>
                <option value="ledger">Ledger (17 x 11 in)</option>
              </optgroup>
            </select>
          </div>
        </div>
      </div>
      <div class="insert-page-footer">
        <div></div>
        <div class="insert-page-footer-right">
          <button class="pref-btn pref-btn-primary" id="insert-page-ok-btn">OK</button>
          <button class="pref-btn pref-btn-secondary" id="insert-page-cancel-btn">Cancel</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Extract Pages Dialog -->
  <div class="extract-pages-overlay" id="extract-pages-dialog">
    <div class="extract-pages-dialog">
      <div class="extract-pages-header">
        <h2>Extract Pages</h2>
        <button class="extract-pages-close-btn" id="extract-pages-close-btn">&times;</button>
      </div>
      <div class="extract-pages-content">
        <div class="extract-pages-form">
          <div class="extract-pages-row">
            <label class="extract-pages-label">Page Range:</label>
            <input type="text" id="extract-pages-range" class="extract-pages-input-wide" placeholder="e.g. 1-3, 5, 8-10">
          </div>
          <div class="extract-pages-row extract-pages-info" id="extract-pages-info"></div>
          <div class="extract-pages-row extract-pages-checkbox-row">
            <label class="extract-pages-checkbox-label">
              <input type="checkbox" id="extract-pages-delete"> Delete pages from source after extraction
            </label>
          </div>
        </div>
      </div>
      <div class="extract-pages-footer">
        <div></div>
        <div class="extract-pages-footer-right">
          <button class="pref-btn pref-btn-primary" id="extract-pages-ok-btn">Extract</button>
          <button class="pref-btn pref-btn-secondary" id="extract-pages-cancel-btn">Cancel</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Merge PDFs Dialog -->
  <div class="merge-pdfs-overlay" id="merge-pdfs-dialog">
    <div class="merge-pdfs-dialog">
      <div class="merge-pdfs-header">
        <h2>Merge PDFs</h2>
        <button class="merge-pdfs-close-btn" id="merge-pdfs-close-btn">&times;</button>
      </div>
      <div class="merge-pdfs-content">
        <div class="merge-pdfs-form">
          <div class="merge-pdfs-row">
            <label class="merge-pdfs-label">Insert at:</label>
            <select id="merge-pdfs-position" class="merge-pdfs-select">
              <option value="end">End of document</option>
              <option value="after">After current page</option>
              <option value="start">Beginning of document</option>
            </select>
          </div>
          <div class="merge-pdfs-file-section">
            <div class="merge-pdfs-file-toolbar">
              <span class="merge-pdfs-file-toolbar-label">Files to merge:</span>
              <div class="merge-pdfs-file-toolbar-btns">
                <button class="merge-pdfs-toolbar-btn" id="merge-pdfs-add-btn" title="Add files">
                  <svg width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/></svg>
                </button>
                <button class="merge-pdfs-toolbar-btn" id="merge-pdfs-remove-btn" title="Remove selected">
                  <svg width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 12H4"/></svg>
                </button>
                <button class="merge-pdfs-toolbar-btn" id="merge-pdfs-up-btn" title="Move up">
                  <svg width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7"/></svg>
                </button>
                <button class="merge-pdfs-toolbar-btn" id="merge-pdfs-down-btn" title="Move down">
                  <svg width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/></svg>
                </button>
              </div>
            </div>
            <div class="merge-pdfs-file-list" id="merge-pdfs-file-list">
              <div class="merge-pdfs-empty">Click + to add PDF files</div>
            </div>
          </div>
        </div>
      </div>
      <div class="merge-pdfs-footer">
        <div class="merge-pdfs-file-count" id="merge-pdfs-file-count"></div>
        <div class="merge-pdfs-footer-right">
          <button class="pref-btn pref-btn-primary" id="merge-pdfs-ok-btn">Merge</button>
          <button class="pref-btn pref-btn-secondary" id="merge-pdfs-cancel-btn">Cancel</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Print Dialog -->
  <div class="print-overlay" id="print-dialog">
    <div class="print-dialog">
      <div class="print-header">
        <h2>Print</h2>
        <button class="print-close-btn" id="print-close-btn">&times;</button>
      </div>
      <div class="print-body">
        <!-- Left panel: settings -->
        <div class="print-settings">
          <!-- Printer group -->
          <fieldset class="print-group">
            <legend>Printer</legend>
            <div class="print-printer-layout">
              <div class="print-printer-left">
                <div class="print-row">
                  <label class="print-label">Name:</label>
                  <select id="print-printer" class="print-select"></select>
                </div>
                <div class="print-row print-printer-detail-row">
                  <span class="print-label"></span>
                  <span class="print-printer-status" id="print-printer-status">Status: Ready</span>
                  <span class="print-printer-sep">|</span>
                  <span class="print-printer-type" id="print-printer-type">Type:</span>
                </div>
              </div>
              <div class="print-printer-right">
                <button class="pref-btn pref-btn-secondary print-printer-action-btn" id="print-properties-btn">Properties...</button>
                <button class="pref-btn pref-btn-secondary print-printer-action-btn" id="print-page-setup-btn">Page Setup...</button>
              </div>
            </div>
            <div class="print-row">
              <label class="print-label">Copies:</label>
              <input type="number" id="print-copies" class="print-input" value="1" min="1" max="99">
              <label class="print-checkbox-label print-collate-label"><input type="checkbox" id="print-collate"> Collate</label>
            </div>
          </fieldset>

          <!-- Page Range group -->
          <fieldset class="print-group">
            <legend>Page Range</legend>
            <div class="print-row print-pages-row">
              <div class="print-page-btns">
                <button class="print-page-btn active" data-range="all">All</button>
                <button class="print-page-btn" data-range="current" id="print-range-current">Current: <span id="print-current-page-num">1</span></button>
                <button class="print-page-btn" data-range="custom">Custom</button>
              </div>
            </div>
            <div class="print-row print-custom-row">
              <label class="print-label">Pages:</label>
              <input type="text" class="print-custom-input" id="print-custom-pages" placeholder="e.g. 1-5, 8" disabled>
            </div>
            <div class="print-row">
              <label class="print-label">Subset:</label>
              <div class="print-subset-btns">
                <button class="print-subset-btn active" data-subset="all">All</button>
                <button class="print-subset-btn" data-subset="odd">Odd</button>
                <button class="print-subset-btn" data-subset="even">Even</button>
              </div>
              <label class="print-checkbox-label"><input type="checkbox" id="print-reverse"> Reverse Order</label>
            </div>
          </fieldset>

          <!-- Page Placement and Scaling group -->
          <fieldset class="print-group">
            <legend>Page Placement and Scaling</legend>
            <div class="print-row">
              <label class="print-label">Type:</label>
              <select id="print-scaling" class="print-select">
                <option value="fit">Fit to Printer Margins</option>
                <option value="actual">Actual Size</option>
                <option value="shrink">Shrink Oversized Pages</option>
                <option value="custom-scale">Custom Scale</option>
              </select>
            </div>
            <div class="print-row print-zoom-row">
              <label class="print-label">Page Zoom:</label>
              <input type="number" id="print-zoom" class="print-input" value="100" min="10" max="400" disabled>%
            </div>
            <div class="print-row print-checkbox-row">
              <label class="print-checkbox-label"><input type="checkbox" id="print-auto-rotate" checked> Auto-Rotate Page on Paper</label>
            </div>
            <div class="print-row print-checkbox-row">
              <label class="print-checkbox-label"><input type="checkbox" id="print-auto-center" checked> Auto-Center Page on Paper</label>
            </div>
          </fieldset>

          <!-- Advanced group -->
          <fieldset class="print-group">
            <legend>Advanced Print Options</legend>
            <div class="print-row">
              <label class="print-label">Print:</label>
              <select id="print-content" class="print-select">
                <option value="doc-and-markups">Document and Markups</option>
                <option value="document">Document</option>
              </select>
            </div>
            <div class="print-row print-checkbox-row">
              <label class="print-checkbox-label"><input type="checkbox" id="print-as-image"> Print as Image</label>
            </div>
          </fieldset>

          <div class="print-status" id="print-status" style="display: none;"></div>
        </div>

        <!-- Right panel: preview -->
        <div class="print-preview-panel">
          <div class="print-preview-header">
            <span id="print-preview-paper">Paper: 'Letter'</span>
          </div>
          <div class="print-preview-container">
            <canvas id="print-preview-canvas"></canvas>
          </div>
          <div class="print-preview-footer">
            <span>Page: <span id="print-preview-page-num">1</span> of <span id="print-preview-total">1</span></span>
            <div class="print-preview-nav">
              <button class="print-preview-nav-btn" id="print-preview-prev" title="Previous page">&lt;</button>
              <button class="print-preview-nav-btn" id="print-preview-next" title="Next page">&gt;</button>
            </div>
          </div>
        </div>
      </div>

      <div class="print-footer">
        <div class="print-footer-left">
          <span class="print-page-info" id="print-page-info"></span>
        </div>
        <div class="print-footer-right">
          <button class="pref-btn pref-btn-primary" id="print-ok-btn">Print</button>
          <button class="pref-btn pref-btn-secondary" id="print-cancel-btn">Cancel</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Page Setup Dialog -->
  <div class="page-setup-overlay" id="page-setup-dialog">
    <div class="page-setup-dialog">
      <div class="page-setup-header">
        <h2>Page Setup</h2>
        <button class="page-setup-close-btn" id="page-setup-close-btn">&times;</button>
      </div>
      <div class="page-setup-content">
        <div class="page-setup-preview-box">
          <canvas id="page-setup-preview-canvas" width="160" height="200"></canvas>
        </div>
        <fieldset class="page-setup-group">
          <legend>Paper</legend>
          <div class="page-setup-row">
            <label class="page-setup-label">Size:</label>
            <select id="page-setup-size" class="page-setup-select">
              <option value="a3">A3 (297 x 420 mm)</option>
              <option value="a4" selected>A4 (210 x 297 mm)</option>
              <option value="a5">A5 (148 x 210 mm)</option>
              <option value="letter">Letter (216 x 279 mm)</option>
              <option value="legal">Legal (216 x 356 mm)</option>
              <option value="tabloid">Tabloid (279 x 432 mm)</option>
            </select>
          </div>
          <div class="page-setup-row">
            <label class="page-setup-label">Source:</label>
            <select id="page-setup-source" class="page-setup-select">
              <option value="auto">Automatically Select</option>
              <option value="tray1">Tray 1</option>
              <option value="tray2">Tray 2</option>
              <option value="manual">Manual Feed</option>
            </select>
          </div>
        </fieldset>
        <div class="page-setup-bottom">
          <fieldset class="page-setup-group page-setup-orientation-group">
            <legend>Orientation</legend>
            <label class="page-setup-radio-label">
              <input type="radio" name="page-setup-orient" value="portrait" checked> Portrait
            </label>
            <label class="page-setup-radio-label">
              <input type="radio" name="page-setup-orient" value="landscape"> Landscape
            </label>
          </fieldset>
          <fieldset class="page-setup-group page-setup-margins-group">
            <legend>Margins (millimeters)</legend>
            <div class="page-setup-margins-grid">
              <label class="page-setup-margin-label">Left:</label>
              <input type="number" id="page-setup-margin-left" class="page-setup-margin-input" value="25" min="0" max="200">
              <label class="page-setup-margin-label">Right:</label>
              <input type="number" id="page-setup-margin-right" class="page-setup-margin-input" value="25" min="0" max="200">
              <label class="page-setup-margin-label">Top:</label>
              <input type="number" id="page-setup-margin-top" class="page-setup-margin-input" value="25" min="0" max="200">
              <label class="page-setup-margin-label">Bottom:</label>
              <input type="number" id="page-setup-margin-bottom" class="page-setup-margin-input" value="25" min="0" max="200">
            </div>
          </fieldset>
        </div>
      </div>
      <div class="page-setup-footer">
        <div></div>
        <div class="page-setup-footer-right">
          <button class="pref-btn pref-btn-primary" id="page-setup-ok-btn">OK</button>
          <button class="pref-btn pref-btn-secondary" id="page-setup-cancel-btn">Cancel</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Watermark Dialog -->
  <div class="watermark-overlay" id="watermark-dialog">
    <div class="watermark-dialog">
      <div class="watermark-header">
        <h2>Add Watermark</h2>
        <button class="watermark-close-btn" id="watermark-close-btn">&times;</button>
      </div>
      <div class="watermark-content">
        <div class="watermark-tabs">
          <button class="watermark-tab active" data-wm-tab="text">Text</button>
          <button class="watermark-tab" data-wm-tab="image">Image</button>
        </div>
        <div class="watermark-tab-content active" id="wm-tab-text">
          <div class="watermark-form">
            <div class="watermark-row">
              <label class="watermark-label">Text:</label>
              <input type="text" id="wm-text" class="watermark-input" value="DRAFT" placeholder="Watermark text">
            </div>
            <div class="watermark-row">
              <label class="watermark-label">Font:</label>
              <select id="wm-font" class="watermark-select">
                <option value="Helvetica">Helvetica</option>
                <option value="Arial">Arial</option>
                <option value="Times New Roman">Times New Roman</option>
                <option value="Courier">Courier</option>
                <option value="Georgia">Georgia</option>
              </select>
            </div>
            <div class="watermark-row">
              <label class="watermark-label">Font Size:</label>
              <input type="number" id="wm-font-size" class="watermark-input watermark-input-sm" value="72" min="8" max="200">
            </div>
            <div class="watermark-row">
              <label class="watermark-label">Color:</label>
              <input type="color" id="wm-color" class="watermark-color" value="#ff0000">
            </div>
            <div class="watermark-row">
              <label class="watermark-label">Opacity:</label>
              <input type="range" id="wm-opacity" class="watermark-slider" min="0" max="100" value="30">
              <span id="wm-opacity-val" class="watermark-slider-val">30%</span>
            </div>
            <div class="watermark-row">
              <label class="watermark-label">Rotation:</label>
              <input type="number" id="wm-rotation" class="watermark-input watermark-input-sm" value="-45" min="-180" max="180">&deg;
            </div>
            <div class="watermark-row">
              <label class="watermark-label">Position:</label>
              <select id="wm-position" class="watermark-select">
                <option value="center">Center</option>
                <option value="top-left">Top Left</option>
                <option value="top-right">Top Right</option>
                <option value="bottom-left">Bottom Left</option>
                <option value="bottom-right">Bottom Right</option>
                <option value="custom">Custom</option>
              </select>
            </div>
            <div class="watermark-row wm-custom-pos" style="display:none">
              <label class="watermark-label">X / Y:</label>
              <input type="number" id="wm-custom-x" class="watermark-input watermark-input-sm" value="0">
              <input type="number" id="wm-custom-y" class="watermark-input watermark-input-sm" value="0">
            </div>
            <div class="watermark-row">
              <label class="watermark-label">Layer:</label>
              <select id="wm-layer" class="watermark-select">
                <option value="behind">Behind content</option>
                <option value="infront">In front of content</option>
              </select>
            </div>
            <div class="watermark-row">
              <label class="watermark-label">Pages:</label>
              <select id="wm-page-range" class="watermark-select">
                <option value="all">All pages</option>
                <option value="first">First page only</option>
                <option value="custom">Custom</option>
              </select>
            </div>
            <div class="watermark-row wm-custom-pages" style="display:none">
              <label class="watermark-label">Range:</label>
              <input type="text" id="wm-custom-pages" class="watermark-input" placeholder="e.g. 1-5, 8">
            </div>
          </div>
        </div>
        <div class="watermark-tab-content" id="wm-tab-image">
          <div class="watermark-form">
            <div class="watermark-row">
              <label class="watermark-label">Image:</label>
              <button class="pref-btn pref-btn-secondary" id="wm-img-pick">Choose Image...</button>
              <input type="file" id="wm-img-file" accept="image/*" style="display:none">
            </div>
            <div class="watermark-row" id="wm-img-preview-row" style="display:none">
              <label class="watermark-label"></label>
              <img id="wm-img-preview" class="watermark-img-preview">
            </div>
            <div class="watermark-row">
              <label class="watermark-label">Opacity:</label>
              <input type="range" id="wm-img-opacity" class="watermark-slider" min="0" max="100" value="20">
              <span id="wm-img-opacity-val" class="watermark-slider-val">20%</span>
            </div>
            <div class="watermark-row">
              <label class="watermark-label">Scale:</label>
              <input type="range" id="wm-img-scale" class="watermark-slider" min="10" max="300" value="100">
              <span id="wm-img-scale-val" class="watermark-slider-val">100%</span>
            </div>
            <div class="watermark-row">
              <label class="watermark-label">Rotation:</label>
              <input type="number" id="wm-img-rotation" class="watermark-input watermark-input-sm" value="0" min="-180" max="180">&deg;
            </div>
            <div class="watermark-row">
              <label class="watermark-label">Position:</label>
              <select id="wm-img-position" class="watermark-select">
                <option value="center">Center</option>
                <option value="top-left">Top Left</option>
                <option value="top-right">Top Right</option>
                <option value="bottom-left">Bottom Left</option>
                <option value="bottom-right">Bottom Right</option>
                <option value="custom">Custom</option>
              </select>
            </div>
            <div class="watermark-row wm-img-custom-pos" style="display:none">
              <label class="watermark-label">X / Y:</label>
              <input type="number" id="wm-img-custom-x" class="watermark-input watermark-input-sm" value="0">
              <input type="number" id="wm-img-custom-y" class="watermark-input watermark-input-sm" value="0">
            </div>
            <div class="watermark-row">
              <label class="watermark-label">Layer:</label>
              <select id="wm-img-layer" class="watermark-select">
                <option value="behind">Behind content</option>
                <option value="infront">In front of content</option>
              </select>
            </div>
            <div class="watermark-row">
              <label class="watermark-label">Pages:</label>
              <select id="wm-img-page-range" class="watermark-select">
                <option value="all">All pages</option>
                <option value="first">First page only</option>
                <option value="custom">Custom</option>
              </select>
            </div>
            <div class="watermark-row wm-img-custom-pages" style="display:none">
              <label class="watermark-label">Range:</label>
              <input type="text" id="wm-img-custom-pages" class="watermark-input" placeholder="e.g. 1-5, 8">
            </div>
          </div>
        </div>
      </div>
      <div class="watermark-footer">
        <div class="watermark-footer-left"></div>
        <div class="watermark-footer-right">
          <button class="pref-btn pref-btn-primary" id="wm-add-btn">Add</button>
          <button class="pref-btn pref-btn-secondary" id="wm-cancel-btn">Cancel</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Header/Footer Dialog -->
  <div class="header-footer-overlay" id="header-footer-dialog">
    <div class="header-footer-dialog">
      <div class="header-footer-header">
        <h2>Add Header/Footer</h2>
        <button class="header-footer-close-btn" id="hf-close-btn">&times;</button>
      </div>
      <div class="header-footer-content">
        <div class="watermark-form">
          <div class="hf-section-label">Header</div>
          <div class="hf-row-triple">
            <div class="hf-field">
              <label>Left</label>
              <input type="text" id="hf-header-left" class="hf-input" placeholder="Left header">
            </div>
            <div class="hf-field">
              <label>Center</label>
              <input type="text" id="hf-header-center" class="hf-input" placeholder="Center header">
            </div>
            <div class="hf-field">
              <label>Right</label>
              <input type="text" id="hf-header-right" class="hf-input" placeholder="Right header">
            </div>
          </div>
          <div class="hf-section-label">Footer</div>
          <div class="hf-row-triple">
            <div class="hf-field">
              <label>Left</label>
              <input type="text" id="hf-footer-left" class="hf-input" placeholder="Left footer">
            </div>
            <div class="hf-field">
              <label>Center</label>
              <input type="text" id="hf-footer-center" class="hf-input" placeholder="Center footer">
            </div>
            <div class="hf-field">
              <label>Right</label>
              <input type="text" id="hf-footer-right" class="hf-input" placeholder="Right footer">
            </div>
          </div>
          <div class="hf-variables">
            <label>Insert Variable:</label>
            <button class="hf-var-btn" data-var="{page}">{page}</button>
            <button class="hf-var-btn" data-var="{pages}">{pages}</button>
            <button class="hf-var-btn" data-var="{date}">{date}</button>
            <button class="hf-var-btn" data-var="{time}">{time}</button>
            <button class="hf-var-btn" data-var="{filename}">{filename}</button>
          </div>
          <div class="watermark-row">
            <label class="watermark-label">Font:</label>
            <select id="hf-font" class="watermark-select">
              <option value="Helvetica">Helvetica</option>
              <option value="Arial">Arial</option>
              <option value="Times New Roman">Times New Roman</option>
              <option value="Courier">Courier</option>
            </select>
          </div>
          <div class="watermark-row">
            <label class="watermark-label">Font Size:</label>
            <input type="number" id="hf-font-size" class="watermark-input watermark-input-sm" value="10" min="6" max="36">
          </div>
          <div class="watermark-row">
            <label class="watermark-label">Color:</label>
            <input type="color" id="hf-color" class="watermark-color" value="#000000">
          </div>
          <div class="hf-margins">
            <label class="watermark-label">Margins:</label>
            <div class="hf-margin-fields">
              <label>Top <input type="number" id="hf-margin-top" class="watermark-input watermark-input-sm" value="30" min="0"></label>
              <label>Bottom <input type="number" id="hf-margin-bottom" class="watermark-input watermark-input-sm" value="30" min="0"></label>
              <label>Left <input type="number" id="hf-margin-left" class="watermark-input watermark-input-sm" value="40" min="0"></label>
              <label>Right <input type="number" id="hf-margin-right" class="watermark-input watermark-input-sm" value="40" min="0"></label>
            </div>
          </div>
          <div class="watermark-row">
            <label class="watermark-label">Pages:</label>
            <select id="hf-page-range" class="watermark-select">
              <option value="all">All pages</option>
              <option value="first">First page only</option>
              <option value="custom">Custom</option>
            </select>
          </div>
          <div class="watermark-row hf-custom-pages" style="display:none">
            <label class="watermark-label">Range:</label>
            <input type="text" id="hf-custom-pages" class="watermark-input" placeholder="e.g. 1-5, 8">
          </div>
        </div>
      </div>
      <div class="watermark-footer">
        <div class="watermark-footer-left"></div>
        <div class="watermark-footer-right">
          <button class="pref-btn pref-btn-primary" id="hf-add-btn">Add</button>
          <button class="pref-btn pref-btn-secondary" id="hf-cancel-btn">Cancel</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Manage Watermarks Dialog -->
  <div class="manage-wm-overlay" id="manage-watermarks-dialog">
    <div class="manage-wm-dialog">
      <div class="manage-wm-header">
        <h2>Manage Watermarks</h2>
        <button class="manage-wm-close-btn" id="manage-wm-close-btn">&times;</button>
      </div>
      <div class="manage-wm-content">
        <div class="manage-wm-list" id="manage-wm-list">
          <div class="manage-wm-empty">No watermarks added yet.</div>
        </div>
      </div>
      <div class="watermark-footer">
        <div class="watermark-footer-left"></div>
        <div class="watermark-footer-right">
          <button class="pref-btn pref-btn-secondary" id="manage-wm-close-btn2">Close</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Signature Dialog -->
  <div class="sig-overlay" id="sig-dialog">
    <div class="sig-dialog">
      <div class="sig-header">
        <h2>Signature</h2>
        <button class="sig-close-btn" id="sig-close-btn">&times;</button>
      </div>
      <div class="sig-content">
        <div class="sig-tabs">
          <button class="sig-tab active" id="sig-tab-draw">Draw</button>
          <button class="sig-tab" id="sig-tab-saved">Saved</button>
        </div>
        <div class="sig-draw-panel" id="sig-draw-panel">
          <canvas id="sig-canvas" width="430" height="150"></canvas>
        </div>
        <div class="sig-saved-panel" id="sig-saved-panel" style="display:none;"></div>
      </div>
      <div class="sig-footer">
        <div class="sig-footer-left">
          <label class="sig-color-label">Color:</label>
          <input type="color" id="sig-color" class="sig-color-input" value="#000000">
        </div>
        <div class="sig-footer-right">
          <button class="pref-btn pref-btn-secondary" id="sig-clear-btn">Clear</button>
          <button class="pref-btn pref-btn-secondary" id="sig-place-btn" style="color:#0078d4; border-color:#0078d4;">Place</button>
          <button class="pref-btn pref-btn-primary" id="sig-save-place-btn">Save &amp; Place</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Preferences Dialog -->
  <div class="preferences-overlay" id="preferences-dialog">
    <div class="preferences-dialog">
      <div class="preferences-header">
        <h2>Preferences</h2>
        <button class="preferences-close-btn" id="pref-close-btn">&times;</button>
      </div>
      <div class="preferences-content">
        <!-- Tabs -->
        <div class="pref-tabs">
          <button class="pref-tab active" data-pref-tab="general">General</button>
          <button class="pref-tab" data-pref-tab="annotations">Annotations</button>
          <button class="pref-tab" data-pref-tab="drawing">Drawing</button>
          <button class="pref-tab" data-pref-tab="shapes">Shapes</button>
          <button class="pref-tab" data-pref-tab="markup">Markup</button>
          <button class="pref-tab" data-pref-tab="behavior">Behavior</button>
          <button class="pref-tab" data-pref-tab="fileassoc">File Association</button>
          <button class="pref-tab" data-pref-tab="vprinter">Virtual Printer</button>
        </div>

        <!-- General Tab -->
        <div class="pref-tab-content active" id="pref-tab-general">
          <div class="preferences-section">
            <h3>Theme</h3>
            <div class="pref-row">
              <label for="pref-theme-select">Application Theme</label>
              <select id="pref-theme-select" style="width: 120px;">
                <option value="system">System</option>
                <option value="light">Light</option>
                <option value="dark">Dark</option>
                <option value="blue">Blue</option>
                <option value="highContrast">High Contrast</option>
              </select>
            </div>
          </div>

          <div class="preferences-section">
            <h3>Startup</h3>
            <div class="pref-row pref-checkbox-row">
              <label class="pref-checkbox-label">
                <input type="checkbox" id="pref-restore-session-general">
                <span>Restore last session when application starts</span>
              </label>
            </div>
          </div>

          <div class="preferences-section">
            <h3>Author</h3>
            <div class="pref-row">
              <label for="pref-author-name-general">Default Author Name</label>
              <input type="text" id="pref-author-name-general" value="User">
            </div>
          </div>
        </div>

        <!-- Annotations Tab (TextBox & Callout) -->
        <div class="pref-tab-content" id="pref-tab-annotations">
          <div class="preferences-section">
            <h3>General Defaults</h3>
            <div class="pref-row">
              <label>Default Annotation Color</label>
              <div class="pref-color-wrapper" id="pref-default-color-wrapper">
                <button type="button" class="color-picker-button" id="pref-default-color-btn">
                  <div class="color-preview" id="pref-default-color-preview" style="background: #ffff00;"></div>
                  <span class="color-hex" id="pref-default-color-hex">#FFFF00</span>
                  <svg class="dropdown-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M6 9l6 6 6-6"/>
                  </svg>
                </button>
                <div class="color-palette-dropdown" id="pref-default-color-dropdown">
                  <div class="color-palette" id="pref-default-color-palette"></div>
                  <button type="button" class="color-custom-btn" id="pref-default-color-custom-btn">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <circle cx="12" cy="12" r="10"/>
                      <path d="M12 2a10 10 0 0 1 0 20"/>
                    </svg>
                    More Colors...
                  </button>
                </div>
                <input type="color" id="pref-default-color" value="#ffff00">
              </div>
            </div>
            <div class="pref-row">
              <label for="pref-default-line-width">Default Line Width</label>
              <input type="number" id="pref-default-line-width" min="1" max="20" value="3">
            </div>
            <div class="pref-row">
              <label for="pref-default-font-size">Default Font Size</label>
              <input type="number" id="pref-default-font-size" min="8" max="72" value="16">
            </div>
            <div class="pref-row">
              <label for="pref-highlight-opacity">Highlight Opacity (%)</label>
              <input type="number" id="pref-highlight-opacity" min="10" max="100" value="30">
            </div>
          </div>

          <div class="preferences-section">
            <h3>Text Box Defaults</h3>
            <div class="pref-row">
              <label>Fill Color</label>
              <div class="pref-color-row">
                <label class="pref-fill-none-checkbox">
                  <input type="checkbox" id="pref-textbox-fill-none">
                  <span>None</span>
                </label>
                <div class="pref-color-wrapper" id="pref-textbox-fill-color-wrapper">
                  <button type="button" class="color-picker-button" id="pref-textbox-fill-color-btn">
                    <div class="color-preview" id="pref-textbox-fill-color-preview" style="background: #ffffd0;"></div>
                    <span class="color-hex" id="pref-textbox-fill-color-hex">#FFFFD0</span>
                    <svg class="dropdown-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M6 9l6 6 6-6"/>
                    </svg>
                  </button>
                  <div class="color-palette-dropdown" id="pref-textbox-fill-color-dropdown">
                    <div class="color-palette" id="pref-textbox-fill-color-palette"></div>
                    <button type="button" class="color-custom-btn" id="pref-textbox-fill-color-custom-btn">
                      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"/>
                        <path d="M12 2a10 10 0 0 1 0 20"/>
                      </svg>
                      More Colors...
                    </button>
                  </div>
                  <input type="color" id="pref-textbox-fill-color" value="#ffffd0">
                </div>
              </div>
            </div>
            <div class="pref-row">
              <label>Stroke Color</label>
              <div class="pref-color-wrapper" id="pref-textbox-stroke-color-wrapper">
                <button type="button" class="color-picker-button" id="pref-textbox-stroke-color-btn">
                  <div class="color-preview" id="pref-textbox-stroke-color-preview" style="background: #000000;"></div>
                  <span class="color-hex" id="pref-textbox-stroke-color-hex">#000000</span>
                  <svg class="dropdown-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M6 9l6 6 6-6"/>
                  </svg>
                </button>
                <div class="color-palette-dropdown" id="pref-textbox-stroke-color-dropdown">
                  <div class="color-palette" id="pref-textbox-stroke-color-palette"></div>
                  <button type="button" class="color-custom-btn" id="pref-textbox-stroke-color-custom-btn">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <circle cx="12" cy="12" r="10"/>
                      <path d="M12 2a10 10 0 0 1 0 20"/>
                    </svg>
                    More Colors...
                  </button>
                </div>
                <input type="color" id="pref-textbox-stroke-color" value="#000000">
              </div>
            </div>
            <div class="pref-row">
              <label for="pref-textbox-border-width">Border Width</label>
              <input type="number" id="pref-textbox-border-width" min="0" max="10" value="1">
            </div>
            <div class="pref-row">
              <label for="pref-textbox-border-style">Border Style</label>
              <select id="pref-textbox-border-style">
                <option value="solid">Solid</option>
                <option value="dashed">Dashed</option>
                <option value="dotted">Dotted</option>
              </select>
            </div>
            <div class="pref-row">
              <label for="pref-textbox-opacity">Opacity (%)</label>
              <input type="number" id="pref-textbox-opacity" min="10" max="100" value="100">
            </div>
            <div class="pref-row">
              <label for="pref-textbox-font-size">Font Size</label>
              <input type="number" id="pref-textbox-font-size" min="8" max="72" value="14">
            </div>
          </div>

          <div class="preferences-section">
            <h3>Callout Defaults</h3>
            <div class="pref-row">
              <label>Fill Color</label>
              <div class="pref-color-row">
                <label class="pref-fill-none-checkbox">
                  <input type="checkbox" id="pref-callout-fill-none">
                  <span>None</span>
                </label>
                <div class="pref-color-wrapper" id="pref-callout-fill-color-wrapper">
                  <button type="button" class="color-picker-button" id="pref-callout-fill-color-btn">
                    <div class="color-preview" id="pref-callout-fill-color-preview" style="background: #ffffd0;"></div>
                    <span class="color-hex" id="pref-callout-fill-color-hex">#FFFFD0</span>
                    <svg class="dropdown-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M6 9l6 6 6-6"/>
                    </svg>
                  </button>
                  <div class="color-palette-dropdown" id="pref-callout-fill-color-dropdown">
                    <div class="color-palette" id="pref-callout-fill-color-palette"></div>
                    <button type="button" class="color-custom-btn" id="pref-callout-fill-color-custom-btn">
                      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"/>
                        <path d="M12 2a10 10 0 0 1 0 20"/>
                      </svg>
                      More Colors...
                    </button>
                  </div>
                  <input type="color" id="pref-callout-fill-color" value="#ffffd0">
                </div>
              </div>
            </div>
            <div class="pref-row">
              <label>Stroke Color</label>
              <div class="pref-color-wrapper" id="pref-callout-stroke-color-wrapper">
                <button type="button" class="color-picker-button" id="pref-callout-stroke-color-btn">
                  <div class="color-preview" id="pref-callout-stroke-color-preview" style="background: #000000;"></div>
                  <span class="color-hex" id="pref-callout-stroke-color-hex">#000000</span>
                  <svg class="dropdown-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M6 9l6 6 6-6"/>
                  </svg>
                </button>
                <div class="color-palette-dropdown" id="pref-callout-stroke-color-dropdown">
                  <div class="color-palette" id="pref-callout-stroke-color-palette"></div>
                  <button type="button" class="color-custom-btn" id="pref-callout-stroke-color-custom-btn">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <circle cx="12" cy="12" r="10"/>
                      <path d="M12 2a10 10 0 0 1 0 20"/>
                    </svg>
                    More Colors...
                  </button>
                </div>
                <input type="color" id="pref-callout-stroke-color" value="#000000">
              </div>
            </div>
            <div class="pref-row">
              <label for="pref-callout-border-width">Border Width</label>
              <input type="number" id="pref-callout-border-width" min="0" max="10" value="1">
            </div>
            <div class="pref-row">
              <label for="pref-callout-border-style">Border Style</label>
              <select id="pref-callout-border-style">
                <option value="solid">Solid</option>
                <option value="dashed">Dashed</option>
                <option value="dotted">Dotted</option>
              </select>
            </div>
            <div class="pref-row">
              <label for="pref-callout-opacity">Opacity (%)</label>
              <input type="number" id="pref-callout-opacity" min="10" max="100" value="100">
            </div>
            <div class="pref-row">
              <label for="pref-callout-font-size">Font Size</label>
              <input type="number" id="pref-callout-font-size" min="8" max="72" value="14">
            </div>
          </div>

          <div class="preferences-section">
            <h3>Highlight Defaults</h3>
            <div class="pref-row">
              <label>Color</label>
              <div class="pref-color-wrapper" id="pref-highlight-color-wrapper">
                <button type="button" class="color-picker-button" id="pref-highlight-color-btn">
                  <div class="color-preview" id="pref-highlight-color-preview" style="background: #ffff00;"></div>
                  <span class="color-hex" id="pref-highlight-color-hex">#FFFF00</span>
                  <svg class="dropdown-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M6 9l6 6 6-6"/>
                  </svg>
                </button>
                <div class="color-palette-dropdown" id="pref-highlight-color-dropdown">
                  <div class="color-palette" id="pref-highlight-color-palette"></div>
                  <button type="button" class="color-custom-btn" id="pref-highlight-color-custom-btn">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <circle cx="12" cy="12" r="10"/>
                      <path d="M12 2a10 10 0 0 1 0 20"/>
                    </svg>
                    More Colors...
                  </button>
                </div>
                <input type="color" id="pref-highlight-color" value="#ffff00">
              </div>
            </div>
          </div>

          <div class="preferences-section">
            <h3>Comment/Note Defaults</h3>
            <div class="pref-row">
              <label>Color</label>
              <div class="pref-color-wrapper" id="pref-comment-color-wrapper">
                <button type="button" class="color-picker-button" id="pref-comment-color-btn">
                  <div class="color-preview" id="pref-comment-color-preview" style="background: #ffff00;"></div>
                  <span class="color-hex" id="pref-comment-color-hex">#FFFF00</span>
                  <svg class="dropdown-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M6 9l6 6 6-6"/>
                  </svg>
                </button>
                <div class="color-palette-dropdown" id="pref-comment-color-dropdown">
                  <div class="color-palette" id="pref-comment-color-palette"></div>
                  <button type="button" class="color-custom-btn" id="pref-comment-color-custom-btn">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <circle cx="12" cy="12" r="10"/>
                      <path d="M12 2a10 10 0 0 1 0 20"/>
                    </svg>
                    More Colors...
                  </button>
                </div>
                <input type="color" id="pref-comment-color" value="#ffff00">
              </div>
            </div>
            <div class="pref-row">
              <label for="pref-comment-icon">Icon</label>
              <select id="pref-comment-icon">
                <option value="comment">Comment</option>
                <option value="key">Key</option>
                <option value="note">Note</option>
                <option value="help">Help</option>
                <option value="newParagraph">New Paragraph</option>
                <option value="paragraph">Paragraph</option>
                <option value="insert">Insert</option>
              </select>
            </div>
          </div>
        </div>

        <!-- Drawing Tab (Freehand, Line, Arrow, Polyline) -->
        <div class="pref-tab-content" id="pref-tab-drawing">
          <div class="preferences-section">
            <h3>Freehand Defaults</h3>
            <div class="pref-row">
              <label>Stroke Color</label>
              <div class="pref-color-wrapper" id="pref-draw-stroke-color-wrapper">
                <button type="button" class="color-picker-button" id="pref-draw-stroke-color-btn">
                  <div class="color-preview" id="pref-draw-stroke-color-preview" style="background: #000000;"></div>
                  <span class="color-hex" id="pref-draw-stroke-color-hex">#000000</span>
                  <svg class="dropdown-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M6 9l6 6 6-6"/>
                  </svg>
                </button>
                <div class="color-palette-dropdown" id="pref-draw-stroke-color-dropdown">
                  <div class="color-palette" id="pref-draw-stroke-color-palette"></div>
                  <button type="button" class="color-custom-btn" id="pref-draw-stroke-color-custom-btn">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <circle cx="12" cy="12" r="10"/>
                      <path d="M12 2a10 10 0 0 1 0 20"/>
                    </svg>
                    More Colors...
                  </button>
                </div>
                <input type="color" id="pref-draw-stroke-color" value="#000000">
              </div>
            </div>
            <div class="pref-row">
              <label for="pref-draw-line-width">Line Width</label>
              <input type="number" id="pref-draw-line-width" min="1" max="20" value="3">
            </div>
            <div class="pref-row">
              <label for="pref-draw-opacity">Opacity (%)</label>
              <input type="number" id="pref-draw-opacity" min="10" max="100" value="100">
            </div>
          </div>

          <div class="preferences-section">
            <h3>Line Defaults</h3>
            <div class="pref-row">
              <label>Stroke Color</label>
              <div class="pref-color-wrapper" id="pref-line-stroke-color-wrapper">
                <button type="button" class="color-picker-button" id="pref-line-stroke-color-btn">
                  <div class="color-preview" id="pref-line-stroke-color-preview" style="background: #000000;"></div>
                  <span class="color-hex" id="pref-line-stroke-color-hex">#000000</span>
                  <svg class="dropdown-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M6 9l6 6 6-6"/>
                  </svg>
                </button>
                <div class="color-palette-dropdown" id="pref-line-stroke-color-dropdown">
                  <div class="color-palette" id="pref-line-stroke-color-palette"></div>
                  <button type="button" class="color-custom-btn" id="pref-line-stroke-color-custom-btn">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <circle cx="12" cy="12" r="10"/>
                      <path d="M12 2a10 10 0 0 1 0 20"/>
                    </svg>
                    More Colors...
                  </button>
                </div>
                <input type="color" id="pref-line-stroke-color" value="#000000">
              </div>
            </div>
            <div class="pref-row">
              <label for="pref-line-line-width">Line Width</label>
              <input type="number" id="pref-line-line-width" min="1" max="20" value="2">
            </div>
            <div class="pref-row">
              <label for="pref-line-border-style">Border Style</label>
              <select id="pref-line-border-style">
                <option value="solid">Solid</option>
                <option value="dashed">Dashed</option>
                <option value="dotted">Dotted</option>
              </select>
            </div>
            <div class="pref-row">
              <label for="pref-line-opacity">Opacity (%)</label>
              <input type="number" id="pref-line-opacity" min="10" max="100" value="100">
            </div>
          </div>

          <div class="preferences-section">
            <h3>Arrow Defaults</h3>
            <div class="pref-row">
              <label>Stroke Color</label>
              <div class="pref-color-wrapper" id="pref-arrow-stroke-color-wrapper">
                <button type="button" class="color-picker-button" id="pref-arrow-stroke-color-btn">
                  <div class="color-preview" id="pref-arrow-stroke-color-preview" style="background: #0000ff;"></div>
                  <span class="color-hex" id="pref-arrow-stroke-color-hex">#0000FF</span>
                  <svg class="dropdown-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M6 9l6 6 6-6"/>
                  </svg>
                </button>
                <div class="color-palette-dropdown" id="pref-arrow-stroke-color-dropdown">
                  <div class="color-palette" id="pref-arrow-stroke-color-palette"></div>
                  <button type="button" class="color-custom-btn" id="pref-arrow-stroke-color-custom-btn">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <circle cx="12" cy="12" r="10"/>
                      <path d="M12 2a10 10 0 0 1 0 20"/>
                    </svg>
                    More Colors...
                  </button>
                </div>
                <input type="color" id="pref-arrow-stroke-color" value="#0000ff">
              </div>
            </div>
            <div class="pref-row">
              <label>Fill Color</label>
              <div class="pref-color-wrapper" id="pref-arrow-fill-color-wrapper">
                <button type="button" class="color-picker-button" id="pref-arrow-fill-color-btn">
                  <div class="color-preview" id="pref-arrow-fill-color-preview" style="background: #0000ff;"></div>
                  <span class="color-hex" id="pref-arrow-fill-color-hex">#0000FF</span>
                  <svg class="dropdown-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M6 9l6 6 6-6"/>
                  </svg>
                </button>
                <div class="color-palette-dropdown" id="pref-arrow-fill-color-dropdown">
                  <div class="color-palette" id="pref-arrow-fill-color-palette"></div>
                  <button type="button" class="color-custom-btn" id="pref-arrow-fill-color-custom-btn">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <circle cx="12" cy="12" r="10"/>
                      <path d="M12 2a10 10 0 0 1 0 20"/>
                    </svg>
                    More Colors...
                  </button>
                </div>
                <input type="color" id="pref-arrow-fill-color" value="#0000ff">
              </div>
            </div>
            <div class="pref-row">
              <label for="pref-arrow-line-width">Line Width</label>
              <input type="number" id="pref-arrow-line-width" min="1" max="20" value="2">
            </div>
            <div class="pref-row">
              <label for="pref-arrow-border-style">Border Style</label>
              <select id="pref-arrow-border-style">
                <option value="solid">Solid</option>
                <option value="dashed">Dashed</option>
                <option value="dotted">Dotted</option>
              </select>
            </div>
            <div class="pref-row">
              <label for="pref-arrow-start-head">Start Head</label>
              <select id="pref-arrow-start-head">
                <option value="none">None</option>
                <option value="open">Open</option>
                <option value="closed">Closed</option>
                <option value="diamond">Diamond</option>
                <option value="circle">Circle</option>
                <option value="square">Square</option>
                <option value="slash">Slash</option>
              </select>
            </div>
            <div class="pref-row">
              <label for="pref-arrow-end-head">End Head</label>
              <select id="pref-arrow-end-head">
                <option value="none">None</option>
                <option value="open">Open</option>
                <option value="closed">Closed</option>
                <option value="diamond">Diamond</option>
                <option value="circle">Circle</option>
                <option value="square">Square</option>
                <option value="slash">Slash</option>
              </select>
            </div>
            <div class="pref-row">
              <label for="pref-arrow-head-size">Head Size</label>
              <input type="number" id="pref-arrow-head-size" min="4" max="40" value="12">
            </div>
            <div class="pref-row">
              <label for="pref-arrow-opacity">Opacity (%)</label>
              <input type="number" id="pref-arrow-opacity" min="10" max="100" value="100">
            </div>
          </div>

          <div class="preferences-section">
            <h3>Polyline Defaults</h3>
            <div class="pref-row">
              <label>Stroke Color</label>
              <div class="pref-color-wrapper" id="pref-polyline-stroke-color-wrapper">
                <button type="button" class="color-picker-button" id="pref-polyline-stroke-color-btn">
                  <div class="color-preview" id="pref-polyline-stroke-color-preview" style="background: #000000;"></div>
                  <span class="color-hex" id="pref-polyline-stroke-color-hex">#000000</span>
                  <svg class="dropdown-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M6 9l6 6 6-6"/>
                  </svg>
                </button>
                <div class="color-palette-dropdown" id="pref-polyline-stroke-color-dropdown">
                  <div class="color-palette" id="pref-polyline-stroke-color-palette"></div>
                  <button type="button" class="color-custom-btn" id="pref-polyline-stroke-color-custom-btn">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <circle cx="12" cy="12" r="10"/>
                      <path d="M12 2a10 10 0 0 1 0 20"/>
                    </svg>
                    More Colors...
                  </button>
                </div>
                <input type="color" id="pref-polyline-stroke-color" value="#000000">
              </div>
            </div>
            <div class="pref-row">
              <label for="pref-polyline-line-width">Line Width</label>
              <input type="number" id="pref-polyline-line-width" min="1" max="20" value="2">
            </div>
            <div class="pref-row">
              <label for="pref-polyline-opacity">Opacity (%)</label>
              <input type="number" id="pref-polyline-opacity" min="10" max="100" value="100">
            </div>
          </div>
        </div>

        <!-- Shapes Tab (Rectangle, Circle) -->
        <div class="pref-tab-content" id="pref-tab-shapes">
          <div class="preferences-section">
            <h3>Rectangle Defaults</h3>
            <div class="pref-row">
              <label>Fill Color</label>
              <div class="pref-color-row">
                <label class="pref-fill-none-checkbox">
                  <input type="checkbox" id="pref-rect-fill-none" checked>
                  <span>None</span>
                </label>
                <div class="pref-color-wrapper" id="pref-rect-fill-color-wrapper">
                  <button type="button" class="color-picker-button" id="pref-rect-fill-color-btn" disabled>
                    <div class="color-preview" id="pref-rect-fill-color-preview" style="background: #ffff00;"></div>
                    <span class="color-hex" id="pref-rect-fill-color-hex">#FFFF00</span>
                    <svg class="dropdown-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M6 9l6 6 6-6"/>
                    </svg>
                  </button>
                  <div class="color-palette-dropdown" id="pref-rect-fill-color-dropdown">
                    <div class="color-palette" id="pref-rect-fill-color-palette"></div>
                    <button type="button" class="color-custom-btn" id="pref-rect-fill-color-custom-btn">
                      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"/>
                        <path d="M12 2a10 10 0 0 1 0 20"/>
                      </svg>
                      More Colors...
                    </button>
                  </div>
                  <input type="color" id="pref-rect-fill-color" value="#ffff00">
                </div>
              </div>
            </div>
            <div class="pref-row">
              <label>Stroke Color</label>
              <div class="pref-color-wrapper" id="pref-rect-stroke-color-wrapper">
                <button type="button" class="color-picker-button" id="pref-rect-stroke-color-btn">
                  <div class="color-preview" id="pref-rect-stroke-color-preview" style="background: #000000;"></div>
                  <span class="color-hex" id="pref-rect-stroke-color-hex">#000000</span>
                  <svg class="dropdown-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M6 9l6 6 6-6"/>
                  </svg>
                </button>
                <div class="color-palette-dropdown" id="pref-rect-stroke-color-dropdown">
                  <div class="color-palette" id="pref-rect-stroke-color-palette"></div>
                  <button type="button" class="color-custom-btn" id="pref-rect-stroke-color-custom-btn">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <circle cx="12" cy="12" r="10"/>
                      <path d="M12 2a10 10 0 0 1 0 20"/>
                    </svg>
                    More Colors...
                  </button>
                </div>
                <input type="color" id="pref-rect-stroke-color" value="#000000">
              </div>
            </div>
            <div class="pref-row">
              <label for="pref-rect-border-width">Border Width</label>
              <input type="number" id="pref-rect-border-width" min="1" max="20" value="2">
            </div>
            <div class="pref-row">
              <label for="pref-rect-border-style">Border Style</label>
              <select id="pref-rect-border-style">
                <option value="solid">Solid</option>
                <option value="dashed">Dashed</option>
                <option value="dotted">Dotted</option>
              </select>
            </div>
            <div class="pref-row">
              <label for="pref-rect-opacity">Opacity (%)</label>
              <input type="number" id="pref-rect-opacity" min="10" max="100" value="100">
            </div>
          </div>

          <div class="preferences-section">
            <h3>Ellipse Defaults</h3>
            <div class="pref-row">
              <label>Fill Color</label>
              <div class="pref-color-row">
                <label class="pref-fill-none-checkbox">
                  <input type="checkbox" id="pref-circle-fill-none" checked>
                  <span>None</span>
                </label>
                <div class="pref-color-wrapper" id="pref-circle-fill-color-wrapper">
                  <button type="button" class="color-picker-button" id="pref-circle-fill-color-btn" disabled>
                    <div class="color-preview" id="pref-circle-fill-color-preview" style="background: #ffff00;"></div>
                    <span class="color-hex" id="pref-circle-fill-color-hex">#FFFF00</span>
                    <svg class="dropdown-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M6 9l6 6 6-6"/>
                    </svg>
                  </button>
                  <div class="color-palette-dropdown" id="pref-circle-fill-color-dropdown">
                    <div class="color-palette" id="pref-circle-fill-color-palette"></div>
                    <button type="button" class="color-custom-btn" id="pref-circle-fill-color-custom-btn">
                      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"/>
                        <path d="M12 2a10 10 0 0 1 0 20"/>
                      </svg>
                      More Colors...
                    </button>
                  </div>
                  <input type="color" id="pref-circle-fill-color" value="#ffff00">
                </div>
              </div>
            </div>
            <div class="pref-row">
              <label>Stroke Color</label>
              <div class="pref-color-wrapper" id="pref-circle-stroke-color-wrapper">
                <button type="button" class="color-picker-button" id="pref-circle-stroke-color-btn">
                  <div class="color-preview" id="pref-circle-stroke-color-preview" style="background: #000000;"></div>
                  <span class="color-hex" id="pref-circle-stroke-color-hex">#000000</span>
                  <svg class="dropdown-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M6 9l6 6 6-6"/>
                  </svg>
                </button>
                <div class="color-palette-dropdown" id="pref-circle-stroke-color-dropdown">
                  <div class="color-palette" id="pref-circle-stroke-color-palette"></div>
                  <button type="button" class="color-custom-btn" id="pref-circle-stroke-color-custom-btn">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <circle cx="12" cy="12" r="10"/>
                      <path d="M12 2a10 10 0 0 1 0 20"/>
                    </svg>
                    More Colors...
                  </button>
                </div>
                <input type="color" id="pref-circle-stroke-color" value="#000000">
              </div>
            </div>
            <div class="pref-row">
              <label for="pref-circle-border-width">Border Width</label>
              <input type="number" id="pref-circle-border-width" min="1" max="20" value="2">
            </div>
            <div class="pref-row">
              <label for="pref-circle-border-style">Border Style</label>
              <select id="pref-circle-border-style">
                <option value="solid">Solid</option>
                <option value="dashed">Dashed</option>
                <option value="dotted">Dotted</option>
              </select>
            </div>
            <div class="pref-row">
              <label for="pref-circle-opacity">Opacity (%)</label>
              <input type="number" id="pref-circle-opacity" min="10" max="100" value="100">
            </div>
          </div>

          <div class="preferences-section">
            <h3>Polygon Defaults</h3>
            <div class="pref-row">
              <label>Stroke Color</label>
              <div class="pref-color-wrapper" id="pref-polygon-stroke-color-wrapper">
                <button type="button" class="color-picker-button" id="pref-polygon-stroke-color-btn">
                  <div class="color-preview" id="pref-polygon-stroke-color-preview" style="background: #000000;"></div>
                  <span class="color-hex" id="pref-polygon-stroke-color-hex">#000000</span>
                  <svg class="dropdown-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M6 9l6 6 6-6"/>
                  </svg>
                </button>
                <div class="color-palette-dropdown" id="pref-polygon-stroke-color-dropdown">
                  <div class="color-palette" id="pref-polygon-stroke-color-palette"></div>
                  <button type="button" class="color-custom-btn" id="pref-polygon-stroke-color-custom-btn">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <circle cx="12" cy="12" r="10"/>
                      <path d="M12 2a10 10 0 0 1 0 20"/>
                    </svg>
                    More Colors...
                  </button>
                </div>
                <input type="color" id="pref-polygon-stroke-color" value="#000000">
              </div>
            </div>
            <div class="pref-row">
              <label for="pref-polygon-line-width">Line Width</label>
              <input type="number" id="pref-polygon-line-width" min="1" max="20" value="2">
            </div>
            <div class="pref-row">
              <label for="pref-polygon-opacity">Opacity (%)</label>
              <input type="number" id="pref-polygon-opacity" min="10" max="100" value="100">
            </div>
          </div>

          <div class="preferences-section">
            <h3>Cloud Defaults</h3>
            <div class="pref-row">
              <label>Stroke Color</label>
              <div class="pref-color-wrapper" id="pref-cloud-stroke-color-wrapper">
                <button type="button" class="color-picker-button" id="pref-cloud-stroke-color-btn">
                  <div class="color-preview" id="pref-cloud-stroke-color-preview" style="background: #000000;"></div>
                  <span class="color-hex" id="pref-cloud-stroke-color-hex">#000000</span>
                  <svg class="dropdown-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M6 9l6 6 6-6"/>
                  </svg>
                </button>
                <div class="color-palette-dropdown" id="pref-cloud-stroke-color-dropdown">
                  <div class="color-palette" id="pref-cloud-stroke-color-palette"></div>
                  <button type="button" class="color-custom-btn" id="pref-cloud-stroke-color-custom-btn">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <circle cx="12" cy="12" r="10"/>
                      <path d="M12 2a10 10 0 0 1 0 20"/>
                    </svg>
                    More Colors...
                  </button>
                </div>
                <input type="color" id="pref-cloud-stroke-color" value="#000000">
              </div>
            </div>
            <div class="pref-row">
              <label for="pref-cloud-line-width">Line Width</label>
              <input type="number" id="pref-cloud-line-width" min="1" max="20" value="2">
            </div>
            <div class="pref-row">
              <label for="pref-cloud-opacity">Opacity (%)</label>
              <input type="number" id="pref-cloud-opacity" min="10" max="100" value="100">
            </div>
          </div>
        </div>

        <!-- Markup Tab (Redaction, Measurement) -->
        <div class="pref-tab-content" id="pref-tab-markup">
          <div class="preferences-section">
            <h3>Redaction Defaults</h3>
            <div class="pref-row">
              <label>Overlay Color</label>
              <div class="pref-color-wrapper" id="pref-redaction-color-wrapper">
                <button type="button" class="color-picker-button" id="pref-redaction-color-btn">
                  <div class="color-preview" id="pref-redaction-color-preview" style="background: #000000;"></div>
                  <span class="color-hex" id="pref-redaction-color-hex">#000000</span>
                  <svg class="dropdown-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M6 9l6 6 6-6"/>
                  </svg>
                </button>
                <div class="color-palette-dropdown" id="pref-redaction-color-dropdown">
                  <div class="color-palette" id="pref-redaction-color-palette"></div>
                  <button type="button" class="color-custom-btn" id="pref-redaction-color-custom-btn">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <circle cx="12" cy="12" r="10"/>
                      <path d="M12 2a10 10 0 0 1 0 20"/>
                    </svg>
                    More Colors...
                  </button>
                </div>
                <input type="color" id="pref-redaction-color" value="#000000">
              </div>
            </div>
          </div>

          <div class="preferences-section">
            <h3>Measurement Defaults</h3>
            <div class="pref-row">
              <label>Stroke Color</label>
              <div class="pref-color-wrapper" id="pref-measure-stroke-color-wrapper">
                <button type="button" class="color-picker-button" id="pref-measure-stroke-color-btn">
                  <div class="color-preview" id="pref-measure-stroke-color-preview" style="background: #ff0000;"></div>
                  <span class="color-hex" id="pref-measure-stroke-color-hex">#FF0000</span>
                  <svg class="dropdown-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M6 9l6 6 6-6"/>
                  </svg>
                </button>
                <div class="color-palette-dropdown" id="pref-measure-stroke-color-dropdown">
                  <div class="color-palette" id="pref-measure-stroke-color-palette"></div>
                  <button type="button" class="color-custom-btn" id="pref-measure-stroke-color-custom-btn">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <circle cx="12" cy="12" r="10"/>
                      <path d="M12 2a10 10 0 0 1 0 20"/>
                    </svg>
                    More Colors...
                  </button>
                </div>
                <input type="color" id="pref-measure-stroke-color" value="#ff0000">
              </div>
            </div>
            <div class="pref-row">
              <label for="pref-measure-line-width">Line Width</label>
              <input type="number" id="pref-measure-line-width" min="1" max="20" value="1">
            </div>
            <div class="pref-row">
              <label for="pref-measure-opacity">Opacity (%)</label>
              <input type="number" id="pref-measure-opacity" min="10" max="100" value="100">
            </div>
          </div>
        </div>

        <!-- Behavior Tab -->
        <div class="pref-tab-content" id="pref-tab-behavior">
          <div class="preferences-section">
            <h3>Startup</h3>
            <div class="pref-row pref-checkbox-row">
              <label class="pref-checkbox-label">
                <input type="checkbox" id="pref-restore-session">
                <span>Restore last session when application starts</span>
              </label>
            </div>
          </div>

          <div class="preferences-section">
            <h3>Author</h3>
            <div class="pref-row">
              <label for="pref-author-name">Default Author Name</label>
              <input type="text" id="pref-author-name" value="User">
            </div>
          </div>

          <div class="preferences-section">
            <h3>Snapping</h3>
            <div class="pref-row">
              <label for="pref-angle-snap">Angle Snap (degrees)</label>
              <input type="number" id="pref-angle-snap" min="1" max="90" value="30">
            </div>
            <div class="pref-row pref-checkbox-row">
              <label class="pref-checkbox-label">
                <input type="checkbox" id="pref-enable-angle-snap" checked>
                <span>Enable Angle Snapping (hold Shift)</span>
              </label>
            </div>
            <div class="pref-row">
              <label for="pref-grid-size">Grid Size (pixels)</label>
              <input type="number" id="pref-grid-size" min="5" max="100" value="10">
            </div>
            <div class="pref-row pref-checkbox-row">
              <label class="pref-checkbox-label">
                <input type="checkbox" id="pref-enable-grid-snap">
                <span>Enable Grid Snapping</span>
              </label>
            </div>
            <div class="pref-row pref-checkbox-row">
              <label class="pref-checkbox-label">
                <input type="checkbox" id="pref-show-grid">
                <span>Show Grid Overlay</span>
              </label>
            </div>
          </div>

          <div class="preferences-section">
            <h3>Creation</h3>
            <div class="pref-row pref-checkbox-row">
              <label class="pref-checkbox-label">
                <input type="checkbox" id="pref-auto-select" checked>
                <span>Auto-select annotation after creation</span>
              </label>
            </div>
          </div>

          <div class="preferences-section">
            <h3>Deletion</h3>
            <div class="pref-row pref-checkbox-row">
              <label class="pref-checkbox-label">
                <input type="checkbox" id="pref-confirm-delete" checked>
                <span>Confirm before deleting annotations</span>
              </label>
            </div>
          </div>
        </div>

        <!-- File Association Tab -->
        <div class="pref-tab-content" id="pref-tab-fileassoc">
          <div class="preferences-section">
            <h3>Default PDF Application</h3>
            <div class="pref-row">
              <label>Current default:</label>
              <span id="pref-current-pdf-app" style="font-size: 11px; color: #666;">Checking...</span>
            </div>
            <div class="pref-row" style="margin-top: 12px;">
              <button type="button" class="pref-btn pref-btn-secondary" id="pref-set-default-app" style="width: 100%;">
                Set Open PDF Studio as Default PDF Viewer
              </button>
            </div>
            <p style="font-size: 10px; color: #888; margin-top: 12px; line-height: 1.4;">
              This will open your system settings where you can select Open PDF Studio as the default application for opening PDF files.
            </p>
          </div>
        </div>

        <!-- Virtual Printer Tab -->
        <div class="pref-tab-content" id="pref-tab-vprinter">
          <div class="preferences-section">
            <h3>Virtual Printer</h3>
            <p style="font-size: 11px; color: #555; margin-bottom: 12px; line-height: 1.4;">
              Install "Open PDF Studio" as a Windows printer. When you print from any application (Word, Chrome, Notepad, etc.) and select this printer, the output PDF will open automatically in this app.
            </p>
            <div class="pref-row">
              <label>Status:</label>
              <span id="pref-vprinter-status" style="font-size: 11px; color: #666;">Checking...</span>
            </div>
            <div class="pref-row" style="margin-top: 12px;">
              <button type="button" class="pref-btn pref-btn-primary" id="pref-vprinter-install-btn" style="width: 100%; display: none;">
                Install Virtual Printer
              </button>
              <button type="button" class="pref-btn pref-btn-secondary" id="pref-vprinter-remove-btn" style="width: 100%; display: none;">
                Remove Virtual Printer
              </button>
            </div>
            <p style="font-size: 10px; color: #888; margin-top: 12px; line-height: 1.4;">
              Installation requires administrator privileges (UAC prompt). The printer uses the built-in "Microsoft Print to PDF" driver.
            </p>
          </div>
        </div>
      </div>
      <div class="preferences-footer">
        <button class="pref-btn pref-btn-secondary" id="pref-reset-btn">Reset to Defaults</button>
        <div class="pref-footer-right">
          <button class="pref-btn pref-btn-secondary" id="pref-cancel-btn">Cancel</button>
          <button class="pref-btn pref-btn-primary" id="pref-save-btn">Save</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Text Annotation Dialog -->
  <div class="text-annot-overlay" id="text-annot-dialog">
    <div class="text-annot-dialog">
      <div class="text-annot-header">
        <h2>Add Text Annotation</h2>
        <button class="text-annot-close-btn" id="text-annot-close-btn">&times;</button>
      </div>
      <div class="text-annot-body">
        <div class="text-annot-toolbar">
          <div class="text-annot-toolbar-group">
            <select id="text-annot-font-family" title="Font Family">
              <option value="Arial">Arial</option>
            </select>
            <select id="text-annot-font-size" title="Font Size">
              <option value="8">8</option>
              <option value="9">9</option>
              <option value="10">10</option>
              <option value="11">11</option>
              <option value="12">12</option>
              <option value="14">14</option>
              <option value="16" selected>16</option>
              <option value="18">18</option>
              <option value="20">20</option>
              <option value="24">24</option>
              <option value="28">28</option>
              <option value="32">32</option>
              <option value="36">36</option>
              <option value="48">48</option>
              <option value="64">64</option>
              <option value="72">72</option>
            </select>
          </div>
          <div class="text-annot-toolbar-separator"></div>
          <div class="text-annot-toolbar-group">
            <button type="button" class="text-annot-toolbar-btn" id="text-annot-bold" title="Bold (Ctrl+B)">
              <svg viewBox="0 0 24 24" width="16" height="16" fill="currentColor"><path d="M15.6 10.79c.97-.67 1.65-1.77 1.65-2.79 0-2.26-1.75-4-4-4H7v14h7.04c2.09 0 3.71-1.7 3.71-3.79 0-1.52-.86-2.82-2.15-3.42zM10 6.5h3c.83 0 1.5.67 1.5 1.5s-.67 1.5-1.5 1.5h-3v-3zm3.5 9H10v-3h3.5c.83 0 1.5.67 1.5 1.5s-.67 1.5-1.5 1.5z"/></svg>
            </button>
            <button type="button" class="text-annot-toolbar-btn" id="text-annot-italic" title="Italic (Ctrl+I)">
              <svg viewBox="0 0 24 24" width="16" height="16" fill="currentColor"><path d="M10 4v3h2.21l-3.42 8H6v3h8v-3h-2.21l3.42-8H18V4z"/></svg>
            </button>
            <button type="button" class="text-annot-toolbar-btn" id="text-annot-underline" title="Underline (Ctrl+U)">
              <svg viewBox="0 0 24 24" width="16" height="16" fill="currentColor"><path d="M12 17c3.31 0 6-2.69 6-6V3h-2.5v8c0 1.93-1.57 3.5-3.5 3.5S8.5 12.93 8.5 11V3H6v8c0 3.31 2.69 6 6 6zm-7 2v2h14v-2H5z"/></svg>
            </button>
          </div>
          <div class="text-annot-toolbar-separator"></div>
          <div class="text-annot-toolbar-group">
            <button type="button" class="text-annot-toolbar-btn" id="text-annot-align-left" title="Align Left">
              <svg viewBox="0 0 24 24" width="16" height="16" fill="currentColor"><path d="M15 15H3v2h12v-2zm0-8H3v2h12V7zM3 13h18v-2H3v2zm0 8h18v-2H3v2zM3 3v2h18V3H3z"/></svg>
            </button>
            <button type="button" class="text-annot-toolbar-btn" id="text-annot-align-center" title="Align Center">
              <svg viewBox="0 0 24 24" width="16" height="16" fill="currentColor"><path d="M7 15v2h10v-2H7zm-4 6h18v-2H3v2zm0-8h18v-2H3v2zm4-6v2h10V7H7zM3 3v2h18V3H3z"/></svg>
            </button>
            <button type="button" class="text-annot-toolbar-btn" id="text-annot-align-right" title="Align Right">
              <svg viewBox="0 0 24 24" width="16" height="16" fill="currentColor"><path d="M3 21h18v-2H3v2zm6-4h12v-2H9v2zm-6-4h18v-2H3v2zm6-4h12V7H9v2zM3 3v2h18V3H3z"/></svg>
            </button>
          </div>
          <div class="text-annot-toolbar-separator"></div>
          <div class="text-annot-toolbar-group">
            <div class="text-annot-color-picker">
              <label title="Text Color">
                <div class="text-annot-color-swatch" id="text-annot-color-preview" style="background: #000000;"></div>
                <input type="color" id="text-annot-color" value="#000000">
              </label>
            </div>
          </div>
        </div>
        <textarea id="text-annot-input" placeholder="Type your text here..." spellcheck="true"></textarea>
        <div class="text-annot-preview-label">Preview:</div>
        <div class="text-annot-preview" id="text-annot-preview"></div>
      </div>
      <div class="text-annot-footer">
        <div class="text-annot-char-count"><span id="text-annot-char-count">0</span> characters</div>
        <div class="text-annot-footer-right">
          <button class="pref-btn pref-btn-secondary" id="text-annot-cancel-btn">Cancel</button>
          <button class="pref-btn pref-btn-primary" id="text-annot-ok-btn">OK</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Annotation Context Menu -->
  <div class="context-menu" id="annotation-context-menu">
    <div class="context-menu-item" data-action="open-popup">
      <span class="context-menu-icon">
        <svg viewBox="0 0 16 16" fill="currentColor"><path d="M2 2h12v10H6l-4 3v-3H2V2zm1 1v8h1v2l2.5-2H13V3H3z"/></svg>
      </span>
      <span class="context-menu-label">Open Pop-Up Note</span>
    </div>
    <div class="context-menu-item" data-action="hide-popup">
      <span class="context-menu-icon">
        <svg viewBox="0 0 16 16" fill="currentColor"><path d="M2 2h12v10H6l-4 3v-3H2V2zm1 1v8h1v2l2.5-2H13V3H3z" opacity="0.4"/></svg>
      </span>
      <span class="context-menu-label">Hide Pop-Up Note</span>
    </div>
    <div class="context-menu-item" data-action="reset-popup">
      <span class="context-menu-icon">
        <svg viewBox="0 0 16 16" fill="currentColor"><path d="M8 3a5 5 0 1 0 4.546 2.914l.908-.419A6 6 0 1 1 8 2v1z"/><path d="M8 0v4l3-2-3-2z"/></svg>
      </span>
      <span class="context-menu-label">Reset Pop-Up Note Location</span>
    </div>
    <div class="context-menu-separator"></div>
    <div class="context-menu-item" data-action="cut">
      <span class="context-menu-icon">
        <svg viewBox="0 0 16 16" fill="currentColor"><path d="M4 2.5a2.5 2.5 0 1 1 3.164 2.414L8.5 7.25l1.336-2.336a2.5 2.5 0 1 1 1.414 0L9.914 7.25 13 12.5V14H3v-1.5L6.086 7.25 4.75 4.914A2.5 2.5 0 0 1 4 2.5zm2.5 1a1 1 0 1 0-2 0 1 1 0 0 0 2 0zm5 0a1 1 0 1 0-2 0 1 1 0 0 0 2 0z"/></svg>
      </span>
      <span class="context-menu-label">Cut</span>
      <span class="context-menu-shortcut">Ctrl+X</span>
    </div>
    <div class="context-menu-item" data-action="copy">
      <span class="context-menu-icon">
        <svg viewBox="0 0 16 16" fill="currentColor"><path d="M4 2a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V2zm2-1a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1H6z"/><path d="M2 5a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1v-1h1v1a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h1v1H2z"/></svg>
      </span>
      <span class="context-menu-label">Copy</span>
      <span class="context-menu-shortcut">Ctrl+C</span>
    </div>
    <div class="context-menu-item" data-action="paste">
      <span class="context-menu-icon">
        <svg viewBox="0 0 16 16" fill="currentColor"><path d="M10 1.5a.5.5 0 0 0-.5-.5h-3a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h3a.5.5 0 0 0 .5-.5v-1zm-5 0A1.5 1.5 0 0 1 6.5 0h3A1.5 1.5 0 0 1 11 1.5v1A1.5 1.5 0 0 1 9.5 4h-3A1.5 1.5 0 0 1 5 2.5v-1zm-2 0h1v1A2.5 2.5 0 0 0 6.5 5h3A2.5 2.5 0 0 0 12 2.5v-1h1a2 2 0 0 1 2 2V14a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V3.5a2 2 0 0 1 2-2z"/></svg>
      </span>
      <span class="context-menu-label">Paste</span>
      <span class="context-menu-shortcut">Ctrl+V</span>
    </div>
    <div class="context-menu-separator"></div>
    <div class="context-menu-item" data-action="delete">
      <span class="context-menu-icon">
        <svg viewBox="0 0 16 16" fill="currentColor"><path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6z"/><path d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1z"/></svg>
      </span>
      <span class="context-menu-label">Delete</span>
      <span class="context-menu-shortcut">Delete</span>
    </div>
    <div class="context-menu-item" data-action="flatten">
      <span class="context-menu-icon">
        <svg viewBox="0 0 16 16" fill="currentColor"><path d="M1 3.5A1.5 1.5 0 0 1 2.5 2h11A1.5 1.5 0 0 1 15 3.5v9a1.5 1.5 0 0 1-1.5 1.5h-11A1.5 1.5 0 0 1 1 12.5v-9z"/></svg>
      </span>
      <span class="context-menu-label">Flatten</span>
    </div>
    <div class="context-menu-separator"></div>
    <div class="context-menu-item" data-action="add-reply">
      <span class="context-menu-icon">
        <svg viewBox="0 0 16 16" fill="currentColor"><path d="M5 3l-.65.65 3.5 3.5H1v1h6.85l-3.5 3.5.65.65 4.5-4.5L5 3z"/><path d="M10 2h4v12h-4v-1h3V3h-3V2z"/></svg>
      </span>
      <span class="context-menu-label">Add Reply</span>
    </div>
    <div class="context-menu-separator"></div>
    <div class="context-menu-item context-menu-checkbox" data-action="locked">
      <span class="context-menu-icon">
        <svg viewBox="0 0 16 16" fill="currentColor"><path d="M8 1a2 2 0 0 1 2 2v4H6V3a2 2 0 0 1 2-2zm3 6V3a3 3 0 0 0-6 0v4a2 2 0 0 0-2 2v5a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2z"/></svg>
      </span>
      <span class="context-menu-label">Locked</span>
      <span class="context-menu-check"></span>
    </div>
    <div class="context-menu-item context-menu-checkbox" data-action="marked">
      <span class="context-menu-icon">
        <svg viewBox="0 0 16 16" fill="currentColor"><path d="M2 2v13.5a.5.5 0 0 0 .74.439L8 13.069l5.26 2.87A.5.5 0 0 0 14 15.5V2a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2z"/></svg>
      </span>
      <span class="context-menu-label">Marked</span>
      <span class="context-menu-check"></span>
    </div>
    <div class="context-menu-item context-menu-checkbox checked" data-action="printable">
      <span class="context-menu-icon">
        <svg viewBox="0 0 16 16" fill="currentColor"><path d="M5 1a2 2 0 0 0-2 2v1h10V3a2 2 0 0 0-2-2H5zm6 8H5a1 1 0 0 0-1 1v3a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1v-3a1 1 0 0 0-1-1z"/><path d="M0 7a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2h-1v-2a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v2H2a2 2 0 0 1-2-2V7zm2.5 1a.5.5 0 1 0 0-1 .5.5 0 0 0 0 1z"/></svg>
      </span>
      <span class="context-menu-label">Printable</span>
      <span class="context-menu-check"></span>
    </div>
    <div class="context-menu-separator"></div>
    <div class="context-menu-item context-menu-submenu" data-action="status">
      <span class="context-menu-icon">
        <svg viewBox="0 0 16 16" fill="currentColor"><path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/><path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3.5a.5.5 0 0 1-.5-.5v-3.5A.5.5 0 0 1 8 4z"/></svg>
      </span>
      <span class="context-menu-label">Status</span>
      <span class="context-menu-arrow"></span>
    </div>
    <div class="context-menu-item" data-action="review-history">
      <span class="context-menu-icon">
        <svg viewBox="0 0 16 16" fill="currentColor"><path d="M8 3.5a.5.5 0 0 0-1 0V9a.5.5 0 0 0 .252.434l3.5 2a.5.5 0 0 0 .496-.868L8 8.71V3.5z"/><path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm7-8A7 7 0 1 1 1 8a7 7 0 0 1 14 0z"/></svg>
      </span>
      <span class="context-menu-label">Review History...</span>
    </div>
    <div class="context-menu-separator"></div>
    <div class="context-menu-item context-menu-submenu" data-action="layer">
      <span class="context-menu-icon">
        <svg viewBox="0 0 16 16" fill="currentColor"><path d="M8.235 1.559a.5.5 0 0 0-.47 0l-7.5 4a.5.5 0 0 0 0 .882L3.188 8 .264 9.559a.5.5 0 0 0 0 .882l7.5 4a.5.5 0 0 0 .47 0l7.5-4a.5.5 0 0 0 0-.882L12.813 8l2.922-1.559a.5.5 0 0 0 0-.882l-7.5-4z"/></svg>
      </span>
      <span class="context-menu-label">Layer: <span class="context-menu-value">None</span></span>
      <span class="context-menu-arrow"></span>
    </div>
    <div class="context-menu-item context-menu-submenu" data-action="arrange">
      <span class="context-menu-icon">
        <svg viewBox="0 0 16 16" fill="currentColor"><path d="M0 2a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v2h2a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2v-2H2a2 2 0 0 1-2-2V2z"/></svg>
      </span>
      <span class="context-menu-label">Arrange</span>
      <span class="context-menu-arrow"></span>
      <div class="context-menu-submenu-content">
        <div class="arrange-icon-grid">
          <button class="arrange-icon-btn" data-action="bring-to-front" title="Bring to Front">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="3" y="3" width="10" height="10" fill="#4a90d9" stroke="#2d5a8a"/>
              <rect x="11" y="11" width="10" height="10" fill="#f0f0f0" stroke="#999"/>
            </svg>
          </button>
          <button class="arrange-icon-btn" data-action="send-to-back" title="Send to Back">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="11" y="11" width="10" height="10" fill="#4a90d9" stroke="#2d5a8a"/>
              <rect x="3" y="3" width="10" height="10" fill="#f0f0f0" stroke="#999"/>
            </svg>
          </button>
          <button class="arrange-icon-btn" data-action="bring-forward" title="Bring Forward">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="3" y="8" width="8" height="8" fill="#ddd" stroke="#999"/>
              <rect x="8" y="5" width="8" height="8" fill="#4a90d9" stroke="#2d5a8a"/>
              <rect x="13" y="8" width="8" height="8" fill="#f0f0f0" stroke="#999"/>
            </svg>
          </button>
          <button class="arrange-icon-btn" data-action="send-backward" title="Send Backward">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="3" y="8" width="8" height="8" fill="#f0f0f0" stroke="#999"/>
              <rect x="8" y="5" width="8" height="8" fill="#4a90d9" stroke="#2d5a8a"/>
              <rect x="13" y="8" width="8" height="8" fill="#ddd" stroke="#999"/>
            </svg>
          </button>
        </div>
        <div class="arrange-icon-grid">
          <button class="arrange-icon-btn" data-action="rotate-left" title="Rotate Left 90">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M4 12a8 8 0 0 1 14-5.3" stroke="#4a90d9"/>
              <path d="M4 7v5h5" stroke="#4a90d9" fill="none"/>
              <polygon points="10,10 18,10 18,18 10,18" fill="#4a90d9" stroke="#2d5a8a"/>
            </svg>
          </button>
          <button class="arrange-icon-btn" data-action="rotate-right" title="Rotate Right 90">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M20 12a8 8 0 0 0-14-5.3" stroke="#4a90d9"/>
              <path d="M20 7v5h-5" stroke="#4a90d9" fill="none"/>
              <polygon points="6,10 14,10 14,18 6,18" fill="#4a90d9" stroke="#2d5a8a"/>
            </svg>
          </button>
          <button class="arrange-icon-btn" data-action="flip-horizontal" title="Flip Horizontal">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polygon points="4,6 10,6 10,18 4,18" fill="#4a90d9" stroke="#2d5a8a"/>
              <line x1="12" y1="4" x2="12" y2="20" stroke="#999" stroke-dasharray="2,2"/>
              <polygon points="14,6 20,6 20,18 14,18" fill="#f0f0f0" stroke="#999"/>
            </svg>
          </button>
          <button class="arrange-icon-btn" data-action="flip-vertical" title="Flip Vertical">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polygon points="6,4 18,4 18,10 6,10" fill="#4a90d9" stroke="#2d5a8a"/>
              <line x1="4" y1="12" x2="20" y2="12" stroke="#999" stroke-dasharray="2,2"/>
              <polygon points="6,14 18,14 18,20 6,20" fill="#f0f0f0" stroke="#999"/>
            </svg>
          </button>
        </div>
        <div class="context-menu-separator"></div>
        <div class="context-menu-item" data-action="transform">
          <span class="context-menu-icon">
            <svg viewBox="0 0 16 16" fill="currentColor"><path d="M0 2a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V2zm4.5 0a.5.5 0 0 0-.5.5v11a.5.5 0 0 0 .5.5h7a.5.5 0 0 0 .5-.5v-11a.5.5 0 0 0-.5-.5h-7z"/></svg>
          </span>
          <span class="context-menu-label">Transform...</span>
        </div>
        <div class="context-menu-item" data-action="duplicate">
          <span class="context-menu-icon">
            <svg viewBox="0 0 16 16" fill="currentColor"><path d="M4 2a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V2zm2-1a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1H6zM2 5a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1v-1h1v1a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h1v1H2z"/></svg>
          </span>
          <span class="context-menu-label">Duplicate</span>
        </div>
      </div>
    </div>
    <div class="context-menu-separator"></div>
    <div class="context-menu-item" data-action="flip-line">
      <span class="context-menu-icon">
        <svg viewBox="0 0 16 16" fill="currentColor"><path d="M8 3a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 3zm4 8a.5.5 0 0 1-.5.5h-7a.5.5 0 0 1 0-1h7a.5.5 0 0 1 .5.5z"/><path d="M8 0a.5.5 0 0 1 .5.5v.514A6.5 6.5 0 0 1 14 7.5a.5.5 0 0 1-1 0A5.5 5.5 0 0 0 8.5 2.015V2.5a.5.5 0 0 1-1 0v-.486A5.5 5.5 0 0 0 3 7.5a.5.5 0 0 1-1 0 6.5 6.5 0 0 1 5.5-6.486V.5A.5.5 0 0 1 8 0z"/></svg>
      </span>
      <span class="context-menu-label">Flip Line</span>
    </div>
    <div class="context-menu-separator"></div>
    <div class="context-menu-item" data-action="convert-measurement">
      <span class="context-menu-icon">
        <svg viewBox="0 0 16 16" fill="currentColor"><path d="M1 0a1 1 0 0 0-1 1v14a1 1 0 0 0 1 1h5v-1H2v-1h4v-1H4v-1h2v-1H2v-1h4V9H4V8h2V7H2V6h4V2h1v4h1V4h1v2h1V2h1v4h1V4h1v2h1V1a1 1 0 0 0-1-1H1z"/></svg>
      </span>
      <span class="context-menu-label">Convert to Measurement</span>
    </div>
    <div class="context-menu-item" data-action="convert-polyline">
      <span class="context-menu-icon">
        <svg viewBox="0 0 16 16" fill="currentColor"><path d="M2 2l4 4 4-2 4 6" stroke="currentColor" stroke-width="1.5" fill="none"/><circle cx="2" cy="2" r="1.5"/><circle cx="6" cy="6" r="1.5"/><circle cx="10" cy="4" r="1.5"/><circle cx="14" cy="10" r="1.5"/></svg>
      </span>
      <span class="context-menu-label">Convert to Polyline</span>
    </div>
    <div class="context-menu-item" data-action="convert-polygon">
      <span class="context-menu-icon">
        <svg viewBox="0 0 16 16" fill="currentColor"><path d="M8 1l6 4.5v5L8 15l-6-4.5v-5L8 1z" stroke="currentColor" stroke-width="1" fill="none"/></svg>
      </span>
      <span class="context-menu-label">Convert to Polygon</span>
    </div>
    <div class="context-menu-separator"></div>
    <div class="context-menu-item context-menu-submenu" data-action="style-tools">
      <span class="context-menu-icon">
        <svg viewBox="0 0 16 16" fill="currentColor"><path d="M15.825.12a.5.5 0 0 1 .132.584c-1.53 3.43-4.743 8.17-7.095 10.64a6.067 6.067 0 0 1-2.373 1.534c-.018.227-.06.538-.16.868-.201.659-.667 1.479-1.708 1.74a8.118 8.118 0 0 1-3.078.132 3.659 3.659 0 0 1-.562-.135 1.382 1.382 0 0 1-.466-.247.714.714 0 0 1-.204-.288.622.622 0 0 1 .004-.443c.095-.245.316-.38.461-.452.394-.197.625-.453.867-.826.095-.144.184-.297.287-.472l.117-.198c.151-.255.326-.54.546-.848.528-.739 1.201-.925 1.746-.896.126.007.243.025.348.048.062-.172.142-.38.238-.608.261-.619.658-1.419 1.187-2.069 2.176-2.67 6.18-6.206 9.117-8.104a.5.5 0 0 1 .596.04z"/></svg>
      </span>
      <span class="context-menu-label">Style Tools</span>
      <span class="context-menu-arrow"></span>
    </div>
    <div class="context-menu-item context-menu-submenu" data-action="export">
      <span class="context-menu-icon">
        <svg viewBox="0 0 16 16" fill="currentColor"><path d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5z"/><path d="M7.646 1.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1-.708.708L8.5 2.707V11.5a.5.5 0 0 1-1 0V2.707L5.354 4.854a.5.5 0 1 1-.708-.708l3-3z"/></svg>
      </span>
      <span class="context-menu-label">Export</span>
      <span class="context-menu-arrow"></span>
    </div>
    <div class="context-menu-separator"></div>
    <div class="context-menu-item" data-action="properties">
      <span class="context-menu-icon">
        <svg viewBox="0 0 16 16" fill="currentColor"><path d="M8 4.754a3.246 3.246 0 1 0 0 6.492 3.246 3.246 0 0 0 0-6.492zM5.754 8a2.246 2.246 0 1 1 4.492 0 2.246 2.246 0 0 1-4.492 0z"/><path d="M9.796 1.343c-.527-1.79-3.065-1.79-3.592 0l-.094.319a.873.873 0 0 1-1.255.52l-.292-.16c-1.64-.892-3.433.902-2.54 2.541l.159.292a.873.873 0 0 1-.52 1.255l-.319.094c-1.79.527-1.79 3.065 0 3.592l.319.094a.873.873 0 0 1 .52 1.255l-.16.292c-.892 1.64.901 3.434 2.541 2.54l.292-.159a.873.873 0 0 1 1.255.52l.094.319c.527 1.79 3.065 1.79 3.592 0l.094-.319a.873.873 0 0 1 1.255-.52l.292.16c1.64.893 3.434-.902 2.54-2.541l-.159-.292a.873.873 0 0 1 .52-1.255l.319-.094c1.79-.527 1.79-3.065 0-3.592l-.319-.094a.873.873 0 0 1-.52-1.255l.16-.292c.893-1.64-.902-3.433-2.541-2.54l-.292.159a.873.873 0 0 1-1.255-.52l-.094-.319z"/></svg>
      </span>
      <span class="context-menu-label">Properties...</span>
    </div>
  </div>

  <!-- Page Context Menu (when nothing is selected) -->
  <div class="context-menu" id="page-context-menu">
    <div class="context-menu-item context-menu-submenu" data-action="add-bookmark">
      <span class="context-menu-icon">
        <svg viewBox="0 0 16 16" fill="currentColor"><path d="M2 2a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v13.5a.5.5 0 0 1-.777.416L8 13.101l-5.223 2.815A.5.5 0 0 1 2 15.5V2zm2-1a1 1 0 0 0-1 1v12.566l4.723-2.482a.5.5 0 0 1 .554 0L13 14.566V2a1 1 0 0 0-1-1H4z"/></svg>
      </span>
      <span class="context-menu-label">Add Bookmark</span>
      <span class="context-menu-shortcut">Ctrl+Shift+B</span>
      <span class="context-menu-arrow"></span>
    </div>
    <div class="context-menu-item" data-action="add-sticky-note">
      <span class="context-menu-icon">
        <svg viewBox="0 0 16 16" fill="currentColor"><path d="M2.5 1A1.5 1.5 0 0 0 1 2.5v11A1.5 1.5 0 0 0 2.5 15h6.086a1.5 1.5 0 0 0 1.06-.44l4.915-4.914A1.5 1.5 0 0 0 15 8.586V2.5A1.5 1.5 0 0 0 13.5 1h-11zM2 2.5a.5.5 0 0 1 .5-.5h11a.5.5 0 0 1 .5.5V8H9.5A1.5 1.5 0 0 0 8 9.5V14H2.5a.5.5 0 0 1-.5-.5v-11zm7 11.293V9.5a.5.5 0 0 1 .5-.5h4.293L9 13.793z"/></svg>
      </span>
      <span class="context-menu-label">Add Sticky Note</span>
    </div>
    <div class="context-menu-separator"></div>
    <div class="context-menu-item" data-action="add-image">
      <span class="context-menu-icon">
        <svg viewBox="0 0 16 16" fill="currentColor"><path d="M6.002 5.5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0z"/><path d="M2.002 1a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V3a2 2 0 0 0-2-2h-12zm12 1a1 1 0 0 1 1 1v6.5l-3.777-1.947a.5.5 0 0 0-.577.093l-3.71 3.71-2.66-1.772a.5.5 0 0 0-.63.062L1.002 12V3a1 1 0 0 1 1-1h12z"/></svg>
      </span>
      <span class="context-menu-label">Add Image...</span>
    </div>
    <div class="context-menu-item" data-action="add-qr-code">
      <span class="context-menu-icon">
        <svg viewBox="0 0 16 16" fill="currentColor"><path d="M0 .5A.5.5 0 0 1 .5 0h3a.5.5 0 0 1 0 1H1v2.5a.5.5 0 0 1-1 0v-3zm12 0a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v3a.5.5 0 0 1-1 0V1h-2.5a.5.5 0 0 1-.5-.5zM.5 12a.5.5 0 0 1 .5.5V15h2.5a.5.5 0 0 1 0 1h-3a.5.5 0 0 1-.5-.5v-3a.5.5 0 0 1 .5-.5zm15 0a.5.5 0 0 1 .5.5v3a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1 0-1H15v-2.5a.5.5 0 0 1 .5-.5zM4 4h1v1H4V4zm2 0h1v1H6V4zm2 0h1v1H8V4zm0 2h1v1H8V6zm-2 0h1v1H6V6zm-2 0h1v1H4V6zm8 0h1v1h-1V6zm-2 0h1v1h-1V6zm2-2h1v1h-1V4z"/></svg>
      </span>
      <span class="context-menu-label">Add QR Code...</span>
    </div>
    <div class="context-menu-separator"></div>
    <div class="context-menu-item context-menu-checkbox" data-action="tool-hand" id="ctx-tool-hand">
      <span class="context-menu-icon">
        <svg viewBox="0 0 16 16" fill="currentColor"><path d="M8.5 1.75a.75.75 0 0 0-1.5 0V5h-1V2.75a.75.75 0 0 0-1.5 0V5h-.5A2.5 2.5 0 0 0 1.5 7.5v5A3.5 3.5 0 0 0 5 16h6a3.5 3.5 0 0 0 3.5-3.5v-6A2.5 2.5 0 0 0 12 4h-.5V1.75a.75.75 0 0 0-1.5 0V4h-1V1.75z"/></svg>
      </span>
      <span class="context-menu-label">Hand Tool</span>
      <span class="context-menu-check"></span>
    </div>
    <div class="context-menu-item context-menu-checkbox" data-action="tool-snapshot">
      <span class="context-menu-icon">
        <svg viewBox="0 0 16 16" fill="currentColor"><path d="M10.5 8.5a2.5 2.5 0 1 1-5 0 2.5 2.5 0 0 1 5 0z"/><path d="M2 4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2h-1.172a2 2 0 0 1-1.414-.586l-.828-.828A2 2 0 0 0 9.172 2H6.828a2 2 0 0 0-1.414.586l-.828.828A2 2 0 0 1 3.172 4H2zm.5 2a.5.5 0 1 1 0-1 .5.5 0 0 1 0 1zm9 2.5a3.5 3.5 0 1 1-7 0 3.5 3.5 0 0 1 7 0z"/></svg>
      </span>
      <span class="context-menu-label">Snapshot Tool</span>
      <span class="context-menu-check"></span>
    </div>
    <div class="context-menu-item context-menu-checkbox" data-action="tool-select-text">
      <span class="context-menu-icon">
        <svg viewBox="0 0 16 16" fill="currentColor"><path d="M5.5 4a.5.5 0 0 0-.5.5v7a.5.5 0 0 0 1 0V8h3v3.5a.5.5 0 0 0 1 0v-7a.5.5 0 0 0-1 0V7H6V4.5a.5.5 0 0 0-.5-.5z"/><path d="M2 2a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V2z"/></svg>
      </span>
      <span class="context-menu-label">Select Text</span>
      <span class="context-menu-check"></span>
    </div>
    <div class="context-menu-item context-menu-checkbox" data-action="tool-zoom">
      <span class="context-menu-icon">
        <svg viewBox="0 0 16 16" fill="currentColor"><path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"/><path d="M6.5 3a.5.5 0 0 1 .5.5V6h2.5a.5.5 0 0 1 0 1H7v2.5a.5.5 0 0 1-1 0V7H3.5a.5.5 0 0 1 0-1H6V3.5a.5.5 0 0 1 .5-.5z"/></svg>
      </span>
      <span class="context-menu-label">Zoom In/Out Tool</span>
      <span class="context-menu-check"></span>
    </div>
    <div class="context-menu-separator"></div>
    <div class="context-menu-item disabled" data-action="cut">
      <span class="context-menu-icon">
        <svg viewBox="0 0 16 16" fill="currentColor"><path d="M3.5 3.5c-.614-.884-.074-1.962.858-2.5L8 7.226 11.642 1c.932.538 1.472 1.616.858 2.5L8.81 8.61l1.556 2.661a2.5 2.5 0 1 1-.794.637L8 9.73l-1.572 2.177a2.5 2.5 0 1 1-.794-.637L7.19 8.61 3.5 3.5zm2.5 10a1.5 1.5 0 1 0-3 0 1.5 1.5 0 0 0 3 0zm7 0a1.5 1.5 0 1 0-3 0 1.5 1.5 0 0 0 3 0z"/></svg>
      </span>
      <span class="context-menu-label">Cut</span>
      <span class="context-menu-shortcut">Ctrl+X</span>
    </div>
    <div class="context-menu-item disabled" data-action="copy">
      <span class="context-menu-icon">
        <svg viewBox="0 0 16 16" fill="currentColor"><path d="M4 2a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V2zm2-1a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1H6zM2 5a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1v-1h1v1a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h1v1H2z"/></svg>
      </span>
      <span class="context-menu-label">Copy</span>
      <span class="context-menu-shortcut">Ctrl+C</span>
    </div>
    <div class="context-menu-item" data-action="paste">
      <span class="context-menu-icon">
        <svg viewBox="0 0 16 16" fill="currentColor"><path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/><path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/></svg>
      </span>
      <span class="context-menu-label">Paste</span>
      <span class="context-menu-shortcut">Ctrl+V</span>
    </div>
    <div class="context-menu-separator"></div>
    <div class="context-menu-item disabled" data-action="delete">
      <span class="context-menu-icon">
        <svg viewBox="0 0 16 16" fill="currentColor"><path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6z"/><path d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118zM2.5 3V2h11v1h-11z"/></svg>
      </span>
      <span class="context-menu-label">Delete</span>
      <span class="context-menu-shortcut">Delete</span>
    </div>
    <div class="context-menu-separator"></div>
    <div class="context-menu-item" data-action="select-all">
      <span class="context-menu-icon">
        <svg viewBox="0 0 16 16" fill="currentColor"><path d="M1 2.5A1.5 1.5 0 0 1 2.5 1h3A1.5 1.5 0 0 1 7 2.5v3A1.5 1.5 0 0 1 5.5 7h-3A1.5 1.5 0 0 1 1 5.5v-3zm8 0A1.5 1.5 0 0 1 10.5 1h3A1.5 1.5 0 0 1 15 2.5v3A1.5 1.5 0 0 1 13.5 7h-3A1.5 1.5 0 0 1 9 5.5v-3zm-8 8A1.5 1.5 0 0 1 2.5 9h3A1.5 1.5 0 0 1 7 10.5v3A1.5 1.5 0 0 1 5.5 15h-3A1.5 1.5 0 0 1 1 13.5v-3zm8 0A1.5 1.5 0 0 1 10.5 9h3a1.5 1.5 0 0 1 1.5 1.5v3a1.5 1.5 0 0 1-1.5 1.5h-3A1.5 1.5 0 0 1 9 13.5v-3z"/></svg>
      </span>
      <span class="context-menu-label">Select</span>
    </div>
    <div class="context-menu-item" data-action="deselect">
      <span class="context-menu-icon">
        <svg viewBox="0 0 16 16" fill="currentColor"><path d="M2 1a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1H2zm0-1h12a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V2a2 2 0 0 1 2-2z"/></svg>
      </span>
      <span class="context-menu-label">Deselect</span>
    </div>
    <div class="context-menu-separator"></div>
    <div class="context-menu-item context-menu-submenu" data-action="go-to">
      <span class="context-menu-icon">
        <svg viewBox="0 0 16 16" fill="currentColor"><path d="M4 8a.5.5 0 0 1 .5-.5h5.793L8.146 5.354a.5.5 0 1 1 .708-.708l3 3a.5.5 0 0 1 0 .708l-3 3a.5.5 0 0 1-.708-.708L10.293 8.5H4.5A.5.5 0 0 1 4 8z"/></svg>
      </span>
      <span class="context-menu-label">Go To</span>
      <span class="context-menu-arrow"></span>
    </div>
    <div class="context-menu-separator"></div>
    <div class="context-menu-item" data-action="print">
      <span class="context-menu-icon">
        <svg viewBox="0 0 16 16" fill="currentColor"><path d="M2.5 8a.5.5 0 1 0 0-1 .5.5 0 0 0 0 1z"/><path d="M5 1a2 2 0 0 0-2 2v2H2a2 2 0 0 0-2 2v3a2 2 0 0 0 2 2h1v1a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2v-1h1a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2h-1V3a2 2 0 0 0-2-2H5zM4 3a1 1 0 0 1 1-1h6a1 1 0 0 1 1 1v2H4V3zm1 5a2 2 0 0 0-2 2v1H2a1 1 0 0 1-1-1V7a1 1 0 0 1 1-1h12a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1h-1v-1a2 2 0 0 0-2-2H5zm7 2v3a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1v-3a1 1 0 0 1 1-1h6a1 1 0 0 1 1 1z"/></svg>
      </span>
      <span class="context-menu-label">Print...</span>
      <span class="context-menu-shortcut">Ctrl+P</span>
    </div>
    <div class="context-menu-item" data-action="find">
      <span class="context-menu-icon">
        <svg viewBox="0 0 16 16" fill="currentColor"><path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"/></svg>
      </span>
      <span class="context-menu-label">Find...</span>
      <span class="context-menu-shortcut">Ctrl+F</span>
    </div>
    <div class="context-menu-item" data-action="search">
      <span class="context-menu-icon">
        <svg viewBox="0 0 16 16" fill="currentColor"><path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"/><path d="M3 6.5a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1-.5-.5z"/></svg>
      </span>
      <span class="context-menu-label">Search...</span>
      <span class="context-menu-shortcut">Ctrl+Shift+F</span>
    </div>
    <div class="context-menu-separator"></div>
    <div class="context-menu-item" data-action="page-properties">
      <span class="context-menu-icon">
        <svg viewBox="0 0 16 16" fill="currentColor"><path d="M8 4.754a3.246 3.246 0 1 0 0 6.492 3.246 3.246 0 0 0 0-6.492zM5.754 8a2.246 2.246 0 1 1 4.492 0 2.246 2.246 0 0 1-4.492 0z"/><path d="M9.796 1.343c-.527-1.79-3.065-1.79-3.592 0l-.094.319a.873.873 0 0 1-1.255.52l-.292-.16c-1.64-.892-3.433.902-2.54 2.541l.159.292a.873.873 0 0 1-.52 1.255l-.319.094c-1.79.527-1.79 3.065 0 3.592l.319.094a.873.873 0 0 1 .52 1.255l-.16.292c-.892 1.64.901 3.434 2.541 2.54l.292-.159a.873.873 0 0 1 1.255.52l.094.319c.527 1.79 3.065 1.79 3.592 0l.094-.319a.873.873 0 0 1 1.255-.52l.292.16c1.64.893 3.434-.902 2.54-2.541l-.159-.292a.873.873 0 0 1 .52-1.255l.319-.094c1.79-.527 1.79-3.065 0-3.592l-.319-.094a.873.873 0 0 1-.52-1.255l.16-.292c.893-1.64-.902-3.433-2.541-2.54l-.292.159a.873.873 0 0 1-1.255-.52l-.094-.319z"/></svg>
      </span>
      <span class="context-menu-label">Properties...</span>
    </div>
  </div>

  <!-- About Dialog -->
  <!-- Loading Overlay -->
  <div id="loading-overlay" class="loading-overlay">
    <div class="loading-content">
      <div class="loading-spinner"></div>
      <div class="loading-text">Loading...</div>
    </div>
  </div>

  <!-- Backstage Overlay -->
  <div class="backstage-overlay" id="backstage-overlay">
    <div class="backstage-sidebar">
      <button class="backstage-back" id="backstage-back">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M19 12H5M12 19l-7-7 7-7"/>
        </svg>
        <span>File</span>
      </button>
      <div class="backstage-items">
        <button class="backstage-item" id="bs-new">
          <span class="backstage-item-icon">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/>
              <path d="M14 2v6h6"/>
              <path d="M12 18v-6m-3 3h6"/>
            </svg>
          </span>
          <span class="backstage-item-label">New</span>
          <span class="backstage-item-shortcut">Ctrl+N</span>
        </button>
        <button class="backstage-item" id="bs-open">
          <span class="backstage-item-icon">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5a2 2 0 012-2h5l2 3h9a2 2 0 012 2z"/>
            </svg>
          </span>
          <span class="backstage-item-label">Open</span>
          <span class="backstage-item-shortcut">Ctrl+O</span>
        </button>
        <button class="backstage-item" id="bs-save">
          <span class="backstage-item-icon">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M17 3H5a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2V7l-4-4z"/>
              <path d="M17 3v4a1 1 0 01-1 1H8"/>
              <path d="M7 14h10v7H7z"/>
            </svg>
          </span>
          <span class="backstage-item-label">Save</span>
          <span class="backstage-item-shortcut">Ctrl+S</span>
        </button>
        <button class="backstage-item" id="bs-save-as">
          <span class="backstage-item-icon">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M17 3H5a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2V7l-4-4z"/>
              <path d="M17 3v4a1 1 0 01-1 1H8"/>
              <path d="M12 12v6m-3-3h6"/>
            </svg>
          </span>
          <span class="backstage-item-label">Save As...</span>
          <span class="backstage-item-shortcut">Ctrl+Shift+S</span>
        </button>
        <button class="backstage-item" id="bs-print">
          <span class="backstage-item-icon">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <polyline points="6 9 6 2 18 2 18 9"/>
              <path d="M6 18H4a2 2 0 01-2-2v-5a2 2 0 012-2h16a2 2 0 012 2v5a2 2 0 01-2 2h-2"/>
              <rect x="6" y="14" width="12" height="8"/>
            </svg>
          </span>
          <span class="backstage-item-label">Print</span>
          <span class="backstage-item-shortcut">Ctrl+P</span>
        </button>
        <div class="backstage-divider"></div>
        <button class="backstage-item" id="bs-import">
          <span class="backstage-item-icon">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/>
              <polyline points="7 10 12 15 17 10"/>
              <line x1="12" y1="15" x2="12" y2="3"/>
            </svg>
          </span>
          <span class="backstage-item-label">Import</span>
          <span class="backstage-item-shortcut"></span>
        </button>
        <button class="backstage-item" id="bs-export">
          <span class="backstage-item-icon">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/>
              <polyline points="17 8 12 3 7 8"/>
              <line x1="12" y1="3" x2="12" y2="15"/>
            </svg>
          </span>
          <span class="backstage-item-label">Export</span>
          <span class="backstage-item-shortcut"></span>
        </button>
        <div class="backstage-divider"></div>
        <button class="backstage-item" id="bs-doc-properties">
          <span class="backstage-item-icon">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/>
              <path d="M14 2v6h6"/>
              <path d="M16 13H8m8 4H8m2-8H8"/>
            </svg>
          </span>
          <span class="backstage-item-label">Document Properties</span>
          <span class="backstage-item-shortcut">Ctrl+D</span>
        </button>
        <div class="backstage-divider"></div>
        <button class="backstage-item" id="bs-preferences">
          <span class="backstage-item-icon">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="12" cy="12" r="3"/>
              <path d="M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 010 2.83 2 2 0 01-2.83 0l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-4 0v-.09A1.65 1.65 0 009 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83-2.83l.06-.06A1.65 1.65 0 004.68 15a1.65 1.65 0 00-1.51-1H3a2 2 0 010-4h.09A1.65 1.65 0 004.6 9a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 012.83-2.83l.06.06A1.65 1.65 0 009 4.68a1.65 1.65 0 001-1.51V3a2 2 0 014 0v.09a1.65 1.65 0 001 1.51 1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 2.83l-.06.06A1.65 1.65 0 0019.4 9a1.65 1.65 0 001.51 1H21a2 2 0 010 4h-.09a1.65 1.65 0 00-1.51 1z"/>
            </svg>
          </span>
          <span class="backstage-item-label">Preferences</span>
          <span class="backstage-item-shortcut">Ctrl+,</span>
        </button>
        <div class="backstage-divider"></div>
        <button class="backstage-item" id="bs-about">
          <span class="backstage-item-icon">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="12" cy="12" r="10"/>
              <line x1="12" y1="16" x2="12" y2="12"/>
              <line x1="12" y1="8" x2="12.01" y2="8"/>
            </svg>
          </span>
          <span class="backstage-item-label">About</span>
          <span class="backstage-item-shortcut"></span>
        </button>
        <div class="backstage-divider"></div>
        <button class="backstage-item" id="bs-exit">
          <span class="backstage-item-icon">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M9 21H5a2 2 0 01-2-2V5a2 2 0 012-2h4"/>
              <polyline points="16 17 21 12 16 7"/>
              <line x1="21" y1="12" x2="9" y2="12"/>
            </svg>
          </span>
          <span class="backstage-item-label">Exit</span>
          <span class="backstage-item-shortcut">Alt+F4</span>
        </button>
      </div>
    </div>
    <div class="backstage-content" id="backstage-content">
      <!-- About Panel -->
      <div class="bs-about-panel" id="bs-about-panel" style="display: none;">
        <h2 class="bs-about-title">About</h2>
        <div class="bs-about-app">
          <div class="bs-about-logo">
            <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M14 2H6C5.46957 2 4.96086 2.21071 4.58579 2.58579C4.21071 2.96086 4 3.46957 4 4V20C4 20.5304 4.21071 21.0391 4.58579 21.4142C4.96086 21.7893 5.46957 22 6 22H18C18.5304 22 19.0391 21.7893 19.4142 21.4142C19.7893 21.0391 20 20.5304 20 20V8L14 2Z" stroke="#667eea" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M14 2V8H20" stroke="#667eea" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M16 13H8" stroke="#764ba2" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M16 17H8" stroke="#764ba2" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M10 9H9H8" stroke="#764ba2" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </div>
          <div class="bs-about-app-info">
            <h1 class="bs-about-app-name">Open PDF Studio</h1>
            <p class="bs-about-version" id="bs-about-version">Version</p>
          </div>
        </div>
        <p class="bs-about-tagline">IT Without Chains</p>
        <p class="bs-about-description">
          A professional PDF editor for viewing, annotating, and editing PDF documents.
          Built with open source technologies.
        </p>
        <div class="bs-about-company">
          <h3 class="bs-about-company-name">OpenAEC Foundation</h3>
          <p class="bs-about-company-desc">
            From the Latin "to share and distribute" - we liberate businesses from vendor lock-in
            through professional open source solutions. Transparent pricing, transparent code.
          </p>
        </div>
        <div class="bs-about-links">
          <a href="#" class="bs-about-link" id="bs-about-website-link">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10"/>
              <path d="M2 12h20M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/>
            </svg>
            Website
          </a>
          <a href="#" class="bs-about-link" id="bs-about-email-link">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/>
              <polyline points="22,6 12,13 2,6"/>
            </svg>
            Contact
          </a>
        </div>
        <div class="bs-about-footer">
          <p class="bs-about-copyright">&copy; 2025 OpenAEC Foundation. Licensed under MIT.</p>
        </div>
      </div>

      <!-- Export Panel -->
      <div class="bs-export-panel" id="bs-export-panel" style="display: none;">
        <h2 class="bs-export-title">Export</h2>

        <div class="bs-export-cards">
          <!-- Export as Images card -->
          <div class="bs-export-card" id="bs-export-images-card">
            <div class="bs-export-card-icon">
              <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                <circle cx="8.5" cy="8.5" r="1.5"/>
                <polyline points="21 15 16 10 5 21"/>
              </svg>
            </div>
            <div class="bs-export-card-info">
              <h3>Export as Images</h3>
              <p>Save pages as PNG or JPEG image files</p>
            </div>
          </div>

          <!-- Export as Raster PDF card -->
          <div class="bs-export-card" id="bs-export-raster-card">
            <div class="bs-export-card-icon">
              <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                <path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/>
                <path d="M14 2v6h6"/>
                <rect x="8" y="13" width="8" height="5" rx="0"/>
              </svg>
            </div>
            <div class="bs-export-card-info">
              <h3>Export as Raster PDF</h3>
              <p>Flatten pages and annotations into a new PDF with rasterized images</p>
            </div>
          </div>
        </div>

        <!-- Export Options (shown after selecting a card) -->
        <div class="bs-export-options" id="bs-export-options" style="display: none;">
          <h3 class="bs-export-options-title" id="bs-export-options-title">Options</h3>

          <div class="bs-export-option-group">
            <label class="bs-export-option-label">Page Range</label>
            <div class="bs-export-radio-group">
              <label class="bs-export-radio"><input type="radio" name="bs-export-page-range" value="all" checked> All pages</label>
              <label class="bs-export-radio"><input type="radio" name="bs-export-page-range" value="current"> Current page</label>
              <label class="bs-export-radio"><input type="radio" name="bs-export-page-range" value="custom"> Custom:</label>
            </div>
            <input type="text" class="bs-export-input" id="bs-export-custom-pages" placeholder="e.g. 1-5, 8, 11-13" disabled>
          </div>

          <div class="bs-export-option-group" id="bs-export-format-group">
            <label class="bs-export-option-label">Format</label>
            <select id="bs-export-format" class="bs-export-select">
              <option value="png">PNG</option>
              <option value="jpeg">JPEG</option>
            </select>
          </div>

          <div class="bs-export-option-group" id="bs-export-quality-group" style="display: none;">
            <label class="bs-export-option-label">JPEG Quality</label>
            <div class="bs-export-range-row">
              <input type="range" id="bs-export-quality" min="10" max="100" value="92" class="bs-export-range">
              <span id="bs-export-quality-value" class="bs-export-range-value">92%</span>
            </div>
          </div>

          <div class="bs-export-option-group">
            <label class="bs-export-option-label">Resolution</label>
            <select id="bs-export-dpi" class="bs-export-select">
              <option value="72">72 DPI (Screen)</option>
              <option value="150" selected>150 DPI</option>
              <option value="300">300 DPI (Print)</option>
              <option value="600">600 DPI (High Quality)</option>
            </select>
          </div>

          <button class="bs-export-btn" id="bs-export-go-btn">Export</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Software Update Dialog -->
  <div class="update-overlay" id="update-dialog">
    <div class="update-dialog">
      <div class="update-header">
        <h2>Software Update</h2>
        <button class="update-close-btn" id="update-close-btn">&times;</button>
      </div>
      <div class="update-body">
        <div class="update-icon">
          <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="#0078d7" stroke-width="1.5">
            <path stroke-linecap="round" stroke-linejoin="round" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
          </svg>
        </div>
        <div class="update-info">
          <p class="update-message">A new version of Open PDF Studio is available.</p>
          <div class="update-versions">
            <div class="update-version-row">
              <span class="update-version-label">Current version:</span>
              <span class="update-version-value" id="update-current-version">-</span>
            </div>
            <div class="update-version-row">
              <span class="update-version-label">New version:</span>
              <span class="update-version-value update-version-new" id="update-new-version">-</span>
            </div>
          </div>
          <div class="update-notes-section">
            <label class="update-notes-label">Release Notes:</label>
            <div class="update-notes" id="update-notes"></div>
          </div>
        </div>
      </div>
      <div class="update-progress-section" id="update-progress-section" style="display: none;">
        <div class="update-progress-bar-track">
          <div class="update-progress-bar-fill" id="update-progress-bar"></div>
        </div>
        <span class="update-progress-text" id="update-progress-text">Downloading... 0%</span>
      </div>
      <div class="update-footer">
        <button class="update-btn update-btn-secondary" id="update-skip-btn">Skip This Version</button>
        <div class="update-footer-right">
          <button class="update-btn update-btn-secondary" id="update-later-btn">Remind Me Later</button>
          <button class="update-btn update-btn-primary" id="update-install-btn">Download &amp; Install</button>
        </div>
      </div>
    </div>
  </div>

  <script src="js/main.js" type="module"></script>
</body>
</html>
